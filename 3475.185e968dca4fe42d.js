"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3475],{3475:(Jg,Ju,j)=>{j.r(Ju),j.d(Ju,{HomePageModule:()=>Bv});var I=j(6814),Se=j(1929),x=j(95),vt=j(4934),S=j(5861),w=j(9212),Pe=j(1180),Ce=j(1920),Xe=j(7217),Xu=(j(6230),j(8645)),Tt=j(2096),Fo=j(5592),sn=j(2459),dh=j(7537),Uo=j(4829),el=j(6232),fh=j(4564),es=j(3093),Et=j(4664),se=j(7398),Ge=j(4552);class tl extends Xu.x{constructor(e=1/0,t=1/0,r=Ge.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:a}=this;t||(r.push(e),!i&&r.push(s.now()+a)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let a=0;a<s.length&&!e.closed;a+=r?1:2)e.next(s[a]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const a=t.now();let h=0;for(let d=1;d<r.length&&r[d]<=a;d+=2)h=d;h&&r.splice(0,h+1)}}}var Mn=j(305),ts=j(9360);function ft(n,e,...t){if(!0===e)return void n();if(!1===e)return;const r=new Mn.Hp({next:()=>{r.unsubscribe(),n()}});return(0,Uo.Xf)(e(...t)).subscribe(r)}function pt(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=null!=n?n:1/0,function k(n={}){const{connector:e=(()=>new Xu.x),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return s=>{let a,h,d,p=0,m=!1,_=!1;const v=()=>{null==h||h.unsubscribe(),h=void 0},A=()=>{v(),a=d=void 0,m=_=!1},V=()=>{const D=a;A(),null==D||D.unsubscribe()};return(0,ts.e)((D,N)=>{p++,!_&&!m&&v();const q=d=null!=d?d:e();N.add(()=>{p--,0===p&&!_&&!m&&(h=ft(V,i))}),q.subscribe(N),!a&&p>0&&(a=new Mn.Hp({next:Z=>q.next(Z),error:Z=>{_=!0,v(),h=ft(A,t,Z),q.error(Z)},complete:()=>{m=!0,v(),h=ft(A,r),q.complete()}}),(0,Uo.Xf)(D).subscribe(a))})(s)}}({connector:()=>new tl(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var $r=j(1374),qo=j(4674);function Bo(n,e){return(0,qo.m)(e)?(0,Et.w)(()=>n,e):(0,Et.w)(()=>n)}var zo=j(5137),Wo=j(2181);j(7142);const $o=new w.OlP("angularfire2.auth.use-emulator"),nl=new w.OlP("angularfire2.auth.settings"),rl=new w.OlP("angularfire2.auth.tenant-id"),he=new w.OlP("angularfire2.auth.langugage-code"),de=new w.OlP("angularfire2.auth.use-device-language"),rs=new w.OlP("angularfire.auth.persistence"),Zo=(n,e,t,r,i,s,a,h)=>(0,Xe.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const d=e.runOutsideAngular(()=>n.auth());if(t&&d.useEmulator(...t),r&&(d.tenantId=r),d.languageCode=i,s&&d.useDeviceLanguage(),a)for(const[p,m]of Object.entries(a))d.settings[p]=m;return h&&d.setPersistence(h),d},[t,r,i,s,a,h]);let is=(()=>{var n;class e{constructor(r,i,s,a,h,d,p,m,_,v,A,V){(0,Pe.Z)(this,"authState",void 0),(0,Pe.Z)(this,"idToken",void 0),(0,Pe.Z)(this,"user",void 0),(0,Pe.Z)(this,"idTokenResult",void 0),(0,Pe.Z)(this,"credential",void 0);const D=new Xu.x,N=(0,Tt.of)(void 0).pipe((0,es.Q)(h.outsideAngular),(0,Et.w)(()=>a.runOutsideAngular(()=>Promise.resolve().then(j.bind(j,6230)))),(0,se.U)(()=>(0,Xe.on)(r,a,i)),(0,se.U)(q=>Zo(q,a,d,m,_,v,p,A)),pt({bufferSize:1,refCount:!1}));if((0,I.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Tt.of)(null);else{N.pipe((0,$r.P)()).subscribe();const q=N.pipe((0,Et.w)(G=>G.getRedirectResult().then(X=>X,()=>null)),Ce.iC,pt({bufferSize:1,refCount:!1})),Z=N.pipe((0,Et.w)(G=>new Fo.y(X=>({unsubscribe:a.runOutsideAngular(()=>G.onAuthStateChanged(J=>X.next(J),J=>X.error(J),()=>X.complete()))})))),K=N.pipe((0,Et.w)(G=>new Fo.y(X=>({unsubscribe:a.runOutsideAngular(()=>G.onIdTokenChanged(J=>X.next(J),J=>X.error(J),()=>X.complete()))}))));this.authState=q.pipe(Bo(Z),(0,zo.R)(h.outsideAngular),(0,es.Q)(h.insideAngular)),this.user=q.pipe(Bo(K),(0,zo.R)(h.outsideAngular),(0,es.Q)(h.insideAngular)),this.idToken=this.user.pipe((0,Et.w)(G=>G?(0,sn.D)(G.getIdToken()):(0,Tt.of)(null))),this.idTokenResult=this.user.pipe((0,Et.w)(G=>G?(0,sn.D)(G.getIdTokenResult()):(0,Tt.of)(null))),this.credential=function Xi(...n){const e=(0,fh.yG)(n),t=(0,fh._6)(n,1/0),r=n;return r.length?1===r.length?(0,Uo.Xf)(r[0]):(0,dh.J)(t)((0,sn.D)(r,e)):el.E}(q,D,this.authState.pipe((0,Wo.h)(G=>!G))).pipe((0,se.U)(G=>null!=G&&G.user?G:null),(0,zo.R)(h.outsideAngular),(0,es.Q)(h.insideAngular))}return(0,Xe.pX)(this,N,a,{spy:{apply:(q,Z,K)=>{(q.startsWith("signIn")||q.startsWith("createUser"))&&K.then(G=>D.next(G))}}})}}return n=e,(0,Pe.Z)(e,"\u0275fac",function(r){return new(r||n)(w.LFG(Xe.Dh),w.LFG(Xe.xv,8),w.LFG(w.Lbi),w.LFG(w.R0b),w.LFG(Ce.HU),w.LFG($o,8),w.LFG(nl,8),w.LFG(rl,8),w.LFG(he,8),w.LFG(de,8),w.LFG(rs,8),w.LFG(Ce.Rf,8))}),(0,Pe.Z)(e,"\u0275prov",w.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();var Ko=j(6321),ss=j(7921),ph=j(8251);function jo(){return(0,ts.e)((n,e)=>{let t,r=!1;n.subscribe((0,ph.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var F,Ln=j(6699),il=j(3997),sl=j(3106),Fn=j(534),ol=j(4537),mt=j(7879),oe=j(9058),Ho=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},At={},Qo=Qo||{},Q=Ho||self;function os(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Un(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var al="closure_uid_"+(1e9*Math.random()>>>0),mh=0;function Yo(n,e,t){return n.call.apply(n.bind,arguments)}function Jo(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function De(n,e,t){return(De=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Yo:Jo).apply(null,arguments)}function as(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function fe(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var a=Array(arguments.length-2),h=2;h<arguments.length;h++)a[h-2]=arguments[h];return e.prototype[i].apply(r,a)}}function St(){this.s=this.s,this.o=this.o}St.prototype.s=!1,St.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Zr(n){Object.prototype.hasOwnProperty.call(n,al)&&n[al]||(n[al]=++mh)}(this)},St.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ul=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function us(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function cr(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(os(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let a=0;a<s;a++)n[i+a]=r[a]}else n.push(r)}}function qe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}qe.prototype.h=function(){this.defaultPrevented=!0};var _h=function(){if(!Q.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};Q.addEventListener("test",t,e),Q.removeEventListener("test",t,e)}catch{}return n}();function qn(n){return/^[\s\xa0]*$/.test(n)}function ls(){var n=Q.navigator;return n&&(n=n.userAgent)?n:""}function Ct(n){return-1!=ls().indexOf(n)}function Xo(n){return Xo[" "](n),n}Xo[" "]=function(){};var cl,n,yh=Ct("Opera"),an=Ct("Trident")||Ct("MSIE"),hr=Ct("Edge"),bt=hr||an,un=Ct("Gecko")&&!(-1!=ls().toLowerCase().indexOf("webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),ll=-1!=ls().toLowerCase().indexOf("webkit")&&!Ct("Edge");function et(){var n=Q.document;return n?n.documentMode:void 0}e:{var ln="",Gt=(n=ls(),un?/rv:([^\);]+)(\)|;)/.exec(n):hr?/Edge\/([\d\.]+)/.exec(n):an?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):ll?/WebKit\/(\S+)/.exec(n):yh?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Gt&&(ln=Gt?Gt[1]:""),an){var cn=et();if(null!=cn&&cn>parseFloat(ln)){cl=String(cn);break e}}cl=ln}var na=Q.document&&an&&(et()||parseInt(cl,10))||void 0;function dr(n,e){if(qe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(un){e:{try{Xo(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:hl[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&dr.$.h.call(this)}}fe(dr,qe);var hl={2:"touch",3:"pen",4:"mouse"};dr.prototype.h=function(){dr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var $t="closure_listenable_"+(1e6*Math.random()|0),dl=0;function fl(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++dl,this.fa=this.ia=!1}function Zt(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function ra(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function pl(n){const e={};for(const t in n)e[t]=n[t];return e}const ia="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ml(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<ia.length;s++)t=ia[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Kr(n){this.src=n,this.g={},this.h=0}function sa(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=ul(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Zt(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function oa(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Kr.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var a=oa(n,e,r,i);return-1<a?(e=n[a],t||(e.ia=!1)):((e=new fl(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var jr="closure_lm_"+(1e6*Math.random()|0),aa={};function gl(n,e,t,r,i){if(r&&r.once)return ua(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)gl(n,e[s],t,r,i);return null}return t=hs(t),n&&n[$t]?n.O(e,t,Un(r)?!!r.capture:!!r,i):_l(n,e,t,!1,r,i)}function _l(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var a=Un(i)?!!i.capture:!!i,h=ca(n);if(h||(n[jr]=h=new Kr(n)),(t=h.add(e,t,r,a,s)).proxy)return t;if(r=function me(){const e=vh;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)_h||(i=a),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(la(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function ua(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ua(n,e[s],t,r,i);return null}return t=hs(t),n&&n[$t]?n.P(e,t,Un(r)?!!r.capture:!!r,i):_l(n,e,t,!0,r,i)}function yl(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)yl(n,e[s],t,r,i);else r=Un(r)?!!r.capture:!!r,t=hs(t),n&&n[$t]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=oa(s=n.g[e],t,r,i))&&(Zt(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=ca(n))&&(e=n.g[e.toString()],n=-1,e&&(n=oa(e,t,r,i)),(t=-1<n?e[n]:null)&&Hr(t))}function Hr(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[$t])sa(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(la(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ca(e))?(sa(t,n),0==t.h&&(t.src=null,e[jr]=null)):Zt(n)}}}function la(n){return n in aa?aa[n]:aa[n]="on"+n}function vh(n,e){if(n.fa)n=!0;else{e=new dr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Hr(n),n=t.call(r,e)}return n}function ca(n){return(n=n[jr])instanceof Kr?n:null}var ha="__closure_events_fn_"+(1e9*Math.random()>>>0);function hs(n){return"function"==typeof n?n:(n[ha]||(n[ha]=function(e){return n.handleEvent(e)}),n[ha])}function Ne(){St.call(this),this.i=new Kr(this),this.S=this,this.J=null}function ke(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new qe(e,n);else if(e instanceof qe)e.target=e.target||n;else{var i=e;ml(e=new qe(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];i=hn(a,r,!0,e)&&i}if(i=hn(a=e.g=n,r,!0,e)&&i,i=hn(a,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=hn(a=e.g=t[s],r,!1,e)&&i}function hn(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var h=a.listener,d=a.la||a.src;a.ia&&sa(n.i,a),i=!1!==h.call(d,r)&&i}}return i&&!r.defaultPrevented}fe(Ne,St),Ne.prototype[$t]=!0,Ne.prototype.removeEventListener=function(n,e,t,r){yl(this,n,e,t,r)},Ne.prototype.N=function(){if(Ne.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Zt(t[r]);delete n.g[e],n.h--}}this.J=null},Ne.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},Ne.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Qr=Q.JSON.stringify;function da(){var n=dn;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Il=new class Th{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new vl,n=>n.reset());class vl{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Tl(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Ah(n){Q.setTimeout(()=>{throw n},0)}let fr,Yr=!1,dn=new class Eh{constructor(){this.h=this.g=null}add(e,t){const r=Il.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},fa=()=>{const n=Q.Promise.resolve(void 0);fr=()=>{n.then(pa)}};var pa=()=>{for(var n;n=da();){try{n.h.call(n.g)}catch(t){Ah(t)}var e=Il;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Yr=!1};function ds(n,e){Ne.call(this),this.h=n||1,this.g=e||Q,this.j=De(this.qb,this),this.l=Date.now()}function Jr(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function ma(n,e,t){if("function"==typeof n)t&&(n=De(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=De(n.handleEvent,n)}return 2147483647<Number(e)?-1:Q.setTimeout(n,e||0)}function fs(n){n.g=ma(()=>{n.g=null,n.i&&(n.i=!1,fs(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}fe(ds,Ne),(F=ds.prototype).ga=!1,F.T=null,F.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ke(this,"tick"),this.ga&&(Jr(this),this.start()))}},F.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},F.N=function(){ds.$.N.call(this),Jr(this),delete this.g};class wh extends St{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:fs(this)}N(){super.N(),this.g&&(Q.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bn(n){St.call(this),this.h=n,this.g={}}fe(Bn,St);var El=[];function ps(n,e,t,r){Array.isArray(t)||(t&&(El[0]=t.toString()),t=El);for(var i=0;i<t.length;i++){var s=gl(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Xr(n){ra(n.g,function(e,t){this.g.hasOwnProperty(t)&&Hr(e)},n),n.g={}}function pr(){this.g=!0}function mr(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Ph(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Qr(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Bn.prototype.N=function(){Bn.$.N.call(this),Xr(this)},Bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pr.prototype.Ea=function(){this.g=!1},pr.prototype.info=function(){};var Kt={},Al=null;function gr(){return Al=Al||new Ne}function wl(n){qe.call(this,Kt.Ta,n)}function zn(n){const e=gr();ke(e,new wl(e))}function Rl(n,e){qe.call(this,Kt.STAT_EVENT,n),this.stat=e}function $e(n){const e=gr();ke(e,new Rl(e,n))}function _r(n,e){qe.call(this,Kt.Ua,n),this.size=e}function ot(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return Q.setTimeout(function(){n()},e)}Kt.Ta="serverreachability",fe(wl,qe),Kt.STAT_EVENT="statevent",fe(Rl,qe),Kt.Ua="timingevent",fe(_r,qe);var yr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Pl={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function gt(){}function ms(){}gt.prototype.h=null;var ni,ei={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ti(){qe.call(this,"d")}function ya(){qe.call(this,"c")}function gs(){}function ri(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Bn(this),this.P=Wn,this.V=new ds(n=bt?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new _s}function _s(){this.i=null,this.g="",this.h=!1}fe(ti,qe),fe(ya,qe),fe(gs,gt),gs.prototype.g=function(){return new XMLHttpRequest},gs.prototype.i=function(){return{}},ni=new gs;var Wn=45e3,Cl={},Ia={};function Gn(n,e,t){n.L=1,n.A=oi(Dt(e)),n.u=t,n.S=!0,Sh(n,null)}function Sh(n,e){n.G=Date.now(),Vt(n),n.B=Dt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Sa(t.i,"t",r),n.o=0,t=n.l.J,n.h=new _s,n.g=Us(n.l,t?e:null,!n.u),0<n.O&&(n.M=new wh(De(n.Pa,n,n.g),n.O)),ps(n.U,n.g,"readystatechange",n.nb),e=n.I?pl(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),zn(),function Rh(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var a="",h=s.split("&"),d=0;d<h.length;d++){var p=h[d].split("=");if(1<p.length){var m=p[0];p=p[1];var _=m.split("_");a=2<=_.length&&"type"==_[1]?a+(m+"=")+p+"&":a+(m+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+a})}(n.j,n.v,n.B,n.m,n.W,n.u)}function ys(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function xt(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=Ir(n,t),i==Ia){4==e&&(n.s=4,$e(14),r=!1),mr(n.j,n.m,null,"[Incomplete Response]");break}if(i==Cl){n.s=4,$e(15),mr(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}mr(n.j,n.m,i,null),fn(n,i)}ys(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,$e(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Fa(e),e.M=!0,$e(11))):(mr(n.j,n.m,t,"[Invalid Chunked Response]"),$n(n),vr(n))}function Ir(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?Ia:(t=Number(e.substring(t,r)),isNaN(t)?Cl:(r+=1)+t>e.length?Ia:(e=e.slice(r,r+t),n.o=r+t,e))}function Vt(n){n.Y=Date.now()+n.P,va(n,n.P)}function va(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=ot(De(n.lb,n),e)}function ii(n){n.C&&(Q.clearTimeout(n.C),n.C=null)}function vr(n){0==n.l.H||n.J||Fl(n.l,n)}function $n(n){ii(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Jr(n.V),Xr(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function fn(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Kn(t.i,n)))if(!n.K&&Kn(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Fs(t),ks(t)}Ls(t),$e(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=ot(De(t.ib,t),6e3));if(1>=ws(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Ar(t,11)}else if((n.K||t.g==n)&&Fs(t),!qn(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let p=i[e];if(t.V=p[0],p=p[1],2==t.H)if("c"==p[0]){t.K=p[1],t.pa=p[2];const m=p[3];null!=m&&(t.ra=m,t.l.info("VER="+t.ra));const _=p[4];null!=_&&(t.Ga=_,t.l.info("SVER="+t.Ga));const v=p[5];null!=v&&"number"==typeof v&&0<v&&(t.L=r=1.5*v,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const A=n.g;if(A){const V=A.g?A.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(V){var s=r.i;s.g||-1==V.indexOf("spdy")&&-1==V.indexOf("quic")&&-1==V.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(li(s,s.h),s.h=null))}if(r.F){const D=A.g?A.g.getResponseHeader("X-HTTP-Session-Id"):null;D&&(r.Da=D,pe(r.I,r.F,D))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var a=n;if((r=t).wa=Oh(r,r.J?r.pa:null,r.Y),a.K){Rs(r.i,a);var h=a,d=r.L;d&&h.setTimeout(d),h.C&&(ii(h),Vt(h)),r.g=a}else Jn(r);0<t.j.length&&Ms(t)}else"stop"!=p[0]&&"close"!=p[0]||Ar(t,7);else 3==t.H&&("stop"==p[0]||"close"==p[0]?"stop"==p[0]?Ar(t,7):fi(t):"noop"!=p[0]&&t.h&&t.h.Aa(p),t.A=0)}zn()}catch{}}function Ta(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(os(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Is(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(os(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Ch(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(os(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(F=ri.prototype).setTimeout=function(n){this.P=n},F.nb=function(n){n=n.target;const e=this.M;e&&3==kt(n)?e.l():this.Pa(n)},F.Pa=function(n){try{if(n==this.g)e:{const m=kt(this.g);var e=this.g.Ia();if(this.g.da(),!(3>m)&&(3!=m||bt||this.g&&(this.h.h||this.g.ja()||Ds(this.g)))){this.J||4!=m||7==e||zn(),ii(this);var t=this.g.da();this.ca=t;t:if(ys(this)){var r=Ds(this.g);n="";var i=r.length,s=4==kt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){$n(this),vr(this);var a="";break t}this.h.i=new Q.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,a=this.h.g}else a=this.g.ja();if(this.i=200==t,function ga(n,e,t,r,i,s,a){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+a})}(this.j,this.v,this.B,this.m,this.W,m,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var h,d=this.g;if((h=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!qn(h)){var p=h;break t}}p=null}if(!(t=p)){this.i=!1,this.s=3,$e(12),$n(this),vr(this);break e}mr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fn(this,t)}this.S?(xt(this,m,a),bt&&this.i&&3==m&&(ps(this.U,this.V,"tick",this.mb),this.V.start())):(mr(this.j,this.m,a,null),fn(this,a)),4==m&&$n(this),this.i&&!this.J&&(4==m?Fl(this.l,this):(this.i=!1,Vt(this)))}else(function Dh(n){const e={};n=(n.g&&2<=kt(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(qn(n[r]))continue;var t=Tl(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Ih(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<a.indexOf("Unknown SID")?(this.s=3,$e(12)):(this.s=0,$e(13)),$n(this),vr(this)}}}catch{}},F.mb=function(){if(this.g){var n=kt(this.g),e=this.g.ja();this.o<e.length&&(ii(this),xt(this,n,e),this.i&&4!=n&&Vt(this))}},F.cancel=function(){this.J=!0,$n(this)},F.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function _a(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(zn(),$e(17)),$n(this),this.s=2,vr(this)):va(this,this.Y-n)};var Ea=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Be(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Be){this.h=n.h,vs(this,n.j),this.s=n.s,this.g=n.g,Tr(this,n.m),this.l=n.l;var e=n.i,t=new Er;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),si(this,t),this.o=n.o}else n&&(e=String(n).match(Ea))?(this.h=!1,vs(this,e[1]||"",!0),this.s=ai(e[2]||""),this.g=ai(e[3]||"",!0),Tr(this,e[4]),this.l=ai(e[5]||"",!0),si(this,e[6]||"",!0),this.o=ai(e[7]||"")):(this.h=!1,this.i=new Er(null,this.h))}function Dt(n){return new Be(n)}function vs(n,e,t){n.j=t?ai(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Tr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function si(n,e,t){e instanceof Er?(n.i=e,function xl(n,e){e&&!n.j&&(Nt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(ui(this,r),Sa(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Zn(e,bl)),n.i=new Er(e,n.h))}function pe(n,e,t){n.i.set(e,t)}function oi(n){return pe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function ai(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Zn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,wa),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function wa(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Be.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Zn(e,Ts,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Zn(e,Ts,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Zn(t,"/"==t.charAt(0)?Ra:Es,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Zn(t,Pa)),n.join("")};var Ts=/[#\/\?@]/g,Es=/[#\?:]/g,Ra=/[#\?]/g,bl=/[#\?@]/g,Pa=/#/g;function Er(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Nt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Aa(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function ui(n,e){Nt(n),e=pn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function As(n,e){return Nt(n),e=pn(n,e),n.g.has(e)}function Sa(n,e,t){ui(n,e),0<t.length&&(n.i=null,n.g.set(pn(n,e),us(t)),n.h+=t.length)}function pn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}(F=Er.prototype).add=function(n,e){Nt(this),this.i=null,n=pn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},F.forEach=function(n,e){Nt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},F.ta=function(){Nt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},F.Z=function(n){Nt(this);let e=[];if("string"==typeof n)As(this,n)&&(e=e.concat(this.g.get(pn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},F.set=function(n,e){return Nt(this),this.i=null,As(this,n=pn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},F.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},F.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),n.push(i)}}return this.i=n.join("&")};var Ca=class{constructor(n,e){this.g=n,this.map=e}};function Vl(n){this.l=n||ba,n=Q.PerformanceNavigationTiming?0<(n=Q.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(Q.g&&Q.g.Ka&&Q.g.Ka()&&Q.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ba=10;function Dl(n){return!!n.h||!!n.g&&n.g.size>=n.j}function ws(n){return n.h?1:n.g?n.g.size:0}function Kn(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function li(n,e){n.g?n.g.add(e):n.h=e}function Rs(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function ci(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return us(n.i)}Vl.prototype.cancel=function(){if(this.i=ci(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var xa=class{stringify(n){return Q.JSON.stringify(n,void 0)}parse(n){return Q.JSON.parse(n,void 0)}};function Va(){this.g=new xa}function bh(n,e,t){const r=t||"";try{Ta(n,function(i,s){let a=i;Un(i)&&(a=Qr(i)),e.push(r+s+"="+encodeURIComponent(a))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ps(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function jn(n){this.l=n.ec||null,this.j=n.ob||!1}function Ss(n,e){Ne.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=hi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}fe(jn,gt),jn.prototype.g=function(){return new Ss(this.l,this.j)},jn.prototype.i=function(n){return function(){return n}}({}),fe(Ss,Ne);var hi=0;function Na(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Hn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,di(n)}function di(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(F=Ss.prototype).open=function(n,e){if(this.readyState!=hi)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,di(this)},F.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Q).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Hn(this)),this.readyState=hi},F.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,di(this)),this.g&&(this.readyState=3,di(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Q.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Na(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},F.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Hn(this):di(this),3==this.readyState&&Na(this)}},F.Za=function(n){this.g&&(this.response=this.responseText=n,Hn(this))},F.Ya=function(n){this.g&&(this.response=n,Hn(this))},F.ka=function(){this.g&&Hn(this)},F.setRequestHeader=function(n,e){this.v.append(n,e)},F.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},F.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Ss.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var ka=Q.JSON.parse;function Ae(n){Ne.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Cs,this.L=this.M=!1}fe(Ae,Ne);var Cs="",xh=/^https?$/i,Vh=["POST","PUT"];function Nl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,kl(n),xs(n)}function kl(n){n.F||(n.F=!0,ke(n,"complete"),ke(n,"error"))}function bs(n){if(n.h&&typeof Qo<"u"&&(!n.C[1]||4!=kt(n)||2!=n.da()))if(n.v&&4==kt(n))ma(n.La,0,n);else if(ke(n,"readystatechange"),4==kt(n)){n.h=!1;try{const a=n.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var i=String(n.I).match(Ea)[1]||null;!i&&Q.self&&Q.self.location&&(i=Q.self.location.protocol.slice(0,-1)),r=!xh.test(i?i.toLowerCase():"")}t=r}if(t)ke(n,"complete"),ke(n,"success");else{n.m=6;try{var s=2<kt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",kl(n)}}finally{xs(n)}}}function xs(n,e){if(n.g){Vs(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ke(n,"ready");try{t.onreadystatechange=r}catch{}}}function Vs(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Q.clearTimeout(n.A),n.A=null)}function kt(n){return n.g?n.g.readyState:0}function Ds(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Cs:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Ns(n){let e="";return ra(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Ma(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Ns(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):pe(n,e,t))}function Qn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Ol(n){this.Ga=0,this.j=[],this.l=new pr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Qn("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Qn("baseRetryDelayMs",5e3,n),this.hb=Qn("retryDelaySeedMs",1e4,n),this.eb=Qn("forwardChannelMaxRetries",2,n),this.xa=Qn("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Vl(n&&n.concurrentRequestLimit),this.Ja=new Va,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function fi(n){if(Os(n),3==n.H){var e=n.W++,t=Dt(n.I);if(pe(t,"SID",n.K),pe(t,"RID",e),pe(t,"TYPE","terminate"),Yn(n,t),(e=new ri(n,n.l,e)).L=2,e.A=oi(Dt(t)),t=!1,Q.navigator&&Q.navigator.sendBeacon)try{t=Q.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&Q.Image&&((new Image).src=e.A,t=!0),t||(e.g=Us(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Vt(e)}kh(n)}function ks(n){n.g&&(Fa(n),n.g.cancel(),n.g=null)}function Os(n){ks(n),n.u&&(Q.clearTimeout(n.u),n.u=null),Fs(n),n.i.cancel(),n.m&&("number"==typeof n.m&&Q.clearTimeout(n.m),n.m=null)}function Ms(n){if(!Dl(n.i)&&!n.m){n.m=!0;var e=n.Na;fr||fa(),Yr||(fr(),Yr=!0),dn.add(e,n),n.C=0}}function La(n,e){var t;t=e?e.m:n.W++;const r=Dt(n.I);pe(r,"SID",n.K),pe(r,"RID",t),pe(r,"AID",n.V),Yn(n,r),n.o&&n.s&&Ma(r,n.o,n.s),t=new ri(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Ml(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),li(n.i,t),Gn(t,r,e)}function Yn(n,e){n.na&&ra(n.na,function(t,r){pe(e,r,t)}),n.h&&Ta({},function(t,r){pe(e,r,t)})}function Ml(n,e,t){t=Math.min(n.j.length,t);var r=n.h?De(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const a=["count="+t];-1==s?0<t?(s=i[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let h=!0;for(let d=0;d<t;d++){let p=i[d].g;const m=i[d].map;if(p-=s,0>p)s=Math.max(0,i[d].g-100),h=!1;else try{bh(m,a,"req"+p+"_")}catch{r&&r(m)}}if(h){r=a.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Jn(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;fr||fa(),Yr||(fr(),Yr=!0),dn.add(e,n),n.A=0}}function Ls(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=ot(De(n.Ma,n),Ul(n,n.A)),n.A++,0))}function Fa(n){null!=n.B&&(Q.clearTimeout(n.B),n.B=null)}function Ll(n){n.g=new ri(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Dt(n.wa);pe(e,"RID","rpc"),pe(e,"SID",n.K),pe(e,"AID",n.V),pe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&pe(e,"TO",n.qa),pe(e,"TYPE","xmlhttp"),Yn(n,e),n.o&&n.s&&Ma(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=oi(Dt(e)),t.u=null,t.S=!0,Sh(t,n)}function Fs(n){null!=n.v&&(Q.clearTimeout(n.v),n.v=null)}function Fl(n,e){var t=null;if(n.g==e){Fs(n),Fa(n),n.g=null;var r=2}else{if(!Kn(n.i,e))return;t=e.F,Rs(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;ke(r=gr(),new _r(r,t)),Ms(n)}else Jn(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function Nh(n,e){return!(ws(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=ot(De(n.Na,n,e),Ul(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ls(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Ar(n,5);break;case 4:Ar(n,10);break;case 3:Ar(n,6);break;default:Ar(n,2)}}function Ul(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Ar(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=De(n.pb,n);t||(t=new Be("//www.google.com/images/cleardot.gif"),Q.location&&"http"==Q.location.protocol||vs(t,"https"),oi(t)),function Da(n,e){const t=new pr;if(Q.Image){const r=new Image;r.onload=as(Ps,t,r,"TestLoadImage: loaded",!0,e),r.onerror=as(Ps,t,r,"TestLoadImage: error",!1,e),r.onabort=as(Ps,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=as(Ps,t,r,"TestLoadImage: timeout",!1,e),Q.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else $e(2);n.H=0,n.h&&n.h.za(e),kh(n),Os(n)}function kh(n){if(n.H=0,n.ma=[],n.h){const e=ci(n.i);(0!=e.length||0!=n.j.length)&&(cr(n.ma,e),cr(n.ma,n.j),n.i.i.length=0,us(n.j),n.j.length=0),n.h.ya()}}function Oh(n,e,t){var r=t instanceof Be?Dt(t):new Be(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Tr(r,r.m);else{var i=Q.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Be(null);r&&vs(s,r),e&&(s.g=e),i&&Tr(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&pe(r,t,e),pe(r,"VER",n.ra),Yn(n,r),r}function Us(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ae(n.Ha&&!n.va?new jn({ob:t}):n.va)).Oa(n.J),e}function ql(){}function qs(){if(an&&!(10<=Number(na)))throw Error("Environmental error: no available transport.")}function _t(n,e){Ne.call(this),this.g=new Ol(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!qn(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!qn(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new pi(this)}function Mh(n){ti.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Lh(){ya.call(this),this.status=1}function pi(n){this.g=n}function Ot(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function mi(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],a=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;a=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(a<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(e=t+((a=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function te(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(F=Ae.prototype).Oa=function(n){this.M=n},F.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ni.g(),this.C=function Sl(n){return n.h||(n.h=n.i())}(this.u?this.u:ni),this.g.onreadystatechange=De(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Nl(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=Q.FormData&&n instanceof Q.FormData,!(0<=ul(Vh,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Vs(this),0<this.B&&((this.L=function Oa(n){return an&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=De(this.ua,this)):this.A=ma(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Nl(this,s)}},F.ua=function(){typeof Qo<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ke(this,"timeout"),this.abort(8))},F.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ke(this,"complete"),ke(this,"abort"),xs(this))},F.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),xs(this,!0)),Ae.$.N.call(this)},F.La=function(){this.s||(this.G||this.v||this.l?bs(this):this.kb())},F.kb=function(){bs(this)},F.isActive=function(){return!!this.g},F.da=function(){try{return 2<kt(this)?this.g.status:-1}catch{return-1}},F.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},F.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),ka(e)}},F.Ia=function(){return this.m},F.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(F=Ol.prototype).ra=8,F.H=1,F.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new ri(this,this.l,n);let s=this.s;if(this.U&&(s?(s=pl(s),ml(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Ml(this,i,e),pe(t=Dt(this.I),"RID",n),pe(t,"CVER",22),this.F&&pe(t,"X-HTTP-Session-Id",this.F),Yn(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Ns(s)))+"&"+e:this.o&&Ma(t,this.o,s)),li(this.i,i),this.bb&&pe(t,"TYPE","init"),this.P?(pe(t,"$req",e),pe(t,"SID","null"),i.aa=!0,Gn(i,t,null)):Gn(i,t,e),this.H=2}}else 3==this.H&&(n?La(this,n):0==this.j.length||Dl(this.i)||La(this))},F.Ma=function(){if(this.u=null,Ll(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=ot(De(this.jb,this),n)}},F.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,$e(10),ks(this),Ll(this))},F.ib=function(){null!=this.v&&(this.v=null,ks(this),Ls(this),$e(19))},F.pb=function(n){n?(this.l.info("Successfully pinged google.com"),$e(2)):(this.l.info("Failed to ping google.com"),$e(1))},F.isActive=function(){return!!this.h&&this.h.isActive(this)},(F=ql.prototype).Ba=function(){},F.Aa=function(){},F.za=function(){},F.ya=function(){},F.isActive=function(){return!0},F.Va=function(){},qs.prototype.g=function(n,e){return new _t(n,e)},fe(_t,Ne),_t.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;$e(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Oh(n,null,n.Y),Ms(n)},_t.prototype.close=function(){fi(this.g)},_t.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Qr(n),n=t);e.j.push(new Ca(e.fb++,n)),3==e.H&&Ms(e)},_t.prototype.N=function(){this.g.h=null,delete this.j,fi(this.g),delete this.g,_t.$.N.call(this)},fe(Mh,ti),fe(Lh,ya),fe(pi,ql),pi.prototype.Ba=function(){ke(this.g,"a")},pi.prototype.Aa=function(n){ke(this.g,new Mh(n))},pi.prototype.za=function(n){ke(this.g,new Lh)},pi.prototype.ya=function(){ke(this.g,"b")},fe(Ot,function vp(){this.blockSize=-1}),Ot.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ot.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)mi(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){mi(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){mi(this,r),i=0;break}}this.h=i,this.i+=e},Ot.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Ua={};function qa(n){return-128<=n&&128>n?function ea(n,e){var t=Ua;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new te([0|e],0>e?-1:0)}):new te([0|n],0>n?-1:0)}function Mt(n){if(isNaN(n)||!isFinite(n))return wr;if(0>n)return be(Mt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=zl;return new te(e,0)}var zl=4294967296,wr=qa(0),Ba=qa(1),Bs=qa(16777216);function wt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function yt(n){return-1==n.h}function be(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new te(t,~n.h).add(Ba)}function gi(n,e){return n.add(be(e))}function zs(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function _i(n,e){this.g=n,this.h=e}function Ws(n,e){if(wt(e))throw Error("division by zero");if(wt(n))return new _i(wr,wr);if(yt(n))return e=Ws(be(n),e),new _i(be(e.g),be(e.h));if(yt(e))return e=Ws(n,be(e)),new _i(be(e.g),e.h);if(30<n.g.length){if(yt(n)||yt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Ba,r=e;0>=r.X(n);)t=Fh(t),r=Fh(r);var i=jt(t,1),s=jt(r,1);for(r=jt(r,2),t=jt(t,2);!wt(r);){var a=s.add(r);0>=a.X(n)&&(i=i.add(t),s=a),r=jt(r,1),t=jt(t,1)}return e=gi(n,i.R(e)),new _i(i,e)}for(i=wr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),a=(s=Mt(t)).R(e);yt(a)||0<a.X(n);)a=(s=Mt(t-=r)).R(e);wt(s)&&(s=Ba),i=i.add(s),n=gi(n,a)}return new _i(i,n)}function Fh(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new te(t,n.h)}function jt(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new te(i,n.h)}(F=te.prototype).ea=function(){if(yt(this))return-be(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:zl+r)*e,e*=zl}return n},F.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(wt(this))return"0";if(yt(this))return"-"+be(this).toString(n);for(var e=Mt(Math.pow(n,6)),t=this,r="";;){var i=Ws(t,e).g,s=((0<(t=gi(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(wt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},F.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},F.X=function(n){return yt(n=gi(this,n))?-1:wt(n)?0:1},F.abs=function(){return yt(this)?be(this):this},F.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=a>>>16,t[i]=(a&=65535)<<16|(s&=65535)}return new te(t,-2147483648&t[t.length-1]?-1:0)},F.R=function(n){if(wt(this)||wt(n))return wr;if(yt(this))return yt(n)?be(this).R(be(n)):be(be(this).R(n));if(yt(n))return be(this.R(be(n)));if(0>this.X(Bs)&&0>n.X(Bs))return Mt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),h=n.D(i)>>>16,d=65535&n.D(i);t[2*r+2*i]+=a*d,zs(t,2*r+2*i),t[2*r+2*i+1]+=s*d,zs(t,2*r+2*i+1),t[2*r+2*i+1]+=a*h,zs(t,2*r+2*i+1),t[2*r+2*i+2]+=s*h,zs(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new te(t,0)},F.gb=function(n){return Ws(this,n).h},F.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new te(t,this.h&n.h)},F.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new te(t,this.h|n.h)},F.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new te(t,this.h^n.h)},qs.prototype.createWebChannel=qs.prototype.g,_t.prototype.send=_t.prototype.u,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,yr.NO_ERROR=0,yr.TIMEOUT=8,yr.HTTP_ERROR=6,Pl.COMPLETE="complete",ms.EventType=ei,ei.OPEN="a",ei.CLOSE="b",ei.ERROR="c",ei.MESSAGE="d",Ne.prototype.listen=Ne.prototype.O,Ae.prototype.listenOnce=Ae.prototype.P,Ae.prototype.getLastError=Ae.prototype.Sa,Ae.prototype.getLastErrorCode=Ae.prototype.Ia,Ae.prototype.getStatus=Ae.prototype.da,Ae.prototype.getResponseJson=Ae.prototype.Wa,Ae.prototype.getResponseText=Ae.prototype.ja,Ae.prototype.send=Ae.prototype.ha,Ae.prototype.setWithCredentials=Ae.prototype.Oa,Ot.prototype.digest=Ot.prototype.l,Ot.prototype.reset=Ot.prototype.reset,Ot.prototype.update=Ot.prototype.j,te.prototype.add=te.prototype.add,te.prototype.multiply=te.prototype.R,te.prototype.modulo=te.prototype.gb,te.prototype.compare=te.prototype.X,te.prototype.toNumber=te.prototype.ea,te.prototype.toString=te.prototype.toString,te.prototype.getBits=te.prototype.D,te.fromNumber=Mt,te.fromString=function Bl(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return be(Bl(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Mt(Math.pow(e,8)),r=wr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),a=parseInt(n.substring(i,i+s),e);8>s?(s=Mt(Math.pow(e,s)),r=r.R(s).add(Mt(a))):r=(r=r.R(t)).add(Mt(a))}return r};var Tp=At.createWebChannelTransport=function(){return new qs},mn=At.getStatEventTarget=function(){return gr()},za=At.ErrorCode=yr,Uh=At.EventType=Pl,yi=At.Event=Kt,Wl=At.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Gs=(At.FetchXmlHttpFactory=jn,At.WebChannel=ms),Wa=At.XhrIo=Ae,qh=At.Md5=Ot,gn=At.Integer=te;const Gl="@firebase/firestore";class ze{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ze.UNAUTHENTICATED=new ze(null),ze.GOOGLE_CREDENTIALS=new ze("google-credentials-uid"),ze.FIRST_PARTY=new ze("first-party-uid"),ze.MOCK_USER=new ze("mock-user");let Xn="10.7.0";const _n=new mt.Yd("@firebase/firestore");function Ht(){return _n.logLevel}function b(n,...e){if(_n.logLevel<=mt.in.DEBUG){const t=e.map(Ii);_n.debug(`Firestore (${Xn}): ${n}`,...t)}}function ye(n,...e){if(_n.logLevel<=mt.in.ERROR){const t=e.map(Ii);_n.error(`Firestore (${Xn}): ${n}`,...t)}}function tt(n,...e){if(_n.logLevel<=mt.in.WARN){const t=e.map(Ii);_n.warn(`Firestore (${Xn}): ${n}`,...t)}}function Ii(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function U(n="Unexpected state"){const e=`FIRESTORE (${Xn}) INTERNAL ASSERTION FAILED: `+n;throw ye(e),new Error(e)}function W(n,e){n||U()}function O(n,e){return n}const R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends oe.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Me{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class zh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Rr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ze.UNAUTHENTICATED))}shutdown(){}}class Wh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Gh{constructor(e){this.t=e,this.currentUser=ze.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let a=new Me;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Me,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const p=a;e.enqueueRetryable((0,S.Z)(function*(){yield p.promise,yield s(r.currentUser)}))},d=p=>{b("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(p=>d(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?d(p):(b("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Me)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(b("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(W("string"==typeof r.accessToken),new zh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return W(null===e||"string"==typeof e),new ze(e)}}class $h{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ze.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zh{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new $h(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ze.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Zl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $s{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&b("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,b("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{b("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):b("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(W("string"==typeof t.token),this.R=t.token,new Zl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Kh(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Kl{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Kh(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function H(n,e){return n<e?-1:n>e?1:0}function Pr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function jl(n){return n+"\0"}class Ie{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ie.fromMillis(Date.now())}static fromDate(e){return Ie.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ie(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ${constructor(e){this.timestamp=e}static fromTimestamp(e){return new $(e)}static min(){return new $(new Ie(0,0))}static max(){return new $(new Ie(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class vi{constructor(e,t,r){void 0===t?t=0:t>e.length&&U(),void 0===r?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===vi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof vi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ne extends vi{construct(e,t,r){return new ne(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new C(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ne(t)}static emptyPath(){return new ne([])}}const jh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ge extends vi{construct(e,t,r){return new ge(e,t,r)}static isValidIdentifier(e){return jh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ge.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ge(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new C(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new C(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new C(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===h?(a=!a,i++):"."!==h||a?(r+=h,i++):(s(),i++)}if(s(),a)throw new C(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ge(t)}static emptyPath(){return new ge([])}}class M{constructor(e){this.path=e}static fromPath(e){return new M(ne.fromString(e))}static fromName(e){return new M(ne.fromString(e).popFirst(5))}static empty(){return new M(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new M(new ne(e.slice()))}}class yn{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Ga(n){return n.fields.find(e=>2===e.kind)}function Qt(n){return n.fields.filter(e=>2!==e.kind)}yn.UNKNOWN_ID=-1;class Yt{constructor(e,t){this.fieldPath=e,this.kind=t}}class In{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new In(0,at.min())}}function Ti(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(1e9===r?new Ie(t+1,0):new Ie(t,r));return new at(i,M.empty(),e)}function Zs(n){return new at(n.readTime,n.key,-1)}class at{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new at($.min(),M.empty(),-1)}static max(){return new at($.max(),M.empty(),-1)}}function Ei(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=M.comparator(n.documentKey,e.documentKey),0!==t?t:H(n.largestBatchId,e.largestBatchId))}const Sr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Lt(n){return $a.apply(this,arguments)}function $a(){return $a=(0,S.Z)(function*(n){if(n.code!==R.FAILED_PRECONDITION||n.message!==Sr)throw n;b("LocalStore","Unexpectedly lost primary lease")}),$a.apply(this,arguments)}class E{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new E((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof E?t:E.resolve(t)}catch(t){return E.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):E.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):E.reject(t)}static resolve(e){return new E((t,r)=>{t(e)})}static reject(e){return new E((t,r)=>{r(e)})}static waitFor(e){return new E((t,r)=>{let i=0,s=0,a=!1;e.forEach(h=>{++i,h.next(()=>{++s,a&&s===i&&t()},d=>r(d))}),a=!0,s===i&&t()})}static or(e){let t=E.resolve(!1);for(const r of e)t=t.next(i=>i?E.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new E((r,i)=>{const s=e.length,a=new Array(s);let h=0;for(let d=0;d<s;d++){const p=d;t(e[p]).next(m=>{a[p]=m,++h,h===s&&r(a)},m=>i(m))}})}static doWhile(e,t){return new E((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Ks{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Me,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ai(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=Ka(r.target.error);this.V.reject(new Ai(e,i))}}static open(e,t,r,i){try{return new Ks(t,e.transaction(i,r))}catch(s){throw new Ai(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(b("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Za(t)}}class ut{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===ut.S((0,oe.z$)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return b("SimpleDb","Removing database:",e),er(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,oe.hl)())return!1;if(ut.C())return!0;const e=(0,oe.z$)(),t=ut.S(e),r=0<t&&t<10,i=ut.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,S.Z)(function*(){return t.db||(b("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{r(a.target.result)},s.onblocked=()=>{i(new Ai(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const h=a.target.error;i("VersionError"===h.name?new C(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new C(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new Ai(e,h))},s.onupgradeneeded=a=>{b("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.N(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{b("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,S.Z)(function*(){const a="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.O(e);const d=Ks.open(s.db,e,a?"readonly":"readwrite",r),p=i(d).next(m=>(d.g(),m)).catch(m=>(d.abort(m),E.reject(m))).toPromise();return p.catch(()=>{}),yield d.m,p}catch(d){const p=d,m="FirebaseError"!==p.name&&h<3;if(b("SimpleDb","Transaction failed with error:",p.message,"Retrying:",m),s.close(),!m)return Promise.reject(p)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Hl{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return er(this.k.delete())}}class Ai extends C{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Tn(n){return"IndexedDbTransactionError"===n.name}class Za{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(b("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(b("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),er(r)}add(e){return b("SimpleDb","ADD",this.store.name,e,e),er(this.store.add(e))}get(e){return er(this.store.get(e)).next(t=>(void 0===t&&(t=null),b("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return b("SimpleDb","DELETE",this.store.name,e),er(this.store.delete(e))}count(){return b("SimpleDb","COUNT",this.store.name),er(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.G(i,(a,h)=>{s.push(h)}).next(()=>s)}{const i=this.store.getAll(r.range);return new E((s,a)=>{i.onerror=h=>{a(h.target.error)},i.onsuccess=h=>{s(h.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new E((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}H(e,t){b("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,a,h)=>h.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new E((r,i)=>{t.onerror=s=>{const a=Ka(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(h=>{h?a.continue():r()}):r()}})}G(e,t){const r=[];return new E((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const h=a.target.result;if(!h)return void i();const d=new Hl(h),p=t(h.primaryKey,h.value,d);if(p instanceof E){const m=p.catch(_=>(d.done(),E.reject(_)));r.push(m)}d.isDone?i():null===d.$?h.continue():h.continue(d.$)}}).next(()=>E.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function er(n){return new E((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Ka(r.target.error);t(i)}})}let js=!1;function Ka(n){const e=ut.S((0,oe.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return js||(js=!0,setTimeout(()=>{throw r},0)),r}}return n}class ja{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var t=this;b("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,S.Z)(function*(){t.task=null;try{b("IndexBackiller",`Documents written: ${yield t.X.te()}`)}catch(r){Tn(r)?b("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Lt(r)}yield t.ee(6e4)}))}}class Ha{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){var t=this;return(0,S.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.ne(r,e))})()}ne(e,t){const r=new Set;let i=t,s=!0;return E.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!r.has(a))return b("IndexBackiller",`Processing collection: ${a}`),this.re(e,a,i).next(h=>{i-=h,r.add(a)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.ie(i,s)).next(h=>(b("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>a.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const a=Zs(s);Ei(a,r)>0&&(r=a)}),new at(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let lt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Jt(n){return null==n}function wi(n){return 0===n&&1/n==-1/0}function Ql(n){return"number"==typeof n&&Number.isInteger(n)&&!wi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function We(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Hs(e)),e=Qa(n.get(t),e);return Hs(e)}function Qa(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Hs(n){return n+"\x01\x01"}function Ft(n){const e=n.length;if(W(e>=2),2===e)return W("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ne.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf("\x01",s);switch((a<0||a>t)&&U(),n.charAt(a+1)){case"\x01":const h=n.substring(s,a);let d;0===i.length?d=h:(i+=h,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,a),i+="\0";break;case"\x11":i+=n.substring(s,a+1);break;default:U()}s=a+2}return new ne(r)}const Qs=["userId","batchId"];function Ri(n,e){return[n,We(e)]}function Ya(n,e,t){return[n,We(e),t]}const Yh={},Jh=["prefixPath","collectionGroup","readTime","documentId"],Ja=["prefixPath","collectionGroup","documentId"],Xh=["collectionGroup","readTime","prefixPath","documentId"],ed=["canonicalId","targetId"],Xa=["targetId","path"],td=["path","targetId"],nd=["collectionId","parent"],eu=["indexId","uid"],rd=["uid","sequenceNumber"],tu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ys=["indexId","uid","orderedDocumentKey"],nu=["userId","collectionPath","documentId"],Yl=["userId","collectionPath","largestBatchId"],ru=["userId","collectionGroup","largestBatchId"],Jl=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Xl=[...Jl,"documentOverlays"],iu=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],su=iu,id=[...su,"indexConfiguration","indexState","indexEntries"];class Js extends vn{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function xe(n,e){const t=O(n);return ut.M(t.ae,e)}function ec(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function En(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function tc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class le{constructor(e,t){this.comparator=e,this.root=t||Ze.EMPTY}insert(e,t){return new le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ze.BLACK,null,null))}remove(e){return new le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ze.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xs(this.root,e,this.comparator,!0)}}class Xs{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ze{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:Ze.RED,this.left=null!=i?i:Ze.EMPTY,this.right=null!=s?s:Ze.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Ze(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ze.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Ze.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ze.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ze.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();const e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}}Ze.EMPTY=null,Ze.RED=!0,Ze.BLACK=!1,Ze.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ze(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ae{constructor(e){this.comparator=e,this.data=new le(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nc(this.data.getIterator())}getIteratorFrom(e){return new nc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ae)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ae(this.comparator);return t.data=e,t}}class nc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Xt(n){return n.hasNext()?n.getNext():void 0}class nt{constructor(e){this.fields=e,e.sort(ge.comparator)}static empty(){return new nt([])}unionWith(e){let t=new ae(ge.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new nt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Pr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class rc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Le{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new rc("Invalid base64 string: "+s):s}}(e);return new Le(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Le(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Le.EMPTY_BYTE_STRING=new Le("");const od=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function An(n){if(W(!!n),"string"==typeof n){let e=0;const t=od.exec(n);if(W(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function en(n){return"string"==typeof n?Le.fromBase64String(n):Le.fromUint8Array(n)}function Cr(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function eo(n){const e=n.mapValue.fields.__previous_value__;return Cr(e)?eo(e):e}function Pi(n){const e=An(n.mapValue.fields.__local_write_time__.timestampValue);return new Ie(e.seconds,e.nanos)}class ad{constructor(e,t,r,i,s,a,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=h,this.longPollingOptions=d,this.useFetchStreams=p}}class wn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new wn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof wn&&e.projectId===this.projectId&&e.database===this.database}}const Rn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Si={nullValue:"NULL_VALUE"};function Pn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Cr(n)?4:so(n)?9007199254740991:10:U()}function Ut(n,e){if(n===e)return!0;const t=Pn(n);if(t!==Pn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Pi(n).isEqual(Pi(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=An(i.timestampValue),h=An(s.timestampValue);return a.seconds===h.seconds&&a.nanos===h.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,en(n.bytesValue).isEqual(en(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return we(i.geoPointValue.latitude)===we(s.geoPointValue.latitude)&&we(i.geoPointValue.longitude)===we(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return we(i.integerValue)===we(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=we(i.doubleValue),h=we(s.doubleValue);return a===h?wi(a)===wi(h):isNaN(a)&&isNaN(h)}return!1}(n,e);case 9:return Pr(n.arrayValue.values||[],e.arrayValue.values||[],Ut);case 10:return function(i,s){const a=i.mapValue.fields||{},h=s.mapValue.fields||{};if(ec(a)!==ec(h))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(void 0===h[d]||!Ut(a[d],h[d])))return!1;return!0}(n,e);default:return U()}var s}function Ci(n,e){return void 0!==(n.values||[]).find(t=>Ut(t,e))}function Sn(n,e){if(n===e)return 0;const t=Pn(n),r=Pn(e);if(t!==r)return H(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,e.booleanValue);case 2:return function(s,a){const h=we(s.integerValue||s.doubleValue),d=we(a.integerValue||a.doubleValue);return h<d?-1:h>d?1:h===d?0:isNaN(h)?isNaN(d)?0:-1:1}(n,e);case 3:return ic(n.timestampValue,e.timestampValue);case 4:return ic(Pi(n),Pi(e));case 5:return H(n.stringValue,e.stringValue);case 6:return function(s,a){const h=en(s),d=en(a);return h.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const h=s.split("/"),d=a.split("/");for(let p=0;p<h.length&&p<d.length;p++){const m=H(h[p],d[p]);if(0!==m)return m}return H(h.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const h=H(we(s.latitude),we(a.latitude));return 0!==h?h:H(we(s.longitude),we(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,a){const h=s.values||[],d=a.values||[];for(let p=0;p<h.length&&p<d.length;++p){const m=Sn(h[p],d[p]);if(m)return m}return H(h.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===Rn.mapValue&&a===Rn.mapValue)return 0;if(s===Rn.mapValue)return 1;if(a===Rn.mapValue)return-1;const h=s.fields||{},d=Object.keys(h),p=a.fields||{},m=Object.keys(p);d.sort(),m.sort();for(let _=0;_<d.length&&_<m.length;++_){const v=H(d[_],m[_]);if(0!==v)return v;const A=Sn(h[d[_]],p[m[_]]);if(0!==A)return A}return H(d.length,m.length)}(n.mapValue,e.mapValue);default:throw U()}}function ic(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return H(n,e);const t=An(n),r=An(e),i=H(t.seconds,r.seconds);return 0!==i?i:H(t.nanos,r.nanos)}function Cn(n){return bi(n)}function bi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=An(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?en(n.bytesValue).toBase64():"referenceValue"in n?M.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=bi(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${bi(t.fields[a])}`;return i+"}"}(n.mapValue):U()}function tn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ou(n){return!!n&&"integerValue"in n}function br(n){return!!n&&"arrayValue"in n}function sc(n){return!!n&&"nullValue"in n}function no(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ro(n){return!!n&&"mapValue"in n}function io(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return En(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=io(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=io(n.arrayValue.values[t]);return e}return Object.assign({},n)}function so(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function oc(n){return"nullValue"in n?Si:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?tn(wn.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:U()}function oo(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?tn(wn.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Rn:U()}function au(n,e){const t=Sn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function uu(n,e){const t=Sn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Ke{constructor(e){this.value=e}static empty(){return new Ke({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ro(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=io(t)}setAll(e){let t=ge.emptyPath(),r={},i=[];e.forEach((a,h)=>{if(!t.isImmediateParentOf(h)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=h.popLast()}a?r[h.lastSegment()]=io(a):i.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());ro(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ut(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ro(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){En(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Ke(io(this.value))}}function ac(n){const e=[];return En(n.fields,(t,r)=>{const i=new ge([t]);if(ro(r)){const s=ac(r.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new nt(e)}class _e{constructor(e,t,r,i,s,a,h){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=h}static newInvalidDocument(e){return new _e(e,0,$.min(),$.min(),$.min(),Ke.empty(),0)}static newFoundDocument(e,t,r,i){return new _e(e,1,t,$.min(),r,i,0)}static newNoDocument(e,t){return new _e(e,2,t,$.min(),$.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new _e(e,3,t,$.min(),$.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof _e&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class bn{constructor(e,t){this.position=e,this.inclusive=t}}function uc(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(r=s.field.isKeyField()?M.comparator(M.fromName(a.referenceValue),t.key):Sn(a,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function lu(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ut(n.position[t],e.position[t]))return!1;return!0}class xi{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ap(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class xn{}class ee extends xn{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new du(e,t,r):"array-contains"===t?new cd(e,r):"in"===t?new fc(e,r):"not-in"===t?new pc(e,r):"array-contains-any"===t?new fu(e,r):new ee(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ud(e,r):new ld(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Sn(t,this.value)):null!==t&&Pn(this.value)===Pn(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ue extends xn{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new ue(e,t)}matches(e){return Vn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Vn(n){return"and"===n.op}function cu(n){return"or"===n.op}function Vi(n){return lc(n)&&Vn(n)}function lc(n){for(const e of n.filters)if(e instanceof ue)return!1;return!0}function hu(n){if(n instanceof ee)return n.field.canonicalString()+n.op.toString()+Cn(n.value);if(Vi(n))return n.filters.map(e=>hu(e)).join(",");{const e=n.filters.map(t=>hu(t)).join(",");return`${n.op}(${e})`}}function ao(n,e){return n instanceof ee?(r=n,(i=e)instanceof ee&&r.op===i.op&&r.field.isEqual(i.field)&&Ut(r.value,i.value)):n instanceof ue?function(r,i){return i instanceof ue&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,a,h)=>s&&ao(a,i.filters[h]),!0)}(n,e):void U();var r,i}function cc(n,e){const t=n.filters.concat(e);return ue.create(t,n.op)}function hc(n){return n instanceof ee?`${(t=n).field.canonicalString()} ${t.op} ${Cn(t.value)}`:n instanceof ue?function(t){return t.op.toString()+" {"+t.getFilters().map(hc).join(" ,")+"}"}(n):"Filter";var t}class du extends ee{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){const t=M.comparator(e.key,this.key);return this.matchesComparison(t)}}class ud extends ee{constructor(e,t){super(e,"in",t),this.keys=dc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ld extends ee{constructor(e,t){super(e,"not-in",t),this.keys=dc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function dc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}class cd extends ee{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return br(t)&&Ci(t.arrayValue,this.value)}}class fc extends ee{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ci(this.value.arrayValue,t)}}class pc extends ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ci(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ci(this.value.arrayValue,t)}}class fu extends ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!br(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ci(this.value.arrayValue,r))}}class hd{constructor(e,t=null,r=[],i=[],s=null,a=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=h,this.ce=null}}function pu(n,e=null,t=[],r=[],i=null,s=null,a=null){return new hd(n,e,t,r,i,s,a)}function nn(n){const e=O(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>hu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Jt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Cn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Cn(r)).join(",")),e.ce=t}return e.ce}function tr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Ap(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ao(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lu(n.startAt,e.startAt)&&lu(n.endAt,e.endAt)}function uo(n){return M.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function lo(n,e){return n.filters.filter(t=>t instanceof ee&&t.field.isEqual(e))}function Di(n,e,t){let r=Si,i=!0;for(const s of lo(n,e)){let a=Si,h=!0;switch(s.op){case"<":case"<=":a=oc(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,h=!1;break;case"!=":case"not-in":a=Si}au({value:r,inclusive:i},{value:a,inclusive:h})<0&&(r=a,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];au({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}function mc(n,e,t){let r=Rn,i=!0;for(const s of lo(n,e)){let a=Rn,h=!0;switch(s.op){case">=":case">":a=oo(s.value),h=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,h=!1;break;case"!=":case"not-in":a=Rn}uu({value:r,inclusive:i},{value:a,inclusive:h})>0&&(r=a,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];uu({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}return{value:r,inclusive:i}}class rn{constructor(e,t=null,r=[],i=[],s=null,a="F",h=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=h,this.endAt=d,this.le=null,this.he=null,this.Pe=null}}function gc(n,e,t,r,i,s,a,h){return new rn(n,e,t,r,i,s,a,h)}function nr(n){return new rn(n)}function _c(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function mu(n){return null!==n.collectionGroup}function xr(n){const e=O(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let h=new ae(ge.comparator);return a.filters.forEach(d=>{d.getFlattenedFilters().forEach(p=>{p.isInequality()&&(h=h.add(p.field))})}),h})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new xi(s,r))}),t.has(ge.keyField().canonicalString())||e.le.push(new xi(ge.keyField(),r))}return e.le}function Ye(n){const e=O(n);return e.he||(e.he=function Vr(n,e){if("F"===n.limitType)return pu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new xi(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new bn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new bn(n.startAt.position,n.startAt.inclusive):null;return pu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,xr(n))),e.he}function gu(n,e){const t=n.filters.concat([e]);return new rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ni(n,e,t){return new rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ki(n,e){return tr(Ye(n),Ye(e))&&n.limitType===e.limitType}function yc(n){return`${nn(Ye(n))}|lt:${n.limitType}`}function Dr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>hc(i)).join(", ")}]`),Jt(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Cn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Cn(i)).join(",")),`Target(${r})`}(Ye(n))}; limitType=${n.limitType})`}function Oi(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):M.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of xr(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(a,h,d){const p=uc(a,h,d);return a.inclusive?p<=0:p<0}(r.startAt,xr(r),i)||r.endAt&&!function(a,h,d){const p=uc(a,h,d);return a.inclusive?p>=0:p>0}(r.endAt,xr(r),i)));var r,i}function _u(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function co(n){return(e,t)=>{let r=!1;for(const i of xr(n)){const s=yu(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function yu(n,e,t){const r=n.field.isKeyField()?M.comparator(e.key,t.key):function(s,a,h){const d=a.data.field(s),p=h.data.field(s);return null!==d&&null!==p?Sn(d,p):U()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}class qt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){En(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return tc(this.inner)}size(){return this.innerSize}}const dd=new le(M.comparator);function He(){return dd}const Ic=new le(M.comparator);function je(...n){let e=Ic;for(const t of n)e=e.insert(t.key,t);return e}function Nr(n){let e=Ic;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Rt(){return rr()}function vc(){return rr()}function rr(){return new qt(n=>n.toString(),(n,e)=>n.isEqual(e))}const Iu=new le(M.comparator),fd=new ae(M.comparator);function Y(...n){let e=fd;for(const t of n)e=e.add(t);return e}const pd=new ae(H);function Bt(){return pd}function vu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wi(e)?"-0":e}}function Tc(n){return{integerValue:""+n}}function Ec(n,e){return Ql(e)?Tc(e):vu(n,e)}class ho{constructor(){this._=void 0}}function Ac(n,e,t){return n instanceof Dn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Cr(s)&&(s=eo(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof ir?zt(n,e):n instanceof Pt?Tu(n,e):function(i,s){const a=fo(i,s),h=wc(a)+wc(i.Ie);return ou(a)&&ou(i.Ie)?Tc(h):vu(i.serializer,h)}(n,e)}function rt(n,e,t){return n instanceof ir?zt(n,e):n instanceof Pt?Tu(n,e):t}function fo(n,e){return n instanceof sr?ou(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Dn extends ho{}class ir extends ho{constructor(e){super(),this.elements=e}}function zt(n,e){const t=po(e);for(const r of n.elements)t.some(i=>Ut(i,r))||t.push(r);return{arrayValue:{values:t}}}class Pt extends ho{constructor(e){super(),this.elements=e}}function Tu(n,e){let t=po(e);for(const r of n.elements)t=t.filter(i=>!Ut(i,r));return{arrayValue:{values:t}}}class sr extends ho{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function wc(n){return we(n.integerValue||n.doubleValue)}function po(n){return br(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Mi{constructor(e,t){this.field=e,this.transform=t}}class gd{constructor(e,t){this.version=e,this.transformResults=t}}class ve{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ve}static exists(e){return new ve(void 0,e)}static updateTime(e){return new ve(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function l(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class o{}function u(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new ce(n.key,ve.none()):new T(n.key,n.data,ve.none());{const t=n.data,r=Ke.empty();let i=new ae(ge.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?r.delete(s):r.set(s,a),i=i.add(s)}return new P(n.key,r,new nt(i.toArray()),ve.none())}}function c(n,e,t){n instanceof T?function(i,s,a){const h=i.value.clone(),d=B(i.fieldTransforms,s,a.transformResults);h.setAll(d),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):n instanceof P?function(i,s,a){if(!l(i.precondition,s))return void s.convertToUnknownDocument(a.version);const h=B(i.fieldTransforms,s,a.transformResults),d=s.data;d.setAll(L(i)),d.setAll(h),s.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function f(n,e,t,r){return n instanceof T?function(s,a,h,d){if(!l(s.precondition,a))return h;const p=s.value.clone(),m=z(s.fieldTransforms,d,a);return p.setAll(m),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),null}(n,e,t,r):n instanceof P?function(s,a,h,d){if(!l(s.precondition,a))return h;const p=z(s.fieldTransforms,d,a),m=a.data;return m.setAll(L(s)),m.setAll(p),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null===h?null:h.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(_=>_.field))}(n,e,t,r):(h=t,l(n.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):h);var a,h}function g(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=fo(r.transform,i||null);null!=s&&(null===t&&(t=Ke.empty()),t.set(r.field,s))}return t||null}function y(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Pr(r,i,(s,a)=>function md(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof ir&&i instanceof ir||r instanceof Pt&&i instanceof Pt?Pr(r.elements,i.elements,Ut):r instanceof sr&&i instanceof sr?Ut(r.Ie,i.Ie):r instanceof Dn&&i instanceof Dn);var r,i}(s,a))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class T extends o{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class P extends o{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function L(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function B(n,e,t){const r=new Map;W(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,h=e.data.field(s.field);r.set(s.field,rt(a,h,t[i]))}return r}function z(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,Ac(s,a,e))}return r}class ce extends o{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ct extends o{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class kr{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&c(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=f(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=f(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=vc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let h=this.applyToLocalView(a,s.mutatedFields);h=t.has(i.key)?null:h;const d=u(a,h);null!==d&&r.set(i.key,d),a.isValidDocument()||a.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&Pr(this.mutations,e.mutations,(t,r)=>y(t,r))&&Pr(this.baseMutations,e.baseMutations,(t,r)=>y(t,r))}}class mo{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){W(e.mutations.length===r.length);let i=Iu;const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new mo(e,t,r,i)}}class Li{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Pc{constructor(e,t){this.count=e,this.unchangedNames=t}}var Re,re;function Eu(n){switch(n){default:return U();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function go(n){if(void 0===n)return ye("GRPC error has no .code"),R.UNKNOWN;switch(n){case Re.OK:return R.OK;case Re.CANCELLED:return R.CANCELLED;case Re.UNKNOWN:return R.UNKNOWN;case Re.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case Re.INTERNAL:return R.INTERNAL;case Re.UNAVAILABLE:return R.UNAVAILABLE;case Re.UNAUTHENTICATED:return R.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case Re.NOT_FOUND:return R.NOT_FOUND;case Re.ALREADY_EXISTS:return R.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return R.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case Re.ABORTED:return R.ABORTED;case Re.OUT_OF_RANGE:return R.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return R.UNIMPLEMENTED;case Re.DATA_LOSS:return R.DATA_LOSS;default:return U()}}(re=Re||(Re={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";function Sc(){return new TextEncoder}const Au=new gn([4294967295,4294967295],0);function Cc(n){const e=Sc().encode(n),t=new qh;return t.update(e),new Uint8Array(t.digest())}function wp(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new gn([t,r],0),new gn([i,s],0)]}class _d{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new wu(`Invalid padding: ${t}`);if(r<0)throw new wu(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new wu(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new wu(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=gn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(gn.fromNumber(r)));return 1===i.compare(Au)&&(i=new gn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=Cc(e),[r,i]=wp(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);if(!this.Ae(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new _d(s,i,t);return r.forEach(h=>a.insert(h)),a}insert(e){if(0===this.Te)return;const t=Cc(e),[r,i]=wp(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);this.Re(a)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class wu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ru{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Pu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ru($.min(),i,new le(H),He(),Y())}}class Pu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Pu(r,t,Y(),Y(),Y())}}class bc{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class Rp{constructor(e,t){this.targetId=e,this.fe=t}}class Pp{constructor(e,t,r=Le.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Sp{constructor(){this.ge=0,this.pe=bp(),this.ye=Le.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=Y(),t=Y(),r=Y();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new Pu(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=bp()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,W(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class e_{constructor(e){this.Le=e,this.ke=new Map,this.qe=He(),this.Qe=Cp(),this.Ke=new le(H)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(uo(s))if(0===r){const a=new M(s.path);this.We(t,a,_e.newNoDocument(a,$.min()))}else W(1===r);else{const a=this.Ze(t);if(a!==r){const h=this.Xe(e),d=h?this.et(h,e,a):1;0!==d&&(this.He(t),this.Ke=this.Ke.insert(t,2===d?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,h;try{a=en(r).toUint8Array()}catch(d){if(d instanceof rc)return tt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{h=new _d(a,i,s)}catch(d){return tt(d instanceof wu?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return 0===h.Te?null:h}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.Le.nt(),h=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(h)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,a)=>{const h=this.Ye(a);if(h){if(s.current&&uo(h.target)){const d=new M(h.target.path);null!==this.qe.get(d)||this.st(a,d)||this.We(a,d,_e.newNoDocument(d,e))}s.De&&(t.set(a,s.ve()),s.Fe())}});let r=Y();this.Qe.forEach((s,a)=>{let h=!0;a.forEachWhile(d=>{const p=this.Ye(d);return!p||"TargetPurposeLimboResolution"===p.purpose||(h=!1,!1)}),h&&(r=r.add(s))}),this.qe.forEach((s,a)=>a.setReadTime(e));const i=new Ru(e,t,this.Ke,this.qe,r);return this.qe=He(),this.Qe=Cp(),this.Ke=new le(H),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Sp,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new ae(H),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||b("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Sp),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Cp(){return new le(M.comparator)}function bp(){return new le(M.comparator)}const t_={asc:"ASCENDING",desc:"DESCENDING"},n_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},r_={and:"AND",or:"OR"};class i_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yd(n,e){return n.useProto3Json||Jt(e)?e:{value:e}}function _o(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function s_(n,e){return _o(n,e.toTimestamp())}function Fe(n){return W(!!n),$.fromTimestamp(function(t){const r=An(t);return new Ie(r.seconds,r.nanos)}(n))}function Id(n,e){return(r=n,new ne(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function Vp(n){const e=ne.fromString(n);return W(qp(e)),e}function Su(n,e){return Id(n.databaseId,e.path)}function Nn(n,e){const t=Vp(e);if(t.get(1)!==n.databaseId.projectId)throw new C(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new C(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(Np(t))}function vd(n,e){return Id(n.databaseId,e)}function Dp(n){const e=Vp(n);return 4===e.length?ne.emptyPath():Np(e)}function Cu(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Np(n){return W(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function kp(n,e,t){return{name:Su(n,e),fields:t.value.mapValue.fields}}function Op(n,e,t){const r=Nn(n,e.name),i=Fe(e.updateTime),s=e.createTime?Fe(e.createTime):$.min(),a=new Ke({mapValue:{fields:e.fields}}),h=_e.newFoundDocument(r,i,s,a);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function bu(n,e){let t;if(e instanceof T)t={update:kp(n,e.key,e.value)};else if(e instanceof ce)t={delete:Su(n,e.key)};else if(e instanceof P)t={update:kp(n,e.key,e.data),updateMask:f_(e.fieldMask)};else{if(!(e instanceof ct))return U();t={verify:Su(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const h=a.transform;if(h instanceof Dn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof ir)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof Pt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof sr)return{fieldPath:a.field.canonicalString(),increment:h.Ie};throw U()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:s_(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:U()),t;var s}function Td(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ve.updateTime(Fe(s.updateTime)):void 0!==s.exists?ve.exists(s.exists):ve.none():ve.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(a,h){let d=null;"setToServerValue"in h?(W("REQUEST_TIME"===h.setToServerValue),d=new Dn):"appendMissingElements"in h?d=new ir(h.appendMissingElements.values||[]):"removeAllFromArray"in h?d=new Pt(h.removeAllFromArray.values||[]):"increment"in h?d=new sr(a,h.increment):U();const p=ge.fromServerFormat(h.fieldPath);return new Mi(p,d)}(n,i)):[];var s;if(e.update){const i=Nn(n,e.update.name),s=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new nt((e.updateMask.fieldPaths||[]).map(m=>ge.fromServerFormat(m)));return new P(i,s,a,t,r)}return new T(i,s,t,r)}if(e.delete){const i=Nn(n,e.delete);return new ce(i,t)}if(e.verify){const i=Nn(n,e.verify);return new ct(i,t)}return U()}function Mp(n,e){return{documents:[vd(n,e.path)]}}function Ed(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=vd(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=vd(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0!==d.length)return Up(ue.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(p=>{return{field:Or((_=p).field),direction:c_(_.dir)};var _})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=yd(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),t;var d}function Lp(n){let e=Dp(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){W(1===r);const m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=function(_){const v=Fp(_);return v instanceof ue&&Vi(v)?v.getFilters():[v]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(v=>{return new xi(yo((V=v).field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction));var V}));let h=null;t.limit&&(h=function(_){let v;return v="object"==typeof _?_.value:_,Jt(v)?null:v}(t.limit));let d=null;var _;t.startAt&&(d=new bn((_=t.startAt).values||[],!!_.before));let p=null;return t.endAt&&(p=function(_){return new bn(_.values||[],!_.before)}(t.endAt)),gc(e,i,a,s,h,"F",d,p)}function Fp(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=yo(t.unaryFilter.field);return ee.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=yo(t.unaryFilter.field);return ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=yo(t.unaryFilter.field);return ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=yo(t.unaryFilter.field);return ee.create(a,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):void 0!==n.fieldFilter?ee.create(yo((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return ue.create(t.compositeFilter.filters.map(r=>Fp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(n):U();var t}function c_(n){return t_[n]}function h_(n){return n_[n]}function d_(n){return r_[n]}function Or(n){return{fieldPath:n.canonicalString()}}function yo(n){return ge.fromServerFormat(n.fieldPath)}function Up(n){return n instanceof ee?function(t){if("=="===t.op){if(no(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NAN"}};if(sc(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(no(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NOT_NAN"}};if(sc(t.value))return{unaryFilter:{field:Or(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Or(t.field),op:h_(t.op),value:t.value}}}(n):n instanceof ue?function(t){const r=t.getFilters().map(i=>Up(i));return 1===r.length?r[0]:{compositeFilter:{op:d_(t.op),filters:r}}}(n):U()}function f_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function qp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class or{constructor(e,t,r,i,s=$.min(),a=$.min(),h=Le.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=h,this.expectedCount=d}withSequenceNumber(e){return new or(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new or(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Bp{constructor(e){this.ut=e}}function zp(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:xc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Su(s=n.ut,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:_o(s,a.version.toTimestamp()),createTime:_o(s,a.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ui(e.version)};else{if(!e.isUnknownDocument())return U();r.unknownDocument={path:t.path.toArray(),version:Ui(e.version)}}var s,a;return r}function xc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ui(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qi(n){const e=new Ie(n.seconds,n.nanoseconds);return $.fromTimestamp(e)}function Bi(n,e){const t=(e.baseMutations||[]).map(s=>Td(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Td(n.ut,s)),i=Ie.fromMillis(e.localWriteTimeMs);return new kr(e.batchId,i,t,r)}function xu(n){const e=qi(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?qi(n.lastLimboFreeSnapshotVersion):$.min();let r;return r=void 0!==n.query.documents?(W(1===(s=n.query).documents.length),Ye(nr(Dp(s.documents[0])))):function(s){return Ye(Lp(s))}(n.query),new or(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Le.fromBase64String(n.resumeToken));var s}function Wp(n,e){const t=Ui(e.snapshotVersion),r=Ui(e.lastLimboFreeSnapshotVersion);let i;i=uo(e.target)?Mp(n.ut,e.target):Ed(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:nn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ad(n){const e=Lp({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Ni(e,e.limit,"L"):e}function wd(n,e){return new Li(e.largestBatchId,Td(n.ut,e.overlayMutation))}function Gp(n,e){const t=e.path.lastSegment();return[n,We(e.path.popLast()),t]}function $p(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Ui(r.readTime),documentKey:We(r.documentKey.path),largestBatchId:r.largestBatchId}}class m_{getBundleMetadata(e,t){return Zp(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:qi(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Zp(e).put({bundleId:(i=t).id,createTime:Ui(Fe(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Kp(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Ad(s.bundledQuery),readTime:qi(s.readTime)};var s})}saveNamedQuery(e,t){return Kp(e).put({name:(i=t).name,readTime:Ui(Fe(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Zp(n){return xe(n,"bundles")}function Kp(n){return xe(n,"namedQueries")}class Vc{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new Vc(e,t.uid||"")}getOverlay(e,t){return Vu(e).get(Gp(this.userId,t)).next(r=>r?wd(this.serializer,r):null)}getOverlays(e,t){const r=Rt();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,a)=>{const h=new Li(t,a);i.push(this.lt(e,h))}),E.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(a=>i.add(We(a.getCollectionPath())));const s=[];return i.forEach(a=>{const h=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(Vu(e).H("collectionPathOverlayIndex",h))}),E.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Rt(),s=We(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Vu(e).W("collectionPathOverlayIndex",a).next(h=>{for(const d of h){const p=wd(this.serializer,d);i.set(p.getKey(),p)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Rt();let a;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Vu(e).Y({index:"collectionGroupOverlayIndex",range:h},(d,p,m)=>{const _=wd(this.serializer,p);s.size()<i||_.largestBatchId===a?(s.set(_.getKey(),_),a=_.largestBatchId):m.done()}).next(()=>s)}lt(e,t){return Vu(e).put(function(i,s,a){const[h,d,p]=Gp(s,a.mutation.key);return{userId:s,collectionPath:d,documentId:p,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:bu(i.ut,a.mutation)}}(this.serializer,this.userId,t))}}function Vu(n){return xe(n,"documentOverlays")}class zi{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(we(e.integerValue));else if("doubleValue"in e){const r=we(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),wi(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),"string"==typeof r?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(en(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?so(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):U()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),M.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function g_(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function jp(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const a=g_(255&r[s]);if(i+=a,8!==a)break}return i}(n);return Math.ceil(e/8)}zi.St=new zi;class __{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=jp(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=jp(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class y_{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class I_{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Du{constructor(){this.Wt=new __,this.Gt=new y_(this.Wt),this.zt=new I_(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class Wi{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Wi(this.indexId,this.documentKey,this.arrayValue,r)}}function Mr(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Hp(n.arrayValue,e.arrayValue),0!==t?t:(t=Hp(n.directionalValue,e.directionalValue),0!==t?t:M.comparator(n.documentKey,e.documentKey)))}function Hp(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Qp{constructor(e){this.Jt=new ae((t,r)=>ge.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(W(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Ga(e);if(void 0!==t&&!this.tn(t))return!1;const r=Qt(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const h=this.Jt.getIterator().getNext();if(!i.has(h.field.canonicalString())){const d=r[s];if(!this.nn(h,d)||!this.rn(this.Yt[a++],d))return!1}++s}for(;s<r.length;++s)if(a>=this.Yt.length||!this.rn(this.Yt[a++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new ae(ge.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new Yt(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Yt(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Yt(r.field,"asc"===r.dir?0:1)));return new yn(yn.UNKNOWN_ID,this.collectionId,t,In.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Yp(n){var e,t;if(W(n instanceof ee||n instanceof ue),n instanceof ee){if(n instanceof fc){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>ee.create(n.field,"==",s)))||[];return ue.create(i,"or")}return n}const r=n.filters.map(i=>Yp(i));return ue.create(r,n.op)}function v_(n){if(0===n.getFilters().length)return[];const e=Sd(Yp(n));return W(Jp(e)),Rd(e)||Pd(e)?[e]:e.getFilters()}function Rd(n){return n instanceof ee}function Pd(n){return n instanceof ue&&Vi(n)}function Jp(n){return Rd(n)||Pd(n)||function(t){if(t instanceof ue&&cu(t)){for(const r of t.getFilters())if(!Rd(r)&&!Pd(r))return!1;return!0}return!1}(n)}function Sd(n){if(W(n instanceof ee||n instanceof ue),n instanceof ee)return n;if(1===n.filters.length)return Sd(n.filters[0]);const e=n.filters.map(r=>Sd(r));let t=ue.create(e,n.op);return t=Dc(t),Jp(t)?t:(W(t instanceof ue),W(Vn(t)),W(t.filters.length>1),t.filters.reduce((r,i)=>Cd(r,i)))}function Cd(n,e){let t;return W(n instanceof ee||n instanceof ue),W(e instanceof ee||e instanceof ue),t=n instanceof ee?e instanceof ee?ue.create([n,e],"and"):Xp(n,e):e instanceof ee?Xp(e,n):function(i,s){if(W(i.filters.length>0&&s.filters.length>0),Vn(i)&&Vn(s))return cc(i,s.getFilters());const a=cu(i)?i:s,h=cu(i)?s:i,d=a.filters.map(p=>Cd(p,h));return ue.create(d,"or")}(n,e),Dc(t)}function Xp(n,e){if(Vn(e))return cc(e,n.getFilters());{const t=e.filters.map(r=>Cd(n,r));return ue.create(t,"or")}}function Dc(n){if(W(n instanceof ee||n instanceof ue),n instanceof ee)return n;const e=n.getFilters();if(1===e.length)return Dc(e[0]);if(lc(n))return n;const t=e.map(i=>Dc(i)),r=[];return t.forEach(i=>{i instanceof ee?r.push(i):i instanceof ue&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:ue.create(r,n.op)}class T_{constructor(){this.on=new bd}addToCollectionParentIndex(e,t){return this.on.add(t),E.resolve()}getCollectionParents(e,t){return E.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return E.resolve()}deleteFieldIndex(e,t){return E.resolve()}deleteAllFieldIndexes(e){return E.resolve()}createTargetIndexes(e,t){return E.resolve()}getDocumentsMatchingTarget(e,t){return E.resolve(null)}getIndexType(e,t){return E.resolve(0)}getFieldIndexes(e,t){return E.resolve([])}getNextCollectionGroupToUpdate(e){return E.resolve(null)}getMinOffset(e,t){return E.resolve(at.min())}getMinOffsetFromCollectionGroup(e,t){return E.resolve(at.min())}updateCollectionGroup(e,t,r){return E.resolve()}updateIndexEntries(e,t){return E.resolve()}}class bd{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ae(ne.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ae(ne.comparator)).toArray()}}const Nc=new Uint8Array(0);class E_{constructor(e,t){this.user=e,this.databaseId=t,this._n=new bd,this.an=new qt(r=>nn(r),(r,i)=>tr(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:We(i)};return em(e).put(s)}return E.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[jl(t),""],!1,!0);return em(e).W(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;r.push(Ft(a.parent))}return r})}addFieldIndex(e,t){const r=Nu(e),i={indexId:(h=t).indexId,collectionGroup:h.collectionGroup,fields:h.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var h;delete i.indexId;const s=r.add(i);if(t.indexState){const a=vo(e);return s.next(h=>{a.put($p(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Nu(e),i=vo(e),s=Io(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Nu(e),r=Io(e),i=vo(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return E.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Qp(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Io(e);let i=!0;const s=new Map;return E.forEach(this.un(t),a=>this.cn(e,a).next(h=>{i&&(i=!!h),s.set(a,h)})).next(()=>{if(i){let a=Y();const h=[];return E.forEach(s,(d,p)=>{var K;b("IndexedDbIndexManager",`Using index ${K=d,`id=${K.indexId}|cg=${K.collectionGroup}|f=${K.fields.map(G=>`${G.fieldPath}:${G.kind}`).join(",")}`} to execute ${nn(t)}`);const m=function(K,G){const X=Ga(G);if(void 0===X)return null;for(const J of lo(K,X.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null}(p,d),_=function(K,G){const X=new Map;for(const J of Qt(G))for(const Ue of lo(K,J.fieldPath))switch(Ue.op){case"==":case"in":X.set(J.fieldPath.canonicalString(),Ue.value);break;case"not-in":case"!=":return X.set(J.fieldPath.canonicalString(),Ue.value),Array.from(X.values())}return null}(p,d),v=function(K,G){const X=[];let J=!0;for(const Ue of Qt(G)){const It=0===Ue.kind?Di(K,Ue.fieldPath,K.startAt):mc(K,Ue.fieldPath,K.startAt);X.push(It.value),J&&(J=It.inclusive)}return new bn(X,J)}(p,d),A=function(K,G){const X=[];let J=!0;for(const Ue of Qt(G)){const It=0===Ue.kind?mc(K,Ue.fieldPath,K.endAt):Di(K,Ue.fieldPath,K.endAt);X.push(It.value),J&&(J=It.inclusive)}return new bn(X,J)}(p,d),V=this.ln(d,p,v),D=this.ln(d,p,A),N=this.hn(d,p,_),q=this.Pn(d.indexId,m,V,v.inclusive,D,A.inclusive,N);return E.forEach(q,Z=>r.j(Z,t.limit).next(K=>{K.forEach(G=>{const X=M.fromSegments(G.documentKey);a.has(X)||(a=a.add(X),h.push(X))})}))}).next(()=>h)}return E.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:v_(ue.create(e.filters,"and")).map(r=>pu(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,a,h){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),p=d/(null!=t?t.length:1),m=[];for(let _=0;_<d;++_){const v=t?this.In(t[_/p]):Nc,A=this.Tn(e,v,r[_%p],i),V=this.En(e,v,s[_%p],a),D=h.map(N=>this.Tn(e,v,N,!0));m.push(...this.createRange(A,V,D))}return m}Tn(e,t,r,i){const s=new Wi(e,M.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new Wi(e,M.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new Qp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const h of s)r.en(h)&&(!a||h.fields.length>a.fields.length)&&(a=h);return a})}getIndexType(e,t){let r=2;const i=this.un(t);return E.forEach(i,s=>this.cn(e,s).next(a=>{a?0!==r&&a.fields.length<function(d){let p=new ae(ge.comparator),m=!1;for(const _ of d.filters)for(const v of _.getFlattenedFilters())v.field.isKeyField()||("array-contains"===v.op||"array-contains-any"===v.op?m=!0:p=p.add(v.field));for(const _ of d.orderBy)_.field.isKeyField()||(p=p.add(_.field));return p.size+(m?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new Du;for(const i of Qt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=r.jt(i.kind);zi.St.ht(s,a)}return r.Ut()}In(e){const t=new Du;return zi.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Du;return zi.St.ht(tn(this.databaseId,t),r.jt(function(s){const a=Qt(s);return 0===a.length?0:a[a.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new Du);let s=0;for(const a of Qt(e)){const h=r[s++];for(const d of i)if(this.Rn(t,a.fieldPath)&&br(h))i=this.Vn(i,a,h);else{const p=d.jt(a.kind);zi.St.ht(h,p)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const h of i){const d=new Du;d.seed(h.Ut()),zi.St.ht(a,d.jt(t.kind)),s.push(d)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof ee&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Nu(e),i=vo(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const a=[];return E.forEach(s,h=>i.get([h.indexId,this.uid]).next(d=>{a.push(function(m,_){const v=_?new In(_.sequenceNumber,new at(qi(_.readTime),new M(Ft(_.documentKey)),_.largestBatchId)):In.empty(),A=m.fields.map(([V,D])=>new Yt(ge.fromServerFormat(V),D));return new yn(m.indexId,m.collectionGroup,A,v)}(h,d))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:H(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Nu(e),s=vo(e);return this.fn(e).next(a=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>E.forEach(h,d=>s.put($p(d.indexId,this.user,a,r)))))}updateIndexEntries(e,t){const r=new Map;return E.forEach(t,(i,s)=>{const a=r.get(i.collectionGroup);return(a?E.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),E.forEach(h,d=>this.gn(e,i,d).next(p=>{const m=this.pn(s,d);return p.isEqual(m)?E.resolve():this.yn(e,s,d,p,m)}))))})}wn(e,t,r,i){return Io(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return Io(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=Io(e);let s=new ae(Mr);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(a,h)=>{s=s.add(new Wi(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}pn(e,t){let r=new ae(Mr);const i=this.dn(t,e);if(null==i)return r;const s=Ga(t);if(null!=s){const a=e.data.field(s.fieldPath);if(br(a))for(const h of a.arrayValue.values||[])r=r.add(new Wi(t.indexId,e.key,this.In(h),i))}else r=r.add(new Wi(t.indexId,e.key,Nc,i));return r}yn(e,t,r,i,s){b("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(d,p,m,_,v){const A=d.getIterator(),V=p.getIterator();let D=Xt(A),N=Xt(V);for(;D||N;){let q=!1,Z=!1;if(D&&N){const K=m(D,N);K<0?Z=!0:K>0&&(q=!0)}else null!=D?Z=!0:q=!0;q?(_(N),N=Xt(V)):Z?(v(D),D=Xt(A)):(D=Xt(A),N=Xt(V))}}(i,s,Mr,h=>{a.push(this.wn(e,t,r,h))},h=>{a.push(this.Sn(e,t,r,h))}),E.waitFor(a)}fn(e){let t=1;return vo(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,h)=>Mr(a,h)).filter((a,h,d)=>!h||0!==Mr(a,d[h-1]));const i=[];i.push(e);for(const a of r){const h=Mr(a,e),d=Mr(a,t);if(0===h)i[0]=e.Ht();else if(h>0&&d<0)i.push(a),i.push(a.Ht());else if(d>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.bn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Nc,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Nc,[]]))}return s}bn(e,t){return Mr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(tm)}getMinOffset(e,t){return E.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||U())).next(tm)}}function em(n){return xe(n,"collectionParents")}function Io(n){return xe(n,"indexEntries")}function Nu(n){return xe(n,"indexConfiguration")}function vo(n){return xe(n,"indexState")}function tm(n){W(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Ei(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new at(e.readTime,e.documentKey,t)}const nm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class it{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new it(e,it.DEFAULT_COLLECTION_PERCENTILE,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function rm(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let h=0;const d=r.Y({range:a},(m,_,v)=>(h++,v.delete()));s.push(d.next(()=>{W(1===h)}));const p=[];for(const m of t.mutations){const _=Ya(e,m.key.path,t.batchId);s.push(i.delete(_)),p.push(m.key)}return E.waitFor(s).next(()=>p)}function kc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}it.DEFAULT_COLLECTION_PERCENTILE=10,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,it.DEFAULT=new it(41943040,it.DEFAULT_COLLECTION_PERCENTILE,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),it.DISABLED=new it(-1,0,0);class Oc{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){W(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Oc(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Lr(e).Y({index:"userMutationsIndex",range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=To(e),a=Lr(e);return a.add({}).next(h=>{W("number"==typeof h);const d=new kr(h,t,r,i),p=function(A,V,D){const N=D.baseMutations.map(Z=>bu(A.ut,Z)),q=D.mutations.map(Z=>bu(A.ut,Z));return{userId:V,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:N,mutations:q}}(this.serializer,this.userId,d),m=[];let _=new ae((v,A)=>H(v.canonicalString(),A.canonicalString()));for(const v of i){const A=Ya(this.userId,v.key.path,h);_=_.add(v.key.path.popLast()),m.push(a.put(p)),m.push(s.put(A,Yh))}return _.forEach(v=>{m.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Dn[h]=d.keys()}),E.waitFor(m).next(()=>d)})}lookupMutationBatch(e,t){return Lr(e).get(t).next(r=>r?(W(r.userId===this.userId),Bi(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?E.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Lr(e).Y({index:"userMutationsIndex",range:i},(a,h,d)=>{h.userId===this.userId&&(W(h.batchId>=r),s=Bi(this.serializer,h)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Lr(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Lr(e).W("userMutationsIndex",t).next(r=>r.map(i=>Bi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Ri(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return To(e).Y({range:i},(a,h,d)=>{const[p,m,_]=a,v=Ft(m);if(p===this.userId&&t.path.isEqual(v))return Lr(e).get(_).next(A=>{if(!A)throw U();W(A.userId===this.userId),s.push(Bi(this.serializer,A))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ae(H);const i=[];return t.forEach(s=>{const a=Ri(this.userId,s.path),h=IDBKeyRange.lowerBound(a),d=To(e).Y({range:h},(p,m,_)=>{const[v,A,V]=p,D=Ft(A);v===this.userId&&s.path.isEqual(D)?r=r.add(V):_.done()});i.push(d)}),E.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Ri(this.userId,r),a=IDBKeyRange.lowerBound(s);let h=new ae(H);return To(e).Y({range:a},(d,p,m)=>{const[_,v,A]=d,V=Ft(v);_===this.userId&&r.isPrefixOf(V)?V.length===i&&(h=h.add(A)):m.done()}).next(()=>this.vn(e,h))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Lr(e).get(s).next(a=>{if(null===a)throw U();W(a.userId===this.userId),r.push(Bi(this.serializer,a))}))}),E.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return rm(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),E.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return E.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return To(e).Y({range:r},(s,a,h)=>{if(s[0]===this.userId){const d=Ft(s[1]);i.push(d)}else h.done()}).next(()=>{W(0===i.length)})})}containsKey(e,t){return im(e,this.userId,t)}Mn(e){return sm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function im(n,e,t){const r=Ri(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return To(n).Y({range:s,J:!0},(h,d,p)=>{const[m,_,v]=h;m===e&&_===i&&(a=!0),p.done()}).next(()=>a)}function Lr(n){return xe(n,"mutations")}function To(n){return xe(n,"documentMutations")}function sm(n){return xe(n,"mutationQueues")}class Gi{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Gi(0)}static Nn(){return new Gi(-1)}}class A_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Gi(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>$.fromTimestamp(new Ie(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Eo(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(W(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Eo(e).Y((a,h)=>{const d=xu(h);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>E.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Eo(e).Y((r,i)=>{const s=xu(i);t(s)})}Bn(e){return om(e).get("targetGlobalKey").next(t=>(W(null!==t),t))}Ln(e,t){return om(e).put("targetGlobalKey",t)}kn(e,t){return Eo(e).put(Wp(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=nn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Eo(e).Y({range:i,index:"queryTargetsIndex"},(a,h,d)=>{const p=xu(h);tr(t,p.target)&&(s=p,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Fr(e);return t.forEach(a=>{const h=We(a.path);i.push(s.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,a))}),E.waitFor(i)}removeMatchingKeys(e,t,r){const i=Fr(e);return E.forEach(t,s=>{const a=We(s.path);return E.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Fr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Fr(e);let s=Y();return i.Y({range:r,J:!0},(a,h,d)=>{const p=Ft(a[1]),m=new M(p);s=s.add(m)}).next(()=>s)}containsKey(e,t){const r=We(t.path),i=IDBKeyRange.bound([r],[jl(r)],!1,!0);let s=0;return Fr(e).Y({index:"documentTargetsIndex",J:!0,range:i},([a,h],d,p)=>{0!==a&&(s++,p.done())}).next(()=>s>0)}_t(e,t){return Eo(e).get(t).next(r=>r?xu(r):null)}}function Eo(n){return xe(n,"targets")}function om(n){return xe(n,"targetGlobal")}function Fr(n){return xe(n,"targetDocuments")}function am([n,e],[t,r]){const i=H(n,t);return 0===i?H(e,r):i}class w_{constructor(e){this.Qn=e,this.buffer=new ae(am),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();am(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class um{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;b("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,S.Z)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Tn(r)?b("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Lt(r)}yield t.Gn(3e5)}))}}class R_{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return E.resolve(lt._e);const r=new w_(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(b("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(nm)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(b("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nm):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,a,h,d,p;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(b("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,a=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,h=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(p=Date.now(),Ht()<=mt.in.DEBUG&&b("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-m}ms\n\tDetermined least recently used ${i} in `+(h-a)+`ms\n\tRemoved ${s} targets in `+(d-h)+`ms\n\tRemoved ${_} documents in `+(p-d)+`ms\nTotal Duration: ${p-m}ms`),E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}}class P_{constructor(e,t){this.db=e,this.garbageCollector=function lm(n,e){return new R_(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Mc(e,r)}removeReference(e,t,r){return Mc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Mc(e,t)}Xn(e,t){return function(i,s){let a=!1;return sm(i).Z(h=>im(i,h,s).next(d=>(d&&(a=!0),E.resolve(!d)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(a,h)=>{if(h<=t){const d=this.Xn(e,a).next(p=>{if(!p)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,$.min()),Fr(e).delete([0,We(a.path)])))});i.push(d)}}).next(()=>E.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Mc(e,t)}Zn(e,t){const r=Fr(e);let i,s=lt._e;return r.Y({index:"documentTargetsIndex"},([a,h],{path:d,sequenceNumber:p})=>{0===a?(s!==lt._e&&t(new M(Ft(i)),s),s=p,i=d):s=lt._e}).next(()=>{s!==lt._e&&t(new M(Ft(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Mc(n,e){return Fr(n).put((i=n.currentSequenceNumber,{targetId:0,path:We(e.path),sequenceNumber:i}));var i}class cm{constructor(){this.changes=new qt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_e.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?E.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class S_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return $i(e).put(r)}removeEntry(e,t,r){return $i(e).delete(function(s,a){const h=s.path.toArray();return[h.slice(0,h.length-2),h[h.length-2],xc(a),h[h.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=_e.newInvalidDocument(t);return $i(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ku(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:_e.newInvalidDocument(t)};return $i(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ku(t))},(i,s)=>{r={document:this.tr(t,s),size:kc(s)}}).next(()=>r)}getEntries(e,t){let r=He();return this.rr(e,t,(i,s)=>{const a=this.tr(i,s);r=r.insert(i,a)}).next(()=>r)}ir(e,t){let r=He(),i=new le(M.comparator);return this.rr(e,t,(s,a)=>{const h=this.tr(s,a);r=r.insert(s,h),i=i.insert(s,kc(a))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return E.resolve();let i=new ae(pm);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(ku(i.first()),ku(i.last())),a=i.getIterator();let h=a.getNext();return $i(e).Y({index:"documentKeyIndex",range:s},(d,p,m)=>{const _=M.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;h&&pm(h,_)<0;)r(h,null),h=a.getNext();h&&h.isEqual(_)&&(r(h,p),h=a.hasNext()?a.getNext():null),h?m.U(ku(h)):m.done()}).next(()=>{for(;h;)r(h,null),h=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const a=t.path,h=[a.popLast().toArray(),a.lastSegment(),xc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],d=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $i(e).W(IDBKeyRange.bound(h,d,!0)).next(p=>{null==s||s.incrementDocumentReadCount(p.length);let m=He();for(const _ of p){const v=this.tr(M.fromSegments(_.prefixPath.concat(_.collectionGroup,_.documentId)),_);v.isFoundDocument()&&(Oi(t,v)||i.has(v.key))&&(m=m.insert(v.key,v))}return m})}getAllFromCollectionGroup(e,t,r,i){let s=He();const a=fm(t,r),h=fm(t,at.max());return $i(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,h,!0)},(d,p,m)=>{const _=this.tr(M.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);s=s.insert(_.key,_),s.size===i&&m.done()}).next(()=>s)}newChangeBuffer(e){return new C_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return dm(e).get("remoteDocumentGlobalKey").next(t=>(W(!!t),t))}er(e,t){return dm(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function p_(n,e){let t;if(e.document)t=Op(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=M.fromSegments(e.noDocument.path),i=qi(e.noDocument.readTime);t=_e.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{const r=M.fromSegments(e.unknownDocument.path),i=qi(e.unknownDocument.version);t=_e.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Ie(i[0],i[1]);return $.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual($.min()))return r}return _e.newInvalidDocument(e)}}function hm(n){return new S_(n)}class C_ extends cm{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new qt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ae((s,a)=>H(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const h=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,h.readTime)),a.isValidDocument()){const d=zp(this._r.serializer,a);i=i.add(s.path.popLast());const p=kc(d);r+=p-h.size,t.push(this._r.addEntry(e,s,d))}else if(r-=h.size,this.trackRemovals){const d=zp(this._r.serializer,a.convertToNoDocument($.min()));t.push(this._r.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),E.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,a)=>{this.ar.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function dm(n){return xe(n,"remoteDocumentGlobal")}function $i(n){return xe(n,"remoteDocumentsV14")}function ku(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function fm(n,e){const t=e.documentKey.path.toArray();return[n,xc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function pm(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=H(t[s],r[s]),i)return i;return i=H(t.length,r.length),i||(i=H(t[t.length-2],r[r.length-2]),i||H(t[t.length-1],r[r.length-1]))}class b_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mm{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&f(r.mutation,i,nt.empty(),Ie.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Y()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Y()){const i=Rt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=je();return s.forEach((h,d)=>{a=a.insert(h,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Rt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Y()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,h)=>{t.set(a,h)})})}computeViews(e,t,r,i){let s=He();const a=rr(),h=rr();return t.forEach((d,p)=>{const m=r.get(p.key);i.has(p.key)&&(void 0===m||m.mutation instanceof P)?s=s.insert(p.key,p):void 0!==m?(a.set(p.key,m.mutation.getFieldMask()),f(m.mutation,p,m.mutation.getFieldMask(),Ie.now())):a.set(p.key,nt.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((p,m)=>a.set(p,m)),t.forEach((p,m)=>{var _;return h.set(p,new b_(m,null!==(_=a.get(p))&&void 0!==_?_:null))}),h))}recalculateAndSaveOverlays(e,t){const r=rr();let i=new le((a,h)=>a-h),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const h of a)h.keys().forEach(d=>{const p=t.get(d);if(null===p)return;let m=r.get(d)||nt.empty();m=h.applyToLocalView(p,m),r.set(d,m);const _=(i.get(h.batchId)||Y()).add(d);i=i.insert(h.batchId,_)})}).next(()=>{const a=[],h=i.getReverseIterator();for(;h.hasNext();){const d=h.getNext(),p=d.key,m=d.value,_=vc();m.forEach(v=>{if(!s.has(v)){const A=u(t.get(v),r.get(v));null!==A&&_.set(v,A),s=s.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(e,p,_))}return E.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return M.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):mu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var a}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):E.resolve(Rt());let h=-1,d=s;return a.next(p=>E.forEach(p,(m,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),s.get(m)?E.resolve():this.remoteDocumentCache.getEntry(e,m).next(v=>{d=d.insert(m,v)}))).next(()=>this.populateOverlays(e,p,s)).next(()=>this.computeViews(e,d,p,Y())).next(m=>({batchId:h,changes:Nr(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=je();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=je();return this.indexManager.getCollectionParents(e,s).next(h=>E.forEach(h,d=>{const p=(_=t,v=d.child(s),new rn(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt));var _,v;return this.getDocumentsMatchingCollectionQuery(e,p,r,i).next(m=>{m.forEach((_,v)=>{a=a.insert(_,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((d,p)=>{const m=p.getKey();null===a.get(m)&&(a=a.insert(m,_e.newInvalidDocument(m)))});let h=je();return a.forEach((d,p)=>{const m=s.get(d);void 0!==m&&f(m.mutation,p,nt.empty(),Ie.now()),Oi(t,p)&&(h=h.insert(d,p))}),h})}}class x_{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return E.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:Fe(i.createTime)}),E.resolve();var i}getNamedQuery(e,t){return E.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:Ad(i.bundledQuery),readTime:Fe(i.readTime)}),E.resolve();var i}}class V_{constructor(){this.overlays=new le(M.comparator),this.lr=new Map}getOverlay(e,t){return E.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Rt();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),E.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),E.resolve()}getOverlaysForCollection(e,t,r){const i=Rt(),s=t.length+1,a=new M(t.child("")),h=this.overlays.getIteratorFrom(a);for(;h.hasNext();){const d=h.getNext().value,p=d.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return E.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new le((p,m)=>p-m);const a=this.overlays.getIterator();for(;a.hasNext();){const p=a.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>r){let m=s.get(p.largestBatchId);null===m&&(m=Rt(),s=s.insert(p.largestBatchId,m)),m.set(p.getKey(),p)}}const h=Rt(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((p,m)=>h.set(p,m)),!(h.size()>=i)););return E.resolve(h)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const a=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Li(t,r));let s=this.lr.get(t);void 0===s&&(s=Y(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class xd{constructor(){this.hr=new ae(Qe.Pr),this.Ir=new ae(Qe.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new Qe(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new Qe(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new M(new ne([])),r=new Qe(t,e),i=new Qe(t,e+1),s=[];return this.Ir.forEachInRange([r,i],a=>{this.dr(a),s.push(a.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new M(new ne([])),r=new Qe(t,e),i=new Qe(t,e+1);let s=Y();return this.Ir.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Qe(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Qe{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return M.comparator(e.key,t.key)||H(e.gr,t.gr)}static Tr(e,t){return H(e.gr,t.gr)||M.comparator(e.key,t.key)}}class D_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new ae(Qe.Pr)}checkEmpty(e){return E.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const a=new kr(s,t,r,i);this.mutationQueue.push(a);for(const h of i)this.yr=this.yr.add(new Qe(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return E.resolve(a)}lookupMutationBatch(e,t){return E.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return E.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return E.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return E.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Qe(t,0),i=new Qe(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],a=>{const h=this.wr(a.gr);s.push(h)}),E.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ae(H);return t.forEach(i=>{const s=new Qe(i,0),a=new Qe(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,a],h=>{r=r.add(h.gr)})}),E.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;M.isDocumentKey(s)||(s=s.child(""));const a=new Qe(new M(s),0);let h=new ae(H);return this.yr.forEachWhile(d=>{const p=d.key.path;return!!r.isPrefixOf(p)&&(p.length===i&&(h=h.add(d.gr)),!0)},a),E.resolve(this.br(h))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){W(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return E.forEach(t.mutations,i=>{const s=new Qe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new Qe(t,0),i=this.yr.firstAfterOrEqual(r);return E.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return E.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class N_{constructor(e){this.Cr=e,this.docs=new le(M.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return E.resolve(r?r.document.mutableCopy():_e.newInvalidDocument(t))}getEntries(e,t){let r=He();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():_e.newInvalidDocument(i))}),E.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=He();const a=t.path,h=new M(a.child("")),d=this.docs.getIteratorFrom(h);for(;d.hasNext();){const{key:p,value:{document:m}}=d.getNext();if(!a.isPrefixOf(p.path))break;p.path.length>a.length+1||Ei(Zs(m),r)<=0||(i.has(m.key)||Oi(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return E.resolve(s)}getAllFromCollectionGroup(e,t,r,i){U()}vr(e,t){return E.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new k_(this)}getSize(e){return E.resolve(this.size)}}class k_ extends cm{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),E.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class O_{constructor(e){this.persistence=e,this.Fr=new qt(t=>nn(t),tr),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.Mr=0,this.Or=new xd,this.targetCount=0,this.Nr=Gi.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),E.resolve()}getLastRemoteSnapshotVersion(e){return E.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return E.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),E.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),E.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Gi(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,E.resolve()}updateTargetData(e,t){return this.kn(t),E.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,E.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((a,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.Fr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),E.waitFor(s).next(()=>i)}getTargetCount(e){return E.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return E.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),E.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),E.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),E.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return E.resolve(r)}containsKey(e,t){return E.resolve(this.Or.containsKey(t))}}class Vd{constructor(e,t){this.Br={},this.overlays={},this.Lr=new lt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new O_(this),this.indexManager=new T_,this.remoteDocumentCache=new N_(r=>this.referenceDelegate.Qr(r)),this.serializer=new Bp(t),this.Kr=new x_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new V_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new D_(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){b("MemoryPersistence","Starting transaction:",e);const i=new M_(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return E.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class M_ extends vn{constructor(e){super(),this.currentSequenceNumber=e}}class Lc{constructor(e){this.persistence=e,this.Gr=new xd,this.zr=null}static jr(e){return new Lc(e)}get Hr(){if(this.zr)return this.zr;throw U()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),E.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),E.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),E.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.Hr,r=>{const i=M.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,$.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return E.or([()=>E.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class L_{constructor(e){this.serializer=e}N(e,t,r,i){const s=new Ks("createOrUpgrade",t);var d;r<1&&i>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Qs,{unique:!0}),d.createObjectStore("documentMutations"),gm(e),function(d){d.createObjectStore("remoteDocuments")}(e));let a=E.resolve();return r<3&&i>=3&&(0!==r&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),gm(e)),a=a.next(()=>function(d){const p=d.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return p.put("targetGlobalKey",m)}(s))),r<4&&i>=4&&(0!==r&&(a=a.next(()=>function(d,p){return p.store("mutations").W().next(m=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Qs,{unique:!0});const _=p.store("mutations"),v=m.map(A=>_.put(A));return E.waitFor(v)})}(e,s))),a=a.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(a=a.next(()=>this.Zr(s))),r<6&&i>=6&&(a=a.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(a=a.next(()=>this.ei(s))),r<8&&i>=8&&(a=a.next(()=>this.ti(e,s))),r<9&&i>=9&&(a=a.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(a=a.next(()=>this.ni(s))),r<11&&i>=11&&(a=a.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{!function(d){const p=d.createObjectStore("documentOverlays",{keyPath:nu});p.createIndex("collectionPathOverlayIndex",Yl,{unique:!1}),p.createIndex("collectionGroupOverlayIndex",ru,{unique:!1})}(e)})),r<13&&i>=13&&(a=a.next(()=>function(d){const p=d.createObjectStore("remoteDocumentsV14",{keyPath:Jh});p.createIndex("documentKeyIndex",Ja),p.createIndex("collectionGroupIndex",Xh)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.ii(e,s))),r<15&&i>=15&&(a=a.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:eu}).createIndex("sequenceNumberIndex",rd,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:tu}).createIndex("documentKeyIndex",Ys,{unique:!1})}(e))),a}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=kc(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>E.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",a).next(h=>E.forEach(h,d=>{W(d.userId===s.userId);const p=Bi(this.serializer,d);return rm(e,s.userId,p).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((a,h)=>{const d=new ne(a),p=[0,We(d)];s.push(t.get(p).next(m=>m?E.resolve():t.put({targetId:0,path:We(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>E.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:nd});const r=t.store("collectionParents"),i=new bd,s=a=>{if(i.add(a)){const h=a.lastSegment(),d=a.popLast();return r.put({collectionId:h,parent:We(d)})}};return t.store("remoteDocuments").Y({J:!0},(a,h)=>{const d=new ne(a);return s(d.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([a,h,d],p)=>{const m=Ft(h);return s(m.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=xu(i),a=Wp(this.serializer,s);return t.put(a)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,a)=>{const h=t.store("remoteDocumentsV14"),d=(_=a,_.document?new M(ne.fromString(_.document.name).popFirst(5)):_.noDocument?M.fromSegments(_.noDocument.path):_.unknownDocument?M.fromSegments(_.unknownDocument.path):U()).path.toArray(),p={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var _;i.push(h.put(p))}).next(()=>E.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=hm(this.serializer),s=new Vd(Lc.jr,this.serializer.ut);return r.W().next(a=>{const h=new Map;return a.forEach(d=>{var p;let m=null!==(p=h.get(d.userId))&&void 0!==p?p:Y();Bi(this.serializer,d).keys().forEach(_=>m=m.add(_)),h.set(d.userId,m)}),E.forEach(h,(d,p)=>{const m=new ze(p),_=Vc.ct(this.serializer,m),v=s.getIndexManager(m),A=Oc.ct(m,this.serializer,v,s.referenceDelegate);return new mm(i,A,_,v).recalculateAndSaveOverlaysForDocumentKeys(new Js(t,lt._e),d).next()})})}}function gm(n){n.createObjectStore("targetDocuments",{keyPath:Xa}).createIndex("documentTargetsIndex",td,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ed,{unique:!0}),n.createObjectStore("targetGlobal")}const Dd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Nd{constructor(e,t,r,i,s,a,h,d,p,m,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=a,this.document=h,this.oi=p,this._i=m,this.ai=_,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=v=>Promise.resolve(),!Nd.D())throw new C(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new P_(this,i),this.Ii=t+"main",this.serializer=new Bp(d),this.Ti=new ut(this.Ii,this.ai,new L_(this.serializer)),this.qr=new A_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hm(this.serializer),this.Kr=new m_,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===m&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(R.FAILED_PRECONDITION,Dd);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new lt(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,S.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,S.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,S.Z)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Uc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(Tn(e))return b("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return b("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Ou(e).get("owner").next(t=>E.resolve(this.wi(t)))}Si(e){return Uc(e).delete(this.clientId)}bi(){var e=this;return(0,S.Z)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=xe(r,"clientMetadata");return i.W().next(s=>{const a=e.Ci(s,18e5),h=s.filter(d=>-1===a.indexOf(d));return E.forEach(h,d=>i.delete(d.clientId)).next(()=>h)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?E.resolve(!0):Ou(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new C(R.FAILED_PRECONDITION,Dd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Uc(e).W().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&b("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,S.Z)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Js(t,lt._e);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Uc(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Oc.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new E_(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return Vc.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){b("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(d=this.ai)?id:14===d?su:13===d?iu:12===d?Xl:11===d?Jl:void U();var d;let a;return this.Ti.runTransaction(e,i,s,h=>(a=new Js(h,this.Lr?this.Lr.next():lt._e),"readwrite-primary"===t?this.fi(a).next(d=>!!d||this.gi(a)).next(d=>{if(!d)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new C(R.FAILED_PRECONDITION,Sr);return r(a)}).next(d=>this.yi(a).next(()=>d)):this.Li(a).next(()=>r(a)))).then(h=>(a.raiseOnCommittedEvent(),h))}Li(e){return Ou(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(R.FAILED_PRECONDITION,Dd)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ou(e).put("owner",t)}static D(){return ut.D()}pi(e){const t=Ou(e);return t.get("owner").next(r=>this.wi(r)?(b("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):E.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(ye(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,oe.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return b("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ye("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ou(n){return xe(n,"owner")}function Uc(n){return xe(n,"clientMetadata")}function kd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Od{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=Y(),i=Y();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Od(e,t.fromCache,r,i)}}class F_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class _m{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new F_;return this.Hi(e,t,a).next(h=>{if(s.result=h,this.$i)return this.Ji(e,t,a,h.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(Ht()<=mt.in.DEBUG&&b("QueryEngine","SDK will not create cache indexes for query:",Dr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),E.resolve()):(Ht()<=mt.in.DEBUG&&b("QueryEngine","Query:",Dr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(Ht()<=mt.in.DEBUG&&b("QueryEngine","The SDK decides to create cache indexes for query:",Dr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ye(t))):E.resolve())}zi(e,t){if(_c(t))return E.resolve(null);let r=Ye(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ni(t,null,"F"),r=Ye(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=Y(...s);return this.Gi.getDocuments(e,a).next(h=>this.indexManager.getMinOffset(e,r).next(d=>{const p=this.Yi(t,h);return this.Zi(t,p,a,d.readTime)?this.zi(e,Ni(t,null,"F")):this.Xi(e,p,t,d)}))})))}ji(e,t,r,i){return _c(t)||i.isEqual($.min())?E.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const a=this.Yi(t,s);return this.Zi(t,a,r,i)?E.resolve(null):(Ht()<=mt.in.DEBUG&&b("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dr(t)),this.Xi(e,a,t,Ti(i,-1)).next(h=>h))})}Yi(e,t){let r=new ae(co(e));return t.forEach((i,s)=>{Oi(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return Ht()<=mt.in.DEBUG&&b("QueryEngine","Using full collection scan to execute query:",Dr(t)),this.Gi.getDocumentsMatchingQuery(e,t,at.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class U_{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new le(H),this.ns=new qt(s=>nn(s),tr),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mm(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function ym(n,e,t,r){return new U_(n,e,t,r)}function Im(n,e){return Md.apply(this,arguments)}function Md(){return Md=(0,S.Z)(function*(n,e){const t=O(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],h=[];let d=Y();for(const p of i){a.push(p.batchId);for(const m of p.mutations)d=d.add(m.key)}for(const p of s){h.push(p.batchId);for(const m of p.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(r,d).next(p=>({_s:p,removedBatchIds:a,addedBatchIds:h}))})})}),Md.apply(this,arguments)}function vm(n){const e=O(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function Tm(n,e,t){let r=Y(),i=Y();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=He();return t.forEach((h,d)=>{const p=s.get(h);d.isFoundDocument()!==p.isFoundDocument()&&(i=i.add(h)),d.isNoDocument()&&d.version.isEqual($.min())?(e.removeEntry(h,d.readTime),a=a.insert(h,d)):!p.isValidDocument()||d.version.compareTo(p.version)>0||0===d.version.compareTo(p.version)&&p.hasPendingWrites?(e.addEntry(d),a=a.insert(h,d)):b("LocalStore","Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",d.version)}),{us:a,cs:i}})}function z_(n,e){const t=O(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ao(n,e){const t=O(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,E.resolve(i)):t.qr.allocateTargetId(r).next(a=>(i=new or(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function wo(n,e,t){return Ld.apply(this,arguments)}function Ld(){return Ld=(0,S.Z)(function*(n,e,t){const r=O(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Tn(a))throw a;b("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),Ld.apply(this,arguments)}function qc(n,e,t){const r=O(n);let i=$.min(),s=Y();return r.persistence.runTransaction("Execute query","readwrite",a=>function(d,p,m){const _=O(d),v=_.ns.get(m);return void 0!==v?E.resolve(_.ts.get(v)):_.qr.getTargetData(p,m)}(r,a,Ye(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(a,h.targetId).next(d=>{s=d})}).next(()=>r.es.getDocumentsMatchingQuery(a,e,t?i:$.min(),t?s:Y())).next(h=>(wm(r,_u(e),h),{documents:h,ls:s})))}function Em(n,e){const t=O(n),r=O(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(a=>a?a.target:null))}function Am(n,e){const t=O(n),r=t.rs.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,Ti(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(wm(t,e,i),i))}function wm(n,e,t){let r=n.rs.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Fd(){return Fd=(0,S.Z)(function*(n,e,t,r){const i=O(n);let s=Y(),a=He();for(const p of t){const m=e.hs(p.metadata.name);p.document&&(s=s.add(m));const _=e.Ps(p);_.setReadTime(e.Is(p.metadata.readTime)),a=a.insert(m,_)}const h=i.ss.newChangeBuffer({trackRemovals:!0}),d=yield Ao(i,(m=r,Ye(nr(ne.fromString(`__bundle__/docs/${m}`)))));var m;return i.persistence.runTransaction("Apply bundle documents","readwrite",p=>Tm(p,h,a).next(m=>(h.apply(p),m)).next(m=>i.qr.removeMatchingKeysForTargetId(p,d.targetId).next(()=>i.qr.addMatchingKeys(p,s,d.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(p,m.us,m.cs)).next(()=>m.us)))}),Fd.apply(this,arguments)}function G_(n,e){return Ud.apply(this,arguments)}function Ud(){return Ud=(0,S.Z)(function*(n,e,t=Y()){const r=yield Ao(n,Ye(Ad(e.bundledQuery))),i=O(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Fe(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Kr.saveNamedQuery(s,e);const h=r.withResumeToken(Le.EMPTY_BYTE_STRING,a);return i.ts=i.ts.insert(h.targetId,h),i.qr.updateTargetData(s,h).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),Ud.apply(this,arguments)}function Rm(n,e){return`firestore_clients_${n}_${e}`}function Pm(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function qd(n,e){return`firestore_targets_${n}_${e}`}class Bc{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new C(i.error.code,i.error.message))),a?new Bc(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Mu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new C(r.error.code,r.error.message))),s?new Mu(e,r.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=Bt();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=Ql(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new zc(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Bd{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Bd(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class zd{constructor(){this.activeTargetIds=Bt()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Wd{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new le(H),this.started=!1,this.ps=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Rm(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new zd),this.Ss=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,S.Z)(function*(){const t=yield e.syncEngine.Bi();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(Rm(e.persistenceKey,i));if(s){const a=zc.Ts(i,s);a&&(e.gs=e.gs.insert(a.clientId,a))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(qd(this.persistenceKey,e));if(r){const i=Mu.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(qd(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return b("SharedClientState","READ",e,t),t}setItem(e,t){b("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){b("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(b("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,S.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(a){let h=lt._e;if(null!=a)try{const d=JSON.parse(a);W("number"==typeof d),h=d}catch(d){ye("SharedClientState","Failed to read sequence number from WebStorage",d)}return h}(r.newValue);i!==lt._e&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new Bc(this.currentUser,e,t,r),s=Pm(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=Pm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=qd(this.persistenceKey,e),s=new Mu(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return zc.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return Bc.Ts(new ze(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return Mu.Ts(i,t)}Ms(e){return Bd.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,S.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);b("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),a=[],h=[];return s.forEach(d=>{i.has(d)||a.push(d)}),i.forEach(d=>{s.has(d)||h.push(d)}),this.syncEngine.Xs(a,h).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Bt();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Sm{constructor(){this.eo=new zd,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new zd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class $_{ro(e){}shutdown(){}}class Cm{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){b("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){b("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Wc=null;function Gd(){return null===Wc?Wc=268435456+Math.round(2147483648*Math.random()):Wc++,"0x"+Wc.toString(16)}const Z_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class K_{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const st="WebChannelConnection";class j_ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,a){const h=Gd(),d=this.So(t,r);b("RestConnection",`Sending RPC '${t}' ${h}:`,d,i);const p={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(p,s,a),this.Do(t,d,p,i).then(m=>(b("RestConnection",`Received RPC '${t}' ${h}: `,m),m),m=>{throw tt("RestConnection",`RPC '${t}' ${h} failed with error: `,m,"url: ",d,"request:",i),m})}Co(t,r,i,s,a,h){return this.wo(t,r,i,s,a)}bo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Xn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}So(t,r){return`${this.mo}/v1/${r}:${Z_[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=Gd();return new Promise((a,h)=>{const d=new Wa;d.setWithCredentials(!0),d.listenOnce(Uh.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case za.NO_ERROR:const m=d.getResponseJson();b(st,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(m)),a(m);break;case za.TIMEOUT:b(st,`RPC '${e}' ${s} timed out`),h(new C(R.DEADLINE_EXCEEDED,"Request time out"));break;case za.HTTP_ERROR:const _=d.getStatus();if(b(st,`RPC '${e}' ${s} failed with status:`,_,"response text:",d.getResponseText()),_>0){let v=d.getResponseJson();Array.isArray(v)&&(v=v[0]);const A=null==v?void 0:v.error;if(A&&A.status&&A.message){const V=function(N){const q=N.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(q)>=0?q:R.UNKNOWN}(A.status);h(new C(V,A.message))}else h(new C(R.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new C(R.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{b(st,`RPC '${e}' ${s} completed.`)}});const p=JSON.stringify(i);b(st,`RPC '${e}' ${s} sending request:`,i),d.send(t,"POST",p,r,15)})}vo(e,t,r){const i=Gd(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Tp(),h=mn(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;void 0!==p&&(d.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(d.useFetchStreams=!0),this.bo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const m=s.join("");b(st,`Creating RPC '${e}' stream ${i}: ${m}`,d);const _=a.createWebChannel(m,d);let v=!1,A=!1;const V=new K_({co:N=>{A?b(st,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(v||(b(st,`Opening RPC '${e}' stream ${i} transport.`),_.open(),v=!0),b(st,`RPC '${e}' stream ${i} sending:`,N),_.send(N))},lo:()=>_.close()}),D=(N,q,Z)=>{N.listen(q,K=>{try{Z(K)}catch(G){setTimeout(()=>{throw G},0)}})};return D(_,Gs.EventType.OPEN,()=>{A||b(st,`RPC '${e}' stream ${i} transport opened.`)}),D(_,Gs.EventType.CLOSE,()=>{A||(A=!0,b(st,`RPC '${e}' stream ${i} transport closed`),V.Ro())}),D(_,Gs.EventType.ERROR,N=>{A||(A=!0,tt(st,`RPC '${e}' stream ${i} transport errored:`,N),V.Ro(new C(R.UNAVAILABLE,"The operation could not be completed")))}),D(_,Gs.EventType.MESSAGE,N=>{var q;if(!A){const Z=N.data[0];W(!!Z);const G=Z.error||(null===(q=Z[0])||void 0===q?void 0:q.error);if(G){b(st,`RPC '${e}' stream ${i} received error:`,G);const X=G.status;let J=function(zv){const Yg=Re[zv];if(void 0!==Yg)return go(Yg)}(X),Ue=G.message;void 0===J&&(J=R.INTERNAL,Ue="Unknown error status: "+X+" with message "+G.message),A=!0,V.Ro(new C(J,Ue)),_.close()}else b(st,`RPC '${e}' stream ${i} received:`,Z),V.Vo(Z)}}),D(h,yi.STAT_EVENT,N=>{N.stat===Wl.PROXY?b(st,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===Wl.NOPROXY&&b(st,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{V.Ao()},0),V}}function bm(){return typeof window<"u"?window:null}function Gc(){return typeof document<"u"?document:null}function Lu(n){return new i_(n,!0)}class $d{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&b("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class xm{constructor(e,t,r,i,s,a,h,d){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=h,this.listener=d,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new $d(e,t)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}stop(){var e=this;return(0,S.Z)(function*(){e.jo()&&(yield e.close(0))})()}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}Xo(){var e=this;return(0,S.Z)(function*(){if(e.Ho())return e.close(0)})()}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}close(e,t){var r=this;return(0,S.Z)(function*(){r.t_(),r.n_(),r.zo.cancel(),r.Uo++,4!==e?r.zo.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),r.zo.Lo()):t&&t.code===R.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.r_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Io(t)})()}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new C(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){var e=this;this.state=5,this.zo.ko((0,S.Z)(function*(){e.state=0,e.start()}))}o_(e){return b("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(b("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class H_ extends xm{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=function a_(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(p=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:U(),i=e.targetChange.targetIds||[],s=function(p,m){return p.useProto3Json?(W(void 0===m||"string"==typeof m),Le.fromBase64String(m||"")):(W(void 0===m||m instanceof Uint8Array),Le.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,h=a&&function(p){const m=void 0===p.code?R.UNKNOWN:go(p.code);return new C(m,p.message||"")}(a);t=new Pp(r,i,s,h||null)}else if("documentChange"in e){const r=e.documentChange,i=Nn(n,r.document.name),s=Fe(r.document.updateTime),a=r.document.createTime?Fe(r.document.createTime):$.min(),h=new Ke({mapValue:{fields:r.document.fields}}),d=_e.newFoundDocument(i,s,a,h);t=new bc(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=Nn(n,r.document),s=r.readTime?Fe(r.readTime):$.min(),a=_e.newNoDocument(i,s);t=new bc([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const r=e.documentRemove,i=Nn(n,r.document);t=new bc([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return U();{const r=e.filter,{count:i=0,unchangedNames:s}=r,a=new Pc(i,s);t=new Rp(r.targetId,a)}}var p;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return $.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?Fe(a.readTime):$.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=Cu(this.serializer),t.addTarget=function(s,a){let h;const d=a.target;if(h=uo(d)?{documents:Mp(s,d)}:{query:Ed(s,d)},h.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){h.resumeToken=xp(s,a.resumeToken);const p=yd(s,a.expectedCount);null!==p&&(h.expectedCount=p)}else if(a.snapshotVersion.compareTo($.min())>0){h.readTime=_o(s,a.snapshotVersion.toTimestamp());const p=yd(s,a.expectedCount);null!==p&&(h.expectedCount=p)}return h}(this.serializer,e);const r=function l_(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=Cu(this.serializer),t.removeTarget=e,this.e_(t)}}class Q_ extends xm{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(W(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=function u_(n,e){return n&&n.length>0?(W(void 0!==e),n.map(t=>function(i,s){let a=Fe(i.updateTime?i.updateTime:s);return a.isEqual($.min())&&(a=Fe(s)),new gd(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Fe(e.commitTime);return this.listener.I_(r,t)}return W(!e.writeResults||0===e.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=Cu(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>bu(this.serializer,r))};this.e_(t)}}class Y_ extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new C(R.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new C(R.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,t,r,s,a,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(R.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class X_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){"Online"===this.state?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,"Online"===e&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(ye(t),this.f_=!1):b("OnlineStateTracker",t)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class ey{constructor(e,t,r,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(h=>{r.enqueueAndForget((0,S.Z)(function*(){var d;Ur(a)&&(b("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,S.Z)(function*(m){const _=O(m);_.C_.add(4),yield Ro(_),_.M_.set("Unknown"),_.C_.delete(4),yield Fu(_)}),function p(m){return d.apply(this,arguments)})(a))}))}),this.M_=new X_(r,i)}}function Fu(n){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,S.Z)(function*(n){if(Ur(n))for(const e of n.v_)yield e(!0)}),Kd.apply(this,arguments)}function Ro(n){return jd.apply(this,arguments)}function jd(){return jd=(0,S.Z)(function*(n){for(const e of n.v_)yield e(!1)}),jd.apply(this,arguments)}function $c(n,e){const t=O(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),Yd(t)?Qd(t):So(t).Ho()&&Hd(t,e))}function Uu(n,e){const t=O(n),r=So(t);t.D_.delete(e),r.Ho()&&Vm(t,e),0===t.D_.size&&(r.Ho()?r.Zo():Ur(t)&&t.M_.set("Unknown"))}function Hd(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}So(n).u_(e)}function Vm(n,e){n.x_.Oe(e),So(n).c_(e)}function Qd(n){n.x_=new e_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),So(n).start(),n.M_.g_()}function Yd(n){return Ur(n)&&!So(n).jo()&&n.D_.size>0}function Ur(n){return 0===O(n).C_.size}function Dm(n){n.x_=void 0}function ty(n){return Jd.apply(this,arguments)}function Jd(){return Jd=(0,S.Z)(function*(n){n.D_.forEach((e,t)=>{Hd(n,e)})}),Jd.apply(this,arguments)}function ny(n,e){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,S.Z)(function*(n,e){Dm(n),Yd(n)?(n.M_.w_(e),Qd(n)):n.M_.set("Unknown")}),Xd.apply(this,arguments)}function ry(n,e,t){return ef.apply(this,arguments)}function ef(){return ef=(0,S.Z)(function*(n,e,t){if(n.M_.set("Online"),e instanceof Pp&&2===e.state&&e.cause)try{yield(r=(0,S.Z)(function*(s,a){const h=a.cause;for(const d of a.targetIds)s.D_.has(d)&&(yield s.remoteSyncer.rejectListen(d,h),s.D_.delete(d),s.x_.removeTarget(d))}),function i(s,a){return r.apply(this,arguments)})(n,e)}catch(r){b("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Zc(n,r)}else if(e instanceof bc?n.x_.$e(e):e instanceof Rp?n.x_.Je(e):n.x_.Ge(e),!t.isEqual($.min()))try{const r=yield vm(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){const h=s.x_.it(a);return h.targetChanges.forEach((d,p)=>{if(d.resumeToken.approximateByteSize()>0){const m=s.D_.get(p);m&&s.D_.set(p,m.withResumeToken(d.resumeToken,a))}}),h.targetMismatches.forEach((d,p)=>{const m=s.D_.get(d);if(!m)return;s.D_.set(d,m.withResumeToken(Le.EMPTY_BYTE_STRING,m.snapshotVersion)),Vm(s,d);const _=new or(m.target,d,p,m.sequenceNumber);Hd(s,_)}),s.remoteSyncer.applyRemoteEvent(h)}(n,t))}catch(r){b("RemoteStore","Failed to raise snapshot:",r),yield Zc(n,r)}var r}),ef.apply(this,arguments)}function Zc(n,e,t){return tf.apply(this,arguments)}function tf(){return tf=(0,S.Z)(function*(n,e,t){if(!Tn(e))throw e;n.C_.add(1),yield Ro(n),n.M_.set("Offline"),t||(t=()=>vm(n.localStore)),n.asyncQueue.enqueueRetryable((0,S.Z)(function*(){b("RemoteStore","Retrying IndexedDB access"),yield t(),n.C_.delete(1),yield Fu(n)}))}),tf.apply(this,arguments)}function Nm(n,e){return e().catch(t=>Zc(n,t,e))}function Po(n){return nf.apply(this,arguments)}function nf(){return nf=(0,S.Z)(function*(n){const e=O(n),t=qr(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;iy(e);)try{const i=yield z_(e.localStore,r);if(null===i){0===e.b_.length&&t.Zo();break}r=i.batchId,sy(e,i)}catch(i){yield Zc(e,i)}km(e)&&Om(e)}),nf.apply(this,arguments)}function iy(n){return Ur(n)&&n.b_.length<10}function sy(n,e){n.b_.push(e);const t=qr(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function km(n){return Ur(n)&&!qr(n).jo()&&n.b_.length>0}function Om(n){qr(n).start()}function oy(n){return rf.apply(this,arguments)}function rf(){return rf=(0,S.Z)(function*(n){qr(n).E_()}),rf.apply(this,arguments)}function ay(n){return sf.apply(this,arguments)}function sf(){return sf=(0,S.Z)(function*(n){const e=qr(n);for(const t of n.b_)e.P_(t.mutations)}),sf.apply(this,arguments)}function uy(n,e,t){return of.apply(this,arguments)}function of(){return of=(0,S.Z)(function*(n,e,t){const r=n.b_.shift(),i=mo.from(r,e,t);yield Nm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Po(n)}),of.apply(this,arguments)}function ly(n,e){return af.apply(this,arguments)}function af(){return af=(0,S.Z)(function*(n,e){var t;e&&qr(n).h_&&(yield(t=(0,S.Z)(function*(i,s){if(Eu(h=s.code)&&h!==R.ABORTED){const a=i.b_.shift();qr(i).Yo(),yield Nm(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Po(i)}var h}),function r(i,s){return t.apply(this,arguments)})(n,e)),km(n)&&Om(n)}),af.apply(this,arguments)}function Mm(n,e){return uf.apply(this,arguments)}function uf(){return uf=(0,S.Z)(function*(n,e){const t=O(n);t.asyncQueue.verifyOperationInProgress(),b("RemoteStore","RemoteStore received new credentials");const r=Ur(t);t.C_.add(3),yield Ro(t),r&&t.M_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),yield Fu(t)}),uf.apply(this,arguments)}function lf(n,e){return cf.apply(this,arguments)}function cf(){return cf=(0,S.Z)(function*(n,e){const t=O(n);e?(t.C_.delete(2),yield Fu(t)):e||(t.C_.add(2),yield Ro(t),t.M_.set("Unknown"))}),cf.apply(this,arguments)}function So(n){return n.O_||(n.O_=function(t,r,i){const s=O(t);return s.A_(),new H_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:ty.bind(null,n),Io:ny.bind(null,n),a_:ry.bind(null,n)}),n.v_.push(function(){var e=(0,S.Z)(function*(t){t?(n.O_.Yo(),Yd(n)?Qd(n):n.M_.set("Unknown")):(yield n.O_.stop(),Dm(n))});return function(t){return e.apply(this,arguments)}}())),n.O_}function qr(n){return n.N_||(n.N_=function(t,r,i){const s=O(t);return s.A_(),new Q_(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:oy.bind(null,n),Io:ly.bind(null,n),T_:ay.bind(null,n),I_:uy.bind(null,n)}),n.v_.push(function(){var e=(0,S.Z)(function*(t){t?(n.N_.Yo(),yield Po(n)):(yield n.N_.stop(),n.b_.length>0&&(b("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))});return function(t){return e.apply(this,arguments)}}())),n.N_}class hf{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Me,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,h=new hf(e,t,a,i,s);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Co(n,e){if(ye("AsyncQueue",`${e}: ${n}`),Tn(n))return new C(R.UNAVAILABLE,`${e}: ${n}`);throw n}class bo{constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=je(),this.sortedSet=new le(this.comparator)}static emptySet(e){return new bo(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new bo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Lm{constructor(){this.B_=new le(M.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?0!==e.type&&3===r.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==r.type?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.B_=this.B_.remove(t):1===e.type&&2===r.type?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):U():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class xo{constructor(e,t,r,i,s,a,h,d,p){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=h,this.excludesMetadataChanges=d,this.hasCachedResults=p}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(h=>{a.push({type:0,doc:h})}),new xo(e,t,bo.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ki(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class cy{constructor(){this.k_=void 0,this.listeners=[]}}class hy{constructor(){this.queries=new qt(e=>yc(e),ki),this.onlineState="Unknown",this.q_=new Set}}function df(n,e){return ff.apply(this,arguments)}function ff(){return ff=(0,S.Z)(function*(n,e){const t=O(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new cy),i)try{s.k_=yield t.onListen(r)}catch(a){const h=Co(a,`Initialization of query '${Dr(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&gf(t)}),ff.apply(this,arguments)}function pf(n,e){return mf.apply(this,arguments)}function mf(){return mf=(0,S.Z)(function*(n,e){const t=O(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),mf.apply(this,arguments)}function dy(n,e){const t=O(n);let r=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const h of a.listeners)h.K_(i)&&(r=!0);a.k_=i}}r&&gf(t)}function fy(n,e,t){const r=O(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function gf(n){n.q_.forEach(e=>{e.next()})}class _f{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new xo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){return!e.fromCache||(!this.options.J_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}H_(e){e=xo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class py{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class Fm{constructor(e){this.serializer=e}hs(e){return Nn(this.serializer,e)}Ps(e){return e.metadata.exists?Op(this.serializer,e.document,!1):_e.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return Fe(e)}}class my{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Um(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=ne.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new Fm(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const a of i.metadata.queries){const h=(t.get(a)||Y()).add(s);t.set(a,h)}}return t}complete(){var e=this;return(0,S.Z)(function*(){const t=yield function W_(n,e,t,r){return Fd.apply(this,arguments)}(e.localStore,new Fm(e.serializer),e.documents,e.X_.id),r=e.ta(e.documents);for(const i of e.queries)yield G_(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,na:e.collectionGroups,ra:t}})()}}function Um(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class qm{constructor(e){this.key=e}}class Bm{constructor(e){this.key=e}}class zm{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=Y(),this.mutatedKeys=Y(),this._a=co(e),this.aa=new bo(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new Lm,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,h=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,p="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,_)=>{const v=i.get(m),A=Oi(this.query,_)?_:null,V=!!v&&this.mutatedKeys.has(v.key),D=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let N=!1;v&&A?v.data.isEqual(A.data)?V!==D&&(r.track({type:3,doc:A}),N=!0):this.ha(v,A)||(r.track({type:2,doc:A}),N=!0,(d&&this._a(A,d)>0||p&&this._a(A,p)<0)&&(h=!0)):!v&&A?(r.track({type:0,doc:A}),N=!0):v&&!A&&(r.track({type:1,doc:v}),N=!0,(d||p)&&(h=!0)),N&&(A?(a=a.add(A),s=D?s.add(m):s.delete(m)):(a=a.delete(m),s=s.delete(m)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const m="F"===this.query.limitType?a.last():a.first();a=a.delete(m.key),s=s.delete(m.key),r.track({type:1,doc:m})}return{aa:a,la:r,Zi:h,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const a=e.la.L_();a.sort((m,_)=>function(A,V){const D=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return D(A)-D(V)}(m.type,_.type)||this._a(m.doc,_.doc)),this.Pa(r),i=null!=i&&i;const h=t&&!i?this.Ia():[],d=0===this.oa.size&&this.current&&!i?1:0,p=d!==this.sa;return this.sa=d,0!==a.length||p?{snapshot:new xo(this.query,e.aa,s,a,e.mutatedKeys,0===d,p,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:h}:{Ta:h}}Q_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({aa:this.aa,la:new Lm,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=Y(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new Bm(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new qm(r))}),t}da(e){this.ia=e.ls,this.oa=Y();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return xo.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class gy{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class _y{constructor(e){this.key=e,this.Ra=!1}}class yy{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Va={},this.ma=new qt(h=>yc(h),ki),this.fa=new Map,this.ga=new Set,this.pa=new le(M.comparator),this.ya=new Map,this.wa=new xd,this.Sa={},this.ba=new Map,this.Da=Gi.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}function Iy(n,e){return yf.apply(this,arguments)}function yf(){return yf=(0,S.Z)(function*(n,e){const t=Bf(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const a=yield Ao(t.localStore,Ye(e)),h=t.sharedClientState.addLocalQueryTarget(a.targetId);r=a.targetId,i=yield If(t,e,r,"current"===h,a.resumeToken),t.isPrimaryClient&&$c(t.remoteStore,a)}return i}),yf.apply(this,arguments)}function If(n,e,t,r,i){return vf.apply(this,arguments)}function vf(){return vf=(0,S.Z)(function*(n,e,t,r,i){n.va=(_,v,A)=>{return(V=(0,S.Z)(function*(N,q,Z,K){let G=q.view.ca(Z);G.Zi&&(G=yield qc(N.localStore,q.query,!1).then(({documents:It})=>q.view.ca(It,G)));const X=K&&K.targetChanges.get(q.targetId),J=K&&null!=K.targetMismatches.get(q.targetId),Ue=q.view.applyChanges(G,N.isPrimaryClient,X,J);return xf(N,q.targetId,Ue.Ta),Ue.snapshot}),function D(N,q,Z,K){return V.apply(this,arguments)})(n,_,v,A);var V};const s=yield qc(n.localStore,e,!0),a=new zm(e,s.ls),h=a.ca(s.documents),d=Pu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),p=a.applyChanges(h,n.isPrimaryClient,d);xf(n,t,p.Ta);const m=new gy(e,t,a);return n.ma.set(e,m),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),p.snapshot}),vf.apply(this,arguments)}function vy(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,S.Z)(function*(n,e){const t=O(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!ki(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield wo(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Uu(t.remoteStore,r.targetId),Vo(t,r.targetId)}).catch(Lt))):(Vo(t,r.targetId),yield wo(t.localStore,r.targetId,!0))}),Tf.apply(this,arguments)}function Ef(){return Ef=(0,S.Z)(function*(n,e,t){const r=zf(n);try{const i=yield function(a,h){const d=O(a),p=Ie.now(),m=h.reduce((A,V)=>A.add(V.key),Y());let _,v;return d.persistence.runTransaction("Locally write mutations","readwrite",A=>{let V=He(),D=Y();return d.ss.getEntries(A,m).next(N=>{V=N,V.forEach((q,Z)=>{Z.isValidDocument()||(D=D.add(q))})}).next(()=>d.localDocuments.getOverlayedDocuments(A,V)).next(N=>{_=N;const q=[];for(const Z of h){const K=g(Z,_.get(Z.key).overlayedDocument);null!=K&&q.push(new P(Z.key,K,ac(K.value.mapValue),ve.exists(!0)))}return d.mutationQueue.addMutationBatch(A,p,q,h)}).next(N=>{v=N;const q=N.applyToLocalDocumentSet(_,D);return d.documentOverlayCache.saveOverlays(A,N.batchId,q)})}).then(()=>({batchId:v.batchId,changes:Nr(_)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,h,d){let p=a.Sa[a.currentUser.toKey()];p||(p=new le(H)),p=p.insert(h,d),a.Sa[a.currentUser.toKey()]=p}(r,i.batchId,t),yield ar(r,i.changes),yield Po(r.remoteStore)}catch(i){const s=Co(i,"Failed to persist write");t.reject(s)}}),Ef.apply(this,arguments)}function Wm(n,e){return Af.apply(this,arguments)}function Af(){return Af=(0,S.Z)(function*(n,e){const t=O(n);try{const r=yield function B_(n,e){const t=O(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const h=[];e.targetChanges.forEach((m,_)=>{const v=i.get(_);if(!v)return;h.push(t.qr.removeMatchingKeys(s,m.removedDocuments,_).next(()=>t.qr.addMatchingKeys(s,m.addedDocuments,_)));let A=v.withSequenceNumber(s.currentSequenceNumber);var D,N,q;null!==e.targetMismatches.get(_)?A=A.withResumeToken(Le.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):m.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(m.resumeToken,r)),i=i.insert(_,A),N=A,q=m,(0===(D=v).resumeToken.approximateByteSize()||N.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=3e8||q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0)&&h.push(t.qr.updateTargetData(s,A))});let d=He(),p=Y();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))}),h.push(Tm(s,a,e.documentUpdates).next(m=>{d=m.us,p=m.cs})),!r.isEqual($.min())){const m=t.qr.getLastRemoteSnapshotVersion(s).next(_=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));h.push(m)}return E.waitFor(h).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,p)).next(()=>d)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.ya.get(s);a&&(W(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ra=!0:i.modifiedDocuments.size>0?W(a.Ra):i.removedDocuments.size>0&&(W(a.Ra),a.Ra=!1))}),yield ar(t,r,e)}catch(r){yield Lt(r)}}),Af.apply(this,arguments)}function Gm(n,e,t){const r=O(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ma.forEach((s,a)=>{const h=a.view.Q_(e);h.snapshot&&i.push(h.snapshot)}),function(a,h){const d=O(a);d.onlineState=h;let p=!1;d.queries.forEach((m,_)=>{for(const v of _.listeners)v.Q_(h)&&(p=!0)}),p&&gf(d)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Ey(n,e,t){return wf.apply(this,arguments)}function wf(){return wf=(0,S.Z)(function*(n,e,t){const r=O(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let a=new le(M.comparator);a=a.insert(s,_e.newNoDocument(s,$.min()));const h=Y().add(s),d=new Ru($.min(),new Map,new le(H),a,h);yield Wm(r,d),r.pa=r.pa.remove(s),r.ya.delete(e),Vf(r)}else yield wo(r.localStore,e,!1).then(()=>Vo(r,e,t)).catch(Lt)}),wf.apply(this,arguments)}function Ay(n,e){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,S.Z)(function*(n,e){const t=O(n),r=e.batch.batchId;try{const i=yield function q_(n,e){const t=O(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(h,d,p,m){const _=p.batch,v=_.keys();let A=E.resolve();return v.forEach(V=>{A=A.next(()=>m.getEntry(d,V)).next(D=>{const N=p.docVersions.get(V);W(null!==N),D.version.compareTo(N)<0&&(_.applyToRemoteDocument(D,p),D.isValidDocument()&&(D.setReadTime(p.commitVersion),m.addEntry(D)))})}),A.next(()=>h.mutationQueue.removeMutationBatch(d,_))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(h){let d=Y();for(let p=0;p<h.mutationResults.length;++p)h.mutationResults[p].transformResults.length>0&&(d=d.add(h.batch.mutations[p].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);bf(t,r,null),Cf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ar(t,i)}catch(i){yield Lt(i)}}),Rf.apply(this,arguments)}function wy(n,e,t){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,S.Z)(function*(n,e,t){const r=O(n);try{const i=yield function(a,h){const d=O(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",p=>{let m;return d.mutationQueue.lookupMutationBatch(p,h).next(_=>(W(null!==_),m=_.keys(),d.mutationQueue.removeMutationBatch(p,_))).next(()=>d.mutationQueue.performConsistencyCheck(p)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(p,m,h)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,m)).next(()=>d.localDocuments.getDocuments(p,m))})}(r.localStore,e);bf(r,e,t),Cf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ar(r,i)}catch(i){yield Lt(i)}}),Pf.apply(this,arguments)}function Sf(){return Sf=(0,S.Z)(function*(n,e){const t=O(n);Ur(t.remoteStore)||b("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(a){const h=O(a);return h.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>h.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===r)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=Co(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Sf.apply(this,arguments)}function Cf(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function bf(n,e,t){const r=O(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function Vo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||$m(n,r)})}function $m(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);null!==t&&(Uu(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),Vf(n))}function xf(n,e,t){for(const r of t)r instanceof qm?(n.wa.addReference(r.key,e),Py(n,r)):r instanceof Bm?(b("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||$m(n,r.key)):U()}function Py(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(b("SyncEngine","New document in limbo: "+t),n.ga.add(r),Vf(n))}function Vf(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new M(ne.fromString(e)),r=n.Da.next();n.ya.set(r,new _y(t)),n.pa=n.pa.insert(t,r),$c(n.remoteStore,new or(Ye(nr(t.path)),r,"TargetPurposeLimboResolution",lt._e))}}function ar(n,e,t){return Df.apply(this,arguments)}function Df(){return Df=(0,S.Z)(function*(n,e,t){const r=O(n),i=[],s=[],a=[];var h;r.ma.isEmpty()||(r.ma.forEach((h,d)=>{a.push(r.va(d,e,t).then(p=>{if((p||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,null!=p&&p.fromCache?"not-current":"current"),p){i.push(p);const m=Od.Qi(d.targetId,p);s.push(m)}}))}),yield Promise.all(a),r.Va.a_(i),yield(h=(0,S.Z)(function*(p,m){const _=O(p);try{yield _.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>E.forEach(m,A=>E.forEach(A.ki,V=>_.persistence.referenceDelegate.addReference(v,A.targetId,V)).next(()=>E.forEach(A.qi,V=>_.persistence.referenceDelegate.removeReference(v,A.targetId,V)))))}catch(v){if(!Tn(v))throw v;b("LocalStore","Failed to update sequence numbers: "+v)}for(const v of m){const A=v.targetId;if(!v.fromCache){const V=_.ts.get(A),N=V.withLastLimboFreeSnapshotVersion(V.snapshotVersion);_.ts=_.ts.insert(A,N)}}}),function d(p,m){return h.apply(this,arguments)})(r.localStore,s))}),Df.apply(this,arguments)}function Sy(n,e){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,S.Z)(function*(n,e){const t=O(n);if(!t.currentUser.isEqual(e)){b("SyncEngine","User change. New user:",e.toKey());const r=yield Im(t.localStore,e);t.currentUser=e,(s=t).ba.forEach(h=>{h.forEach(d=>{d.reject(new C(R.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ba.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ar(t,r._s)}var s}),Nf.apply(this,arguments)}function Cy(n,e){const t=O(n),r=t.ya.get(e);if(r&&r.Ra)return Y().add(r.key);{let i=Y();const s=t.fa.get(e);if(!s)return i;for(const a of s){const h=t.ma.get(a);i=i.unionWith(h.view.ua)}return i}}function by(n,e){return kf.apply(this,arguments)}function kf(){return kf=(0,S.Z)(function*(n,e){const t=O(n),r=yield qc(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&xf(t,e.targetId,i.Ta),i}),kf.apply(this,arguments)}function xy(n,e){return Of.apply(this,arguments)}function Of(){return Of=(0,S.Z)(function*(n,e){const t=O(n);return Am(t.localStore,e).then(r=>ar(t,r))}),Of.apply(this,arguments)}function Vy(n,e,t,r){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,S.Z)(function*(n,e,t,r){const i=O(n),s=yield function(h,d){const p=O(h),m=O(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",_=>m.Cn(_,d).next(v=>v?p.localDocuments.getDocuments(_,v):E.resolve(null)))}(i.localStore,e);var d;null!==s?("pending"===t?yield Po(i.remoteStore):"acknowledged"===t||"rejected"===t?(bf(i,e,r||null),Cf(i,e),d=e,O(O(i.localStore).mutationQueue).Fn(d)):U(),yield ar(i,s)):b("SyncEngine","Cannot apply mutation batch with id: "+e)}),Mf.apply(this,arguments)}function Lf(){return Lf=(0,S.Z)(function*(n,e){const t=O(n);if(Bf(t),zf(t),!0===e&&!0!==t.Ca){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Zm(t,r.toArray());t.Ca=!0,yield lf(t.remoteStore,!0);for(const s of i)$c(t.remoteStore,s)}else if(!1===e&&!1!==t.Ca){const r=[];let i=Promise.resolve();t.fa.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(Vo(t,a),wo(t.localStore,a,!0))),Uu(t.remoteStore,a)}),yield i,yield Zm(t,r),function(a){const h=O(a);h.ya.forEach((d,p)=>{Uu(h.remoteStore,p)}),h.wa.Vr(),h.ya=new Map,h.pa=new le(M.comparator)}(t),t.Ca=!1,yield lf(t.remoteStore,!1)}}),Lf.apply(this,arguments)}function Zm(n,e,t){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,S.Z)(function*(n,e,t){const r=O(n),i=[],s=[];for(const a of e){let h;const d=r.fa.get(a);if(d&&0!==d.length){h=yield Ao(r.localStore,Ye(d[0]));for(const p of d){const m=r.ma.get(p),_=yield by(r,m);_.snapshot&&s.push(_.snapshot)}}else{const p=yield Em(r.localStore,a);h=yield Ao(r.localStore,p),yield If(r,Km(p),a,!1,h.resumeToken)}i.push(h)}return r.Va.a_(s),i}),Ff.apply(this,arguments)}function Km(n){return gc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Ny(n){return t=O(n).localStore,O(O(t).persistence).Bi();var t}function ky(n,e,t,r){return Uf.apply(this,arguments)}function Uf(){return Uf=(0,S.Z)(function*(n,e,t,r){const i=O(n);if(i.Ca)return void b("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield Am(i.localStore,_u(s[0])),h=Ru.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Le.EMPTY_BYTE_STRING);yield ar(i,a,h);break}case"rejected":yield wo(i.localStore,e,!0),Vo(i,e,r);break;default:U()}}),Uf.apply(this,arguments)}function Oy(n,e,t){return qf.apply(this,arguments)}function qf(){return qf=(0,S.Z)(function*(n,e,t){const r=Bf(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){b("SyncEngine","Adding an already active target "+i);continue}const s=yield Em(r.localStore,i),a=yield Ao(r.localStore,s);yield If(r,Km(s),a.targetId,!1,a.resumeToken),$c(r.remoteStore,a)}for(const i of t)r.fa.has(i)&&(yield wo(r.localStore,i,!1).then(()=>{Uu(r.remoteStore,i),Vo(r,i)}).catch(Lt))}}),qf.apply(this,arguments)}function Bf(n){const e=O(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ey.bind(null,e),e.Va.a_=dy.bind(null,e.eventManager),e.Va.Fa=fy.bind(null,e.eventManager),e}function zf(n){const e=O(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ay.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wy.bind(null,e),e}class qu{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,S.Z)(function*(){t.serializer=Lu(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ym(this.persistence,new _m,e.initialUser,this.serializer)}createPersistence(e){return new Vd(Lc.jr,this.serializer)}createSharedClientState(e){return new Sm}terminate(){var e=this;return(0,S.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Wf extends qu{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,S.Z)(function*(){yield t().call(r,e),yield r.xa.initialize(r,e),yield zf(r.xa.syncEngine),yield Po(r.xa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return ym(this.persistence,new _m,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new um(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new Ha(t,this.persistence);return new ja(e.asyncQueue,r)}createPersistence(e){const t=kd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?it.withCacheSize(this.cacheSizeBytes):it.DEFAULT;return new Nd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,bm(),Gc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Sm}}class jm extends Wf{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,S.Z)(function*(){yield t().call(r,e);const i=r.xa.syncEngine;r.sharedClientState instanceof Wd&&(r.sharedClientState.syncEngine={Ys:Vy.bind(null,i),Zs:ky.bind(null,i),Xs:Oy.bind(null,i),Bi:Ny.bind(null,i),Js:xy.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,S.Z)(function*(a){yield function Dy(n,e){return Lf.apply(this,arguments)}(r.xa.syncEngine,a),r.gcScheduler&&(a&&!r.gcScheduler.started?r.gcScheduler.start():a||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(a&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():a||r.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=bm();if(!Wd.D(t))throw new C(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=kd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Wd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Do{initialize(e,t){var r=this;return(0,S.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Gm(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Sy.bind(null,r.syncEngine),yield lf(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new hy}createDatastore(e){const t=Lu(e.databaseInfo.databaseId),r=new j_(e.databaseInfo);return new Y_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,a=t=>Gm(this.syncEngine,t,0),h=Cm.D()?new Cm:new $_,new ey(r,i,s,a,h);var r,i,s,a,h}createSyncEngine(e,t){return function(i,s,a,h,d,p,m){const _=new yy(i,s,a,h,d,p);return m&&(_.Ca=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,S.Z)(function*(r){const i=O(r);b("RemoteStore","RemoteStore shutting down."),i.C_.add(5),yield Ro(i),i.F_.shutdown(),i.M_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}function Hm(n,e=10240){let t=0;return{read:()=>(0,S.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,S.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Kc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Fy{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new Me,this.buffer=new Uint8Array,this.La=new TextDecoder("utf-8"),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}getMetadata(){var e=this;return(0,S.Z)(function*(){return e.metadata.promise})()}Ma(){var e=this;return(0,S.Z)(function*(){return yield e.getMetadata(),e.ka()})()}ka(){var e=this;return(0,S.Z)(function*(){const t=yield e.qa();if(null===t)return null;const r=e.La.decode(t),i=Number(r);isNaN(i)&&e.Qa(`length string (${r}) is not valid number`);const s=yield e.Ka(i);return new py(JSON.parse(s),t.length+i)})()}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}qa(){var e=this;return(0,S.Z)(function*(){for(;e.$a()<0&&!(yield e.Ua()););if(0===e.buffer.length)return null;const t=e.$a();t<0&&e.Qa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ka(e){var t=this;return(0,S.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ua())&&t.Qa("Reached the end of bundle when more is expected.");const r=t.La.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}Ua(){var e=this;return(0,S.Z)(function*(){const t=yield e.Ba.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class Uy{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,S.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new C(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,S.Z)(function*(a,h){const d=O(a),p=Cu(d.serializer)+"/documents",m={documents:h.map(V=>Su(d.serializer,V))},_=yield d.Co("BatchGetDocuments",p,m,h.length),v=new Map;_.forEach(V=>{const D=function o_(n,e){return"found"in e?function(r,i){W(!!i.found);const s=Nn(r,i.found.name),a=Fe(i.found.updateTime),h=i.found.createTime?Fe(i.found.createTime):$.min(),d=new Ke({mapValue:{fields:i.found.fields}});return _e.newFoundDocument(s,a,h,d)}(n,e):"missing"in e?function(r,i){W(!!i.missing),W(!!i.readTime);const s=Nn(r,i.missing),a=Fe(i.readTime);return _e.newNoDocument(s,a)}(n,e):U()}(d.serializer,V);v.set(D.key.toString(),D)});const A=[];return h.forEach(V=>{const D=v.get(V.toString());W(!!D),A.push(D)}),A}),function s(a,h){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ce(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,S.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=M.fromPath(i);e.mutations.push(new ct(s,e.precondition(s)))}),yield(r=(0,S.Z)(function*(s,a){const h=O(s),d=Cu(h.serializer)+"/documents",p={writes:a.map(m=>bu(h.serializer,m))};yield h.wo("Commit",d,p)}),function i(s,a){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=$.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new C(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?ve.exists(!1):ve.updateTime(t):ve.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new C(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ve.updateTime(t)}return ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class qy{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new $d(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){var e=this;this.zo.ko((0,S.Z)(function*(){const t=new Uy(e.datastore),r=e.za(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.ja(s)}))}).catch(i=>{e.ja(i)})}))}za(e){try{const t=this.updateFunction(e);return!Jt(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Eu(t)}return!1}}class By{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ze.UNAUTHENTICATED,this.clientId=Kl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var a=(0,S.Z)(function*(h){b("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return a.apply(this,arguments)}}()),this.appCheckCredentials.start(r,a=>(b("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}getConfiguration(){var e=this;return(0,S.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(R.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Me;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,S.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Co(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function jc(n,e){return Gf.apply(this,arguments)}function Gf(){return Gf=(0,S.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),b("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,S.Z)(function*(s){r.isEqual(s)||(yield Im(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Gf.apply(this,arguments)}function $f(n,e){return Zf.apply(this,arguments)}function Zf(){return Zf=(0,S.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Kf(n);b("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>Mm(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>Mm(e.remoteStore,s)),n._onlineComponents=e}),Zf.apply(this,arguments)}function Qm(n){return"FirebaseError"===n.name?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Kf(n){return jf.apply(this,arguments)}function jf(){return jf=(0,S.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){b("FirestoreClient","Using user provided OfflineComponentProvider");try{yield jc(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Qm(t))throw t;tt("Error using user provided cache. Falling back to memory cache: "+t),yield jc(n,new qu)}}else b("FirestoreClient","Using default OfflineComponentProvider"),yield jc(n,new qu);return n._offlineComponents}),jf.apply(this,arguments)}function Hc(n){return Hf.apply(this,arguments)}function Hf(){return Hf=(0,S.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(b("FirestoreClient","Using user provided OnlineComponentProvider"),yield $f(n,n._uninitializedComponentsProvider._online)):(b("FirestoreClient","Using default OnlineComponentProvider"),yield $f(n,new Do))),n._onlineComponents}),Hf.apply(this,arguments)}function Ym(n){return Kf(n).then(e=>e.persistence)}function No(n){return Kf(n).then(e=>e.localStore)}function Jm(n){return Hc(n).then(e=>e.remoteStore)}function Qf(n){return Hc(n).then(e=>e.syncEngine)}function ko(n){return Yf.apply(this,arguments)}function Yf(){return Yf=(0,S.Z)(function*(n){const e=yield Hc(n),t=e.eventManager;return t.onListen=Iy.bind(null,e.syncEngine),t.onUnlisten=vy.bind(null,e.syncEngine),t}),Yf.apply(this,arguments)}function eg(n,e,t={}){const r=new Me;return n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return function(s,a,h,d,p){const m=new Kc({next:v=>{a.enqueueAndForget(()=>pf(s,_));const A=v.docs.has(h);!A&&v.fromCache?p.reject(new C(R.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&v.fromCache&&d&&"server"===d.source?p.reject(new C(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(v)},error:v=>p.reject(v)}),_=new _f(nr(h.path),m,{includeMetadataChanges:!0,J_:!0});return df(s,_)}(yield ko(n),n.asyncQueue,e,t,r)})),r.promise}function tg(n,e,t={}){const r=new Me;return n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return function(s,a,h,d,p){const m=new Kc({next:v=>{a.enqueueAndForget(()=>pf(s,_)),v.fromCache&&"server"===d.source?p.reject(new C(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(v)},error:v=>p.reject(v)}),_=new _f(h,m,{includeMetadataChanges:!0,J_:!0});return df(s,_)}(yield ko(n),n.asyncQueue,e,t,r)})),r.promise}function ng(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const rg=new Map;function Jf(n,e,t){if(!t)throw new C(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ig(n,e,t,r){if(!0===e&&!0===r)throw new C(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sg(n){if(!M.isDocumentKey(n))throw new C(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function og(n){if(M.isDocumentKey(n))throw new C(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Qc(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":U()}function ie(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new C(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Qc(n);throw new C(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ag(n,e){if(e<=0)throw new C(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class ug{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new C(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ig("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=ng(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ug({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ug(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Rr;switch(r.type){case"firstParty":return new Zh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new C(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=rg.get(t);r&&(b("ComponentProvider","Removing Datastore"),rg.delete(t),r.terminate())}(this),Promise.resolve()}}function lg(n,e,t,r={}){var i;const s=(n=ie(n,Bu))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&tt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let h,d;if("string"==typeof r.mockUserToken)h=r.mockUserToken,d=ze.MOCK_USER;else{h=(0,oe.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new C(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new ze(p)}n._authCredentials=new Wh(new zh(h,d))}}class Je{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Je(this.firestore,e,this._query)}}class Ee{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ee(this.firestore,e,this._key)}}class kn extends Je{constructor(e,t,r){super(e,t,nr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ee(this.firestore,null,new M(e))}withConverter(e){return new kn(this.firestore,e,this._path)}}function Xf(n,e,...t){if(n=(0,oe.m9)(n),Jf("collection","path",e),n instanceof Bu){const r=ne.fromString(e,...t);return og(r),new kn(n,null,r)}{if(!(n instanceof Ee||n instanceof kn))throw new C(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return og(r),new kn(n.firestore,null,r)}}function Yc(n,e,...t){if(n=(0,oe.m9)(n),1===arguments.length&&(e=Kl.newId()),Jf("doc","path",e),n instanceof Bu){const r=ne.fromString(e,...t);return sg(r),new Ee(n,null,new M(r))}{if(!(n instanceof Ee||n instanceof kn))throw new C(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return sg(r),new Ee(n.firestore,n instanceof kn?n.converter:null,new M(r))}}function cg(n,e){return n=(0,oe.m9)(n),e=(0,oe.m9)(e),(n instanceof Ee||n instanceof kn)&&(e instanceof Ee||e instanceof kn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function ep(n,e){return n=(0,oe.m9)(n),e=(0,oe.m9)(e),n instanceof Je&&e instanceof Je&&n.firestore===e.firestore&&ki(n._query,e._query)&&n.converter===e.converter}class Xy{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new $d(this,"async_queue_retry"),this.iu=()=>{const t=Gc();t&&b("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=Gc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=Gc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new Me;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}_u(){var e=this;return(0,S.Z)(function*(){if(0!==e.Ya.length){try{yield e.Ya[0](),e.Ya.shift(),e.zo.reset()}catch(t){if(!Tn(t))throw t;b("AsyncQueue","Operation failed with retryable error: "+t)}e.Ya.length>0&&e.zo.ko(()=>e._u())}})()}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{throw this.eu=r,this.tu=!1,ye("INTERNAL UNHANDLED ERROR: ",function(a){let h=a.message||"";return a.stack&&(h=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),h}(r)),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=hf.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&U()}verifyOperationInProgress(){}uu(){var e=this;return(0,S.Z)(function*(){let t;do{t=e.Ja,yield t}while(t!==e.Ja)})()}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function tp(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class eI{constructor(){this._progressObserver={},this._taskCompletionResolver=new Me,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Te extends Bu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Xy,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||hg(this),this._firestoreClient.terminate()}}function nI(n,e){const t="object"==typeof n?n:(0,Fn.getApp)(),r="string"==typeof n?n:e||"(default)",i=(0,Fn._getProvider)(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(0,oe.P0)("firestore");s&&lg(i,...s)}return i}function Ve(n){return n._firestoreClient||hg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function hg(n){var e,t,r;const i=n._freezeSettings(),s=(d=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new ad(n._databaseId,d,n._persistenceKey,(m=i).host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,ng(m.experimentalLongPollingOptions),m.useFetchStreams));var d,m;n._firestoreClient=new By(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function dg(n,e,t){const r=new Me;return n.asyncQueue.enqueue((0,S.Z)(function*(){try{yield jc(n,t),yield $f(n,e),r.resolve()}catch(i){const s=i;if(!Qm(s))throw s;tt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function fg(n){if(n._initialized||n._terminated)throw new C(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class On{constructor(e){this._byteString=e}static fromBase64String(e){try{return new On(Le.fromBase64String(e))}catch(t){throw new C(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new On(Le.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ur{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Zi{constructor(e){this._methodName=e}}class Jc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}}const dI=/^__.*__$/;class fI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new P(e,this.data,this.fieldMask,t,this.fieldTransforms):new T(e,this.data,t,this.fieldTransforms)}}class pg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new P(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function mg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}class Xc{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new Xc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return nh(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(0===e.length)throw this.mu("Document fields must not be empty");if(mg(this.Iu)&&dI.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class pI{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Lu(e)}pu(e,t,r,i=!1){return new Xc({Iu:e,methodName:t,gu:r,path:ge.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ki(n){const e=n._freezeSettings(),t=Lu(n._databaseId);return new pI(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eh(n,e,t,r,i,s={}){const a=n.pu(s.merge||s.mergeFields?2:0,e,t,i);sp("Data must be an object, but it was:",a,r);const h=yg(r,a);let d,p;if(s.merge)d=new nt(a.fieldMask),p=a.fieldTransforms;else if(s.mergeFields){const m=[];for(const _ of s.mergeFields){const v=Gu(e,_,t);if(!a.contains(v))throw new C(R.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);vg(m,v)||m.push(v)}d=new nt(m),p=a.fieldTransforms.filter(_=>d.covers(_.field))}else d=null,p=a.fieldTransforms;return new fI(new Ke(h),d,p)}class Wu extends Zi{_toFieldTransform(e){if(2!==e.Iu)throw e.mu(1===e.Iu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Wu}}function gg(n,e,t){return new Xc({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class np extends Zi{_toFieldTransform(e){return new Mi(e.path,new Dn)}isEqual(e){return e instanceof np}}class mI extends Zi{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=gg(this,e,!0),r=this.yu.map(s=>ji(s,t)),i=new ir(r);return new Mi(e.path,i)}isEqual(e){return this===e}}class gI extends Zi{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=gg(this,e,!0),r=this.yu.map(s=>ji(s,t)),i=new Pt(r);return new Mi(e.path,i)}isEqual(e){return this===e}}class _I extends Zi{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new sr(e.serializer,Ec(e.serializer,this.wu));return new Mi(e.path,t)}isEqual(e){return this===e}}function rp(n,e,t,r){const i=n.pu(1,e,t);sp("Data must be an object, but it was:",i,r);const s=[],a=Ke.empty();En(r,(d,p)=>{const m=th(e,d,t);p=(0,oe.m9)(p);const _=i.Ru(m);if(p instanceof Wu)s.push(m);else{const v=ji(p,_);null!=v&&(s.push(m),a.set(m,v))}});const h=new nt(s);return new pg(a,h,i.fieldTransforms)}function ip(n,e,t,r,i,s){const a=n.pu(1,e,t),h=[Gu(e,r,t)],d=[i];if(s.length%2!=0)throw new C(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<s.length;v+=2)h.push(Gu(e,s[v])),d.push(s[v+1]);const p=[],m=Ke.empty();for(let v=h.length-1;v>=0;--v)if(!vg(p,h[v])){const A=h[v];let V=d[v];V=(0,oe.m9)(V);const D=a.Ru(A);if(V instanceof Wu)p.push(A);else{const N=ji(V,D);null!=N&&(p.push(A),m.set(A,N))}}const _=new nt(p);return new pg(m,_,a.fieldTransforms)}function _g(n,e,t,r=!1){return ji(t,n.pu(r?4:3,e))}function ji(n,e){if(Ig(n=(0,oe.m9)(n)))return sp("Unsupported field value:",e,n),yg(n,e);if(n instanceof Zi)return function(r,i){if(!mg(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&4!==e.Iu)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const h of r){let d=ji(h,i.Vu(a));null==d&&(d={nullValue:"NULL_VALUE"}),s.push(d),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,oe.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Ec(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=Ie.fromDate(r);return{timestampValue:_o(i.serializer,s)}}if(r instanceof Ie){const s=new Ie(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:_o(i.serializer,s)}}if(r instanceof Jc)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof On)return{bytesValue:xp(i.serializer,r._byteString)};if(r instanceof Ee){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Id(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${Qc(r)}`)}(n,e)}function yg(n,e){const t={};return tc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):En(n,(r,i)=>{const s=ji(i,e.Eu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Ig(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Ie||n instanceof Jc||n instanceof On||n instanceof Ee||n instanceof Zi)}function sp(n,e,t){if(!Ig(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Qc(t);throw e.mu("an object"===r?n+" a custom object":n+" "+r)}var i}function Gu(n,e,t){if((e=(0,oe.m9)(e))instanceof ur)return e._internalPath;if("string"==typeof e)return th(n,e);throw nh("Field path arguments must be of type string or ",n,!1,void 0,t)}const yI=new RegExp("[~\\*/\\[\\]]");function th(n,e,t){if(e.search(yI)>=0)throw nh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ur(...e.split("."))._internalPath}catch{throw nh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function nh(n,e,t,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let d="";return(s||a)&&(d+=" (found",s&&(d+=` in field ${r}`),a&&(d+=` in document ${i}`),d+=")"),new C(R.INVALID_ARGUMENT,h+n+d)}function vg(n,e){return n.some(t=>t.isEqual(e))}class $u{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ee(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new II(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(rh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class II extends $u{data(){return super.data()}}function rh(n,e){return"string"==typeof e?th(n,e):e instanceof ur?e._internalPath:e._delegate._internalPath}function Tg(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new C(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class op{}class Zu extends op{}function Br(n,e,...t){let r=[];e instanceof op&&r.push(e),r=r.concat(t),function(s){const a=s.filter(d=>d instanceof Oo).length,h=s.filter(d=>d instanceof Ku).length;if(a>1||a>0&&h>0)throw new C(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Ku extends Zu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ku(e,t,r)}_apply(e){const t=this._parse(e);return Rg(e._query,t),new Je(e.firestore,e.converter,gu(e._query,t))}_parse(e){const t=Ki(e.firestore);return function(s,a,h,d,p,m,_){let v;if(p.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new C(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){wg(_,m);const A=[];for(const V of _)A.push(Ag(d,s,V));v={arrayValue:{values:A}}}else v=Ag(d,s,_)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||wg(_,m),v=_g(h,"where",_,"in"===m||"not-in"===m);return ee.create(p,m,v)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Oo extends op{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Oo(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:ue.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const h=s.getFlattenedFilters();for(const d of h)Rg(a,d),a=gu(a,d)}(e._query,t),new Je(e.firestore,e.converter,gu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ap extends Zu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ap(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new C(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new xi(s,a)}(e._query,this._field,this._direction);return new Je(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new rn(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class ih extends Zu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new ih(e,t,r)}_apply(e){return new Je(e.firestore,e.converter,Ni(e._query,this._limit,this._limitType))}}class sh extends Zu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new sh(e,t,r)}_apply(e){const t=Eg(e,this.type,this._docOrFields,this._inclusive);return new Je(e.firestore,e.converter,(s=t,new rn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class oh extends Zu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new oh(e,t,r)}_apply(e){const t=Eg(e,this.type,this._docOrFields,this._inclusive);return new Je(e.firestore,e.converter,(s=t,new rn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Eg(n,e,t,r){if(t[0]=(0,oe.m9)(t[0]),t[0]instanceof $u)return function(s,a,h,d,p){if(!d)throw new C(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${h}().`);const m=[];for(const _ of xr(s))if(_.field.isKeyField())m.push(tn(a,d.key));else{const v=d.data.field(_.field);if(Cr(v))throw new C(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===v){const A=_.field.canonicalString();throw new C(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}m.push(v)}return new bn(m,p)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Ki(n.firestore);return function(a,h,d,p,m,_){const v=a.explicitOrderBy;if(m.length>v.length)throw new C(R.INVALID_ARGUMENT,`Too many arguments provided to ${p}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const A=[];for(let V=0;V<m.length;V++){const D=m[V];if(v[V].field.isKeyField()){if("string"!=typeof D)throw new C(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${p}(), but got a ${typeof D}`);if(!mu(a)&&-1!==D.indexOf("/"))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${p}() must be a plain document ID, but '${D}' contains a slash.`);const N=a.path.child(ne.fromString(D));if(!M.isDocumentKey(N))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${p}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);const q=new M(N);A.push(tn(h,q))}else{const N=_g(d,p,D);A.push(N)}}return new bn(A,_)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Ag(n,e,t){if("string"==typeof(t=(0,oe.m9)(t))){if(""===t)throw new C(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!mu(e)&&-1!==t.indexOf("/"))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ne.fromString(t));if(!M.isDocumentKey(r))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return tn(n,new M(r))}if(t instanceof Ee)return tn(n,t._key);throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Qc(t)}.`)}function wg(n,e){if(!Array.isArray(n)||0===n.length)throw new C(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Rg(n,e){const t=function(i,s){for(const a of i)for(const h of a.getFlattenedFilters())if(s.indexOf(h.op)>=0)return h.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(R.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class up{convertValue(e,t="none"){switch(Pn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(en(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return En(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Jc(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=eo(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Pi(e));default:return null}}convertTimestamp(e){const t=An(e);return new Ie(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ne.fromString(e);W(qp(r));const i=new wn(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ah(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class CI extends up{constructor(e){super(),this.firestore=e}convertBytes(e){return new On(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}}class Hi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class lr extends $u{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ju(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(rh("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ju extends lr{data(e={}){return super.data(e)}}class zr{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Hi(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ju(this._firestore,this._userDataWriter,r.key,r,new Hi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(h=>({type:"added",doc:new ju(i._firestore,i._userDataWriter,h.doc.key,h.doc,new Hi(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(h=>s||3!==h.type).map(h=>{const d=new ju(i._firestore,i._userDataWriter,h.doc.key,h.doc,new Hi(i._snapshot.mutatedKeys.has(h.doc.key),i._snapshot.fromCache),i.query.converter);let p=-1,m=-1;return 0!==h.type&&(p=a.indexOf(h.doc.key),a=a.delete(h.doc.key)),1!==h.type&&(a=a.add(h.doc),m=a.indexOf(h.doc.key)),{type:xI(h.type),doc:d,oldIndex:p,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Sg(n,e){return n instanceof lr&&e instanceof lr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof zr&&e instanceof zr&&n._firestore===e._firestore&&ep(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Wr extends up{constructor(e){super(),this.firestore=e}convertBytes(e){return new On(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}}function Cg(n,e,t){n=ie(n,Ee);const r=ie(n.firestore,Te),i=ah(n.converter,e,t);return Mo(r,[eh(Ki(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ve.none())])}function bg(n,e,t,...r){n=ie(n,Ee);const i=ie(n.firestore,Te),s=Ki(i);let a;return a="string"==typeof(e=(0,oe.m9)(e))||e instanceof ur?ip(s,"updateDoc",n._key,e,t,r):rp(s,"updateDoc",n._key,e),Mo(i,[a.toMutation(n._key,ve.exists(!0))])}function xg(n,e){const t=ie(n.firestore,Te),r=Yc(n),i=ah(n.converter,e);return Mo(t,[eh(Ki(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ve.exists(!1))]).then(()=>r)}function Vg(n,...e){var t,r,i;n=(0,oe.m9)(n);let s={includeMetadataChanges:!1},a=0;"object"!=typeof e[a]||tp(e[a])||(s=e[a],a++);const h={includeMetadataChanges:s.includeMetadataChanges};if(tp(e[a])){const _=e[a];e[a]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[a+1]=null===(r=_.error)||void 0===r?void 0:r.bind(_),e[a+2]=null===(i=_.complete)||void 0===i?void 0:i.bind(_)}let d,p,m;if(n instanceof Ee)p=ie(n.firestore,Te),m=nr(n._key.path),d={next:_=>{e[a]&&e[a](lp(p,n,_))},error:e[a+1],complete:e[a+2]};else{const _=ie(n,Je);p=ie(_.firestore,Te),m=_._query;const v=new Wr(p);d={next:A=>{e[a]&&e[a](new zr(p,v,_,A))},error:e[a+1],complete:e[a+2]},Tg(n._query)}return function(v,A,V,D){const N=new Kc(D),q=new _f(A,N,V);return v.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return df(yield ko(v),q)})),()=>{N.Na(),v.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return pf(yield ko(v),q)}))}}(Ve(p),m,h,d)}function Mo(n,e){return function(r,i){const s=new Me;return r.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return function Ty(n,e,t){return Ef.apply(this,arguments)}(yield Qf(r),i,s)})),s.promise}(Ve(n),e)}function lp(n,e,t){const r=t.docs.get(e._key),i=new Wr(n);return new lr(n,i,e._key,r,new Hi(t.hasPendingWrites,t.fromCache),e.converter)}const KI={maxAttempts:5};class Dg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ki(e)}set(e,t,r){this._verifyNotCommitted();const i=Gr(e,this._firestore),s=ah(i.converter,t,r),a=eh(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(a.toMutation(i._key,ve.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Gr(e,this._firestore);let a;return a="string"==typeof(t=(0,oe.m9)(t))||t instanceof ur?ip(this._dataReader,"WriteBatch.update",s._key,t,r,i):rp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,ve.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Gr(e,this._firestore);return this._mutations=this._mutations.concat(new ce(t._key,ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Gr(n,e){if((n=(0,oe.m9)(n)).firestore!==e)throw new C(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class jI extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ki(t)}get(t){const r=Gr(t,this._firestore),i=new CI(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return U();const a=s[0];if(a.isFoundDocument())return new $u(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new $u(this._firestore,i,r._key,null,r.converter);throw U()})}set(t,r,i){const s=Gr(t,this._firestore),a=ah(s.converter,r,i),h=eh(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,h),this}update(t,r,i,...s){const a=Gr(t,this._firestore);let h;return h="string"==typeof(r=(0,oe.m9)(r))||r instanceof ur?ip(this._dataReader,"Transaction.update",a._key,r,i,s):rp(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,h),this}delete(t){const r=Gr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Gr(e,this._firestore),r=new Wr(this._firestore);return super.get(e).then(i=>new lr(this._firestore,r,t._key,i._document,new Hi(!1,!1),t.converter))}}function hp(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Mg(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Lg(){if(!function sd(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Xn=Fn.SDK_VERSION,(0,Fn._registerComponent)(new ol.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),h=new Te(new Gh(r.getProvider("auth-internal")),new $s(r.getProvider("app-check-internal")),function(p,m){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new C(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wn(p.options.projectId,m)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),h._setSettings(s),h},"PUBLIC").setMultipleInstances(!0)),(0,Fn.registerVersion)(Gl,"4.4.0",e),(0,Fn.registerVersion)(Gl,"4.4.0","esm2017")}();class Hu{constructor(e){this._delegate=e}static fromBase64String(e){return Lg(),new Hu(On.fromBase64String(e))}static fromUint8Array(e){return Mg(),new Hu(On.fromUint8Array(e))}toBase64(){return Lg(),this._delegate.toBase64()}toUint8Array(){return Mg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function dp(n){return function iv(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class sv{enableIndexedDbPersistence(e,t){return function rI(n,e){fg(n=ie(n,Te));const t=Ve(n);if(t._uninitializedComponentsProvider)throw new C(R.FAILED_PRECONDITION,"SDK cache is already specified.");tt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Do;return dg(t,i,new Wf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function iI(n){fg(n=ie(n,Te));const e=Ve(n);if(e._uninitializedComponentsProvider)throw new C(R.FAILED_PRECONDITION,"SDK cache is already specified.");tt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Do;return dg(e,r,new jm(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function sI(n){if(n._initialized&&!n._terminated)throw new C(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Me;return n._queue.enqueueAndForgetEvenWhileRestricted((0,S.Z)(function*(){try{yield(t=(0,S.Z)(function*(i){if(!ut.D())return Promise.resolve();const s=i+"main";yield ut.delete(s)}),function r(i){return t.apply(this,arguments)})(kd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Fg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof wn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&tt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){lg(this._delegate,e,t,r)}enableNetwork(){return function aI(n){return function zy(n){return n.asyncQueue.enqueue((0,S.Z)(function*(){const e=yield Ym(n),t=yield Jm(n);return e.setNetworkEnabled(!0),function(i){const s=O(i);return s.C_.delete(0),Fu(s)}(t)}))}(Ve(n=ie(n,Te)))}(this._delegate)}disableNetwork(){return function uI(n){return function Wy(n){return n.asyncQueue.enqueue((0,S.Z)(function*(){const e=yield Ym(n),t=yield Jm(n);return e.setNetworkEnabled(!1),(r=(0,S.Z)(function*(s){const a=O(s);a.C_.add(0),yield Ro(a),a.M_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(Ve(n=ie(n,Te)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,ig("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function oI(n){return function(t){const r=new Me;return t.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return function Ry(n,e){return Sf.apply(this,arguments)}(yield Qf(t),r)})),r.promise}(Ve(n=ie(n,Te)))}(this._delegate)}onSnapshotsInSync(e){return function FI(n,e){return function Zy(n,e){const t=new Kc(e);return n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return i=yield ko(n),s=t,O(i).q_.add(s),void s.next();var i,s})),()=>{t.Na(),n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return i=yield ko(n),s=t,void O(i).q_.delete(s);var i,s}))}}(Ve(n=ie(n,Te)),tp(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Lo(this,Xf(this._delegate,e))}catch(t){throw ht(t,"collection()","Firestore.collection()")}}doc(e){try{return new Wt(this,Yc(this._delegate,e))}catch(t){throw ht(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new dt(this,function Jy(n,e){if(n=ie(n,Bu),Jf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Je(n,null,(r=e,new rn(ne.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw ht(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function HI(n,e,t){n=ie(n,Te);const r=Object.assign(Object.assign({},KI),t);return function(s){if(s.maxAttempts<1)throw new C(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,a,h){const d=new Me;return s.asyncQueue.enqueueAndForget((0,S.Z)(function*(){const p=yield function Xm(n){return Hc(n).then(e=>e.datastore)}(s);new qy(s.asyncQueue,p,h,a,d).run()})),d.promise}(Ve(n),i=>e(new jI(n,i)),r)}(this._delegate,t=>e(new Ug(this,t)))}batch(){return Ve(this._delegate),new qg(new Dg(this._delegate,e=>Mo(this._delegate,e)))}loadBundle(e){return function lI(n,e){const t=Ve(n=ie(n,Te)),r=new eI;return function Ky(n,e,t,r){const i=function(a,h){let d;return d="string"==typeof a?Sc().encode(a):a,m=function(m,_){if(m instanceof Uint8Array)return Hm(m,_);if(m instanceof ArrayBuffer)return Hm(new Uint8Array(m),_);if(m instanceof ReadableStream)return m.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new Fy(m,h);var m}(t,Lu(e));n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){!function My(n,e,t){const r=O(n);var i;(i=(0,S.Z)(function*(a,h,d){try{const p=yield h.getMetadata();if(yield function(V,D){const N=O(V),q=Fe(D.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",Z=>N.Kr.getBundleMetadata(Z,D.id)).then(Z=>!!Z&&Z.createTime.compareTo(q)>=0)}(a.localStore,p))return yield h.close(),d._completeWith({taskState:"Success",documentsLoaded:(V=p).totalDocuments,bytesLoaded:V.totalBytes,totalDocuments:V.totalDocuments,totalBytes:V.totalBytes}),Promise.resolve(new Set);d._updateProgress(Um(p));const m=new my(p,a.localStore,h.serializer);let _=yield h.Ma();for(;_;){const A=yield m.ea(_);A&&d._updateProgress(A),_=yield h.Ma()}const v=yield m.complete();return yield ar(a,v.ra,void 0),yield function(V,D){const N=O(V);return N.persistence.runTransaction("Save bundle","readwrite",q=>N.Kr.saveBundleMetadata(q,D))}(a.localStore,p),d._completeWith(v.progress),Promise.resolve(v.na)}catch(p){return tt("SyncEngine",`Loading bundle failed with ${p}`),d._failWith(p),Promise.resolve(new Set)}var V}),function s(a,h,d){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Qf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function cI(n,e){return function jy(n,e){return n.asyncQueue.enqueue((0,S.Z)(function*(){return function(r,i){const s=O(r);return s.persistence.runTransaction("Get named query","readonly",a=>s.Kr.getNamedQuery(a,i))}(yield No(n),e)}))}(Ve(n=ie(n,Te)),e).then(t=>t?new Je(n,null,t.query):null)}(this._delegate,e).then(t=>t?new dt(this,t):null)}}class lh extends up{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hu(new On(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Wt.forKey(t,this.firestore,null)}}class Ug{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new lh(e)}get(e){const t=Yi(e);return this._delegate.get(t).then(r=>new Qu(this._firestore,new lr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Yi(e);return r?(hp("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Yi(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Yi(e);return this._delegate.delete(t),this}}class qg{constructor(e){this._delegate=e}set(e,t,r){const i=Yi(e);return r?(hp("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Yi(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Yi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Qi{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new ju(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Yu(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Qi.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Qi(e,new lh(e),t),i.set(t,s)),s}}Qi.INSTANCES=new WeakMap;class Wt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lh(e)}static forPath(e,t,r){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Wt(t,new Ee(t._delegate,r,new M(e)))}static forKey(e,t,r){return new Wt(t,new Ee(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Lo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Lo(this.firestore,Xf(this._delegate,e))}catch(t){throw ht(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,oe.m9)(e))instanceof Ee&&cg(this._delegate,e)}set(e,t){t=hp("DocumentReference.set",t);try{return t?Cg(this._delegate,e,t):Cg(this._delegate,e)}catch(r){throw ht(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?bg(this._delegate,e):bg(this._delegate,e,t,...r)}catch(i){throw ht(i,"updateDoc()","DocumentReference.update()")}}delete(){return function LI(n){return Mo(ie(n.firestore,Te),[new ce(n._key,ve.none())])}(this._delegate)}onSnapshot(...e){const t=Bg(e),r=zg(e,i=>new Qu(this.firestore,new lr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Vg(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function DI(n){n=ie(n,Ee);const e=ie(n.firestore,Te),t=Ve(e),r=new Wr(e);return function Gy(n,e){const t=new Me;return n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return(r=(0,S.Z)(function*(s,a,h){try{const d=yield function(m,_){const v=O(m);return v.persistence.runTransaction("read document","readonly",A=>v.localDocuments.getDocument(A,_))}(s,a);d.isFoundDocument()?h.resolve(d):d.isNoDocument()?h.resolve(null):h.reject(new C(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const p=Co(d,`Failed to get document '${a} from cache`);h.reject(p)}}),function i(s,a,h){return r.apply(this,arguments)})(yield No(n),e,t);var r})),t.promise}(t,n._key).then(i=>new lr(e,r,n._key,i,new Hi(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function NI(n){n=ie(n,Ee);const e=ie(n.firestore,Te);return eg(Ve(e),n._key,{source:"server"}).then(t=>lp(e,n,t))}(this._delegate):function VI(n){n=ie(n,Ee);const e=ie(n.firestore,Te);return eg(Ve(e),n._key).then(t=>lp(e,n,t))}(this._delegate),t.then(r=>new Qu(this.firestore,new lr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Wt(this.firestore,this._delegate.withConverter(e?Qi.getInstance(this.firestore,e):null))}}function ht(n,e,t){return n.message=n.message.replace(e,t),n}function Bg(n){for(const e of n)if("object"==typeof e&&!dp(e))return e;return{}}function zg(n,e){var t,r;let i;return i=dp(n[0])?n[0]:dp(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Qu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Wt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Sg(this._delegate,e._delegate)}}class Yu extends Qu{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Bh(n,e){n||U()}(void 0!==t),t}}class dt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new lh(e)}where(e,t,r){try{return new dt(this.firestore,Br(this._delegate,function vI(n,e,t){const r=e,i=rh("where",n);return Ku._create(i,r,t)}(e,t,r)))}catch(i){throw ht(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new dt(this.firestore,Br(this._delegate,function TI(n,e="asc"){const t=e,r=rh("orderBy",n);return ap._create(r,t)}(e,t)))}catch(r){throw ht(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new dt(this.firestore,Br(this._delegate,function EI(n){return ag("limit",n),ih._create("limit",n,"F")}(e)))}catch(t){throw ht(t,"limit()","Query.limit()")}}limitToLast(e){try{return new dt(this.firestore,Br(this._delegate,function AI(n){return ag("limitToLast",n),ih._create("limitToLast",n,"L")}(e)))}catch(t){throw ht(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new dt(this.firestore,Br(this._delegate,function wI(...n){return sh._create("startAt",n,!0)}(...e)))}catch(t){throw ht(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new dt(this.firestore,Br(this._delegate,function RI(...n){return sh._create("startAfter",n,!1)}(...e)))}catch(t){throw ht(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new dt(this.firestore,Br(this._delegate,function PI(...n){return oh._create("endBefore",n,!1)}(...e)))}catch(t){throw ht(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new dt(this.firestore,Br(this._delegate,function SI(...n){return oh._create("endAt",n,!0)}(...e)))}catch(t){throw ht(t,"endAt()","Query.endAt()")}}isEqual(e){return ep(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function OI(n){n=ie(n,Je);const e=ie(n.firestore,Te),t=Ve(e),r=new Wr(e);return function $y(n,e){const t=new Me;return n.asyncQueue.enqueueAndForget((0,S.Z)(function*(){return(r=(0,S.Z)(function*(s,a,h){try{const d=yield qc(s,a,!0),p=new zm(a,d.ls),m=p.ca(d.documents),_=p.applyChanges(m,!1);h.resolve(_.snapshot)}catch(d){const p=Co(d,`Failed to execute query '${a} against cache`);h.reject(p)}}),function i(s,a,h){return r.apply(this,arguments)})(yield No(n),e,t);var r})),t.promise}(t,n._query).then(i=>new zr(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function MI(n){n=ie(n,Je);const e=ie(n.firestore,Te),t=Ve(e),r=new Wr(e);return tg(t,n._query,{source:"server"}).then(i=>new zr(e,r,n,i))}(this._delegate):function kI(n){n=ie(n,Je);const e=ie(n.firestore,Te),t=Ve(e),r=new Wr(e);return Tg(n._query),tg(t,n._query).then(i=>new zr(e,r,n,i))}(this._delegate),t.then(r=>new fp(this.firestore,new zr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Bg(e),r=zg(e,i=>new fp(this.firestore,new zr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Vg(this._delegate,t,r)}withConverter(e){return new dt(this.firestore,this._delegate.withConverter(e?Qi.getInstance(this.firestore,e):null))}}class av{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Yu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class fp{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new dt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Yu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new av(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Yu(this._firestore,r))})}isEqual(e){return Sg(this._delegate,e._delegate)}}class Lo extends dt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Wt(this.firestore,e):null}doc(e){try{return new Wt(this.firestore,void 0===e?Yc(this._delegate):Yc(this._delegate,e))}catch(t){throw ht(t,"doc()","CollectionReference.doc()")}}add(e){return xg(this._delegate,e).then(t=>new Wt(this.firestore,t))}isEqual(e){return cg(this._delegate,e._delegate)}withConverter(e){return new Lo(this.firestore,this._delegate.withConverter(e?Qi.getInstance(this.firestore,e):null))}}function Yi(n){return ie(n,Ee)}class pp{constructor(...e){this._delegate=new ur(...e)}static documentId(){return new pp(ge.keyField().canonicalString())}isEqual(e){return(e=(0,oe.m9)(e))instanceof ur&&this._delegate._internalPath.isEqual(e._internalPath)}}class Ji{constructor(e){this._delegate=e}static serverTimestamp(){const e=function YI(){return new np("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Ji(e)}static delete(){const e=function QI(){return new Wu("deleteField")}();return e._methodName="FieldValue.delete",new Ji(e)}static arrayUnion(...e){const t=function JI(...n){return new mI("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Ji(t)}static arrayRemove(...e){const t=function XI(...n){return new gI("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Ji(t)}static increment(e){const t=function ev(n){return new _I("increment",n)}(e);return t._methodName="FieldValue.increment",new Ji(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const uv={Firestore:Fg,GeoPoint:Jc,Timestamp:Ie,Blob:Hu,Transaction:Ug,WriteBatch:qg,DocumentReference:Wt,DocumentSnapshot:Qu,Query:dt,QueryDocumentSnapshot:Yu,QuerySnapshot:fp,CollectionReference:Lo,FieldPath:pp,FieldValue:Ji,setLogLevel:function ov(n){!function $l(n){_n.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function Wg(n,e){return function hv(n,e=Ko.z){return new Fo.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function mp(n,e){return Wg(n,e).pipe((0,se.U)(t=>({payload:t,type:"query"})))}!function cv(n){(function lv(n,e){n.INTERNAL.registerComponent(new ol.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},uv)))})(n,(e,t)=>new Fg(e,t,new sv)),n.registerVersion("@firebase/firestore-compat","0.3.23")}(sl.Z);class Gg{constructor(e,t){(0,Pe.Z)(this,"ref",void 0),(0,Pe.Z)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=jg(r,t);return new Kg(i,s,this.afs)}snapshotChanges(){return function dv(n,e){return Wg(n,e).pipe((0,ss.O)(void 0),jo(),(0,se.U)(t=>{const[r,i]=t;return i.exists?null!=r&&r.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,se.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,sn.D)(this.ref.get(e)).pipe(Ce.iC)}}function ch(n,e){return mp(n,e).pipe((0,ss.O)(void 0),jo(),(0,se.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),a=s.map(h=>({type:h.type,payload:h}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((h,d)=>{const p=s.find(_=>_.doc.ref.isEqual(h.ref)),m=null==r?void 0:r.payload.docs.find(_=>_.ref.isEqual(h.ref));p&&JSON.stringify(p.doc.metadata)===JSON.stringify(h.metadata)||!p&&m&&JSON.stringify(m.metadata)===JSON.stringify(h.metadata)||a.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:h}})}),a}))}function $g(n,e,t){return ch(n,t).pipe((0,Ln.R)((r,i)=>function fv(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function pv(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return gp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return gp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return gp(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,il.x)(),(0,se.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function gp(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Zg(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Kg{constructor(e,t,r){(0,Pe.Z)(this,"ref",void 0),(0,Pe.Z)(this,"query",void 0),(0,Pe.Z)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ch(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,se.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,ss.O)(void 0),jo(),(0,Wo.h)(([r,i])=>i.length>0||!r),(0,se.U)(([,r])=>r),Ce.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Ln.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Zg(e);return $g(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}valueChanges(e={}){return mp(this.query,this.afs.schedulers.outsideAngular).pipe((0,se.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),Ce.iC)}get(e){return(0,sn.D)(this.query.get(e)).pipe(Ce.iC)}add(e){return this.ref.add(e)}doc(e){return new Gg(this.ref.doc(e),this.afs)}}class mv{constructor(e,t){(0,Pe.Z)(this,"query",void 0),(0,Pe.Z)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ch(this.query,this.afs.schedulers.outsideAngular).pipe((0,se.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Wo.h)(t=>t.length>0),Ce.iC):ch(this.query,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Ln.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Zg(e);return $g(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ce.iC)}valueChanges(e={}){return mp(this.query,this.afs.schedulers.outsideAngular).pipe((0,se.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ce.iC)}get(e){return(0,sn.D)(this.query.get(e)).pipe(Ce.iC)}}const gv=new w.OlP("angularfire2.enableFirestorePersistence"),_v=new w.OlP("angularfire2.firestore.persistenceSettings"),yv=new w.OlP("angularfire2.firestore.settings"),Iv=new w.OlP("angularfire2.firestore.use-emulator");function jg(n,e=(t=>t)){return{query:e(n),ref:n}}let vv=(()=>{var n;class e{constructor(r,i,s,a,h,d,p,m,_,v,A,V,D,N,q,Z,K){(0,Pe.Z)(this,"schedulers",void 0),(0,Pe.Z)(this,"firestore",void 0),(0,Pe.Z)(this,"persistenceEnabled$",void 0),this.schedulers=p;const G=(0,Xe.on)(r,d,i),X=_;v&&Zo(G,d,A,D,N,q,V,Z),[this.firestore,this.persistenceEnabled$]=(0,Xe.cc)(`${G.name}.firestore`,"AngularFirestore",G.name,()=>{const J=d.runOutsideAngular(()=>G.firestore());if(a&&J.settings(a),X&&J.useEmulator(...X),s&&!(0,I.PM)(h)){const Ue=()=>{try{return(0,sn.D)(J.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(It){return typeof console<"u"&&console.warn(It),(0,Tt.of)(!1)}};return[J,d.runOutsideAngular(Ue)]}return[J,(0,Tt.of)(!1)]},[a,X,s])}collection(r,i){let s;s="string"==typeof r?this.firestore.collection(r):r;const{ref:a,query:h}=jg(s,i),d=this.schedulers.ngZone.run(()=>a);return new Kg(d,h,this)}collectionGroup(r,i){const s=i||(h=>h),a=this.firestore.collectionGroup(r);return new mv(s(a),this)}doc(r){let i;i="string"==typeof r?this.firestore.doc(r):r;const s=this.schedulers.ngZone.run(()=>i);return new Gg(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n=e,(0,Pe.Z)(e,"\u0275fac",function(r){return new(r||n)(w.LFG(Xe.Dh),w.LFG(Xe.xv,8),w.LFG(gv,8),w.LFG(yv,8),w.LFG(w.Lbi),w.LFG(w.R0b),w.LFG(Ce.HU),w.LFG(_v,8),w.LFG(Iv,8),w.LFG(is,8),w.LFG($o,8),w.LFG(nl,8),w.LFG(rl,8),w.LFG(he,8),w.LFG(de,8),w.LFG(rs,8),w.LFG(Ce.Rf,8))}),(0,Pe.Z)(e,"\u0275prov",w.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})),e})();j(3182);const bv=(0,Ce.u3)(xg,!0),xv=(0,Ce.u3)(Xf,!0),Vv=(0,Ce.u3)(nI,!0);let Dv=(()=>{var n;class e{constructor(){this.firestore=(0,w.f3M)(vv)}addVisit(r){return bv(xv(Vv(),"visits"),r)}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=w.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();function Nv(n,e){1&n&&(w.TgZ(0,"ion-text",19),w._uU(1," Ingresa un nombre v\xe1lido. "),w.qZA())}function kv(n,e){1&n&&(w.TgZ(0,"ion-text",19),w._uU(1," Ingresa un RUT v\xe1lido. "),w.qZA())}function Ov(n,e){1&n&&(w.TgZ(0,"ion-text",19),w._uU(1," Ingresa un n\xfamero de tel\xe9fono v\xe1lido. "),w.qZA())}function Mv(n,e){1&n&&(w.TgZ(0,"ion-text",19),w._uU(1," Ingresa un departamento v\xe1lido. "),w.qZA())}function Lv(n,e){1&n&&w._UZ(0,"ion-spinner",20)}function Fv(n,e){1&n&&(w.TgZ(0,"ion-text",21),w._uU(1," Complete de manera correcta los campos inv\xe1lidos. "),w.qZA())}const Uv=[{path:"",component:(()=>{var n;class e{constructor(r,i,s){this.firestoreService=r,this.alertController=i,this.router=s,this.nuevaVisita={fullName:"",rut:{numero:"",digitoVerificador:""},phoneNumber:"+56",department:"",tower:""},this.nombreInvalido=!1,this.telefonoInvalido=!1,this.rutInvalido=!1,this.departamentoInvalido=!1,this.formularioInvalido=!1,this.cargando=!1}ngOnInit(){}agregarVisita(){var r=this;return(0,S.Z)(function*(){if(r.cargando=!0,r.validarNombre()&&r.validarRut()&&r.validarTelefono()&&r.validarDepartamento())try{r.nuevaVisita.fechaHora=new Date,yield r.firestoreService.addVisit(r.nuevaVisita),r.mostrarAlerta("Visita ingresada"),r.router.navigate(["/out-home"]),r.nuevaVisita={fullName:"",rut:{numero:"",digitoVerificador:""},phoneNumber:"+56",department:"",tower:""},r.nombreInvalido=!1,r.telefonoInvalido=!1,r.rutInvalido=!1,r.departamentoInvalido=!1}catch(i){console.error("Error al agregar visita:",i)}finally{r.cargando=!1}else r.formularioInvalido=!0,r.cargando=!1})()}validarNombre(){return this.nombreInvalido=!this.nuevaVisita.fullName||this.nuevaVisita.fullName.length<4||!/^[a-zA-Z\s]+$/g.test(this.nuevaVisita.fullName),!this.nombreInvalido}validarRut(){const r=this.nuevaVisita.rut.numero,i=this.nuevaVisita.rut.digitoVerificador;return!r||r.length<4||!/^[0-9]+$/g.test(r)?(this.rutInvalido=!0,!1):this.validarDigitoVerificador(r,i)?(this.rutInvalido=!1,!0):(this.rutInvalido=!0,!1)}validarDigitoVerificador(r,i){return i===this.calcularDigitoVerificador(r)}calcularDigitoVerificador(r){let i=0,s=2;for(let h=r.length-1;h>=0;h--)i+=parseInt(r.charAt(h),10)*s,s=s<7?s+1:2;const a=11-i%11;return 11===a?"0":10===a?"k":a.toString()}validarTelefono(){return this.telefonoInvalido=!this.nuevaVisita.phoneNumber||!/^\+56\d{9}$/.test(this.nuevaVisita.phoneNumber),!this.telefonoInvalido}validarDepartamento(){return this.departamentoInvalido=!this.nuevaVisita.department||!/^\d{3,3}$/.test(this.nuevaVisita.department),!this.departamentoInvalido}mostrarAlerta(r){var i=this;return(0,S.Z)(function*(){yield(yield i.alertController.create({header:"Alerta",message:r,buttons:["OK"]})).present()})()}}return(n=e).\u0275fac=function(r){return new(r||n)(w.Y36(Dv),w.Y36(Se.Br),w.Y36(vt.F0))},n.\u0275cmp=w.Xpm({type:n,selectors:[["app-home"]],decls:43,vars:13,consts:[[2,"text-align","center"],[1,"ion-padding"],[1,"registro-card",2,"margin-top","40%"],["position","floating",1,"label"],["name","fullName","type","text",1,"input",3,"ngModel","ngModelChange","ionChange"],["color","danger",4,"ngIf"],[2,"display","flex","align-items","center"],["name","rutNumero","type","text",1,"input",2,"flex","80%",3,"ngModel","ngModelChange","ionChange"],[1,"guion",2,"flex","10%","text-align","center"],["name","rutDigitoVerificador","type","text",1,"input",2,"flex","10%",3,"ngModel","ngModelChange","ionChange"],["name","phoneNumber","type","tel",1,"input",3,"ngModel","ngModelChange","ionChange"],["name","department","type","text",1,"input",3,"ngModel","ngModelChange","ionChange"],[1,"label"],["name","tower",1,"select",3,"ngModel","ngModelChange"],["value","A"],["value","B"],["class","spinner",4,"ngIf"],["shape","round","expand","block",1,"boton",3,"disabled","click"],["color","danger","class","error-message",4,"ngIf"],["color","danger"],[1,"spinner"],["color","danger",1,"error-message"]],template:function(r,i){1&r&&(w.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",0),w._uU(3," Registro de Visitas "),w.qZA()()(),w.TgZ(4,"ion-content",1)(5,"ion-card",2)(6,"ion-card-content")(7,"ion-item")(8,"ion-label",3),w._uU(9,"Nombre Completo"),w.qZA(),w.TgZ(10,"ion-input",4),w.NdJ("ngModelChange",function(a){return i.nuevaVisita.fullName=a})("ionChange",function(){return i.validarNombre()}),w.qZA()(),w.YNc(11,Nv,2,0,"ion-text",5),w.TgZ(12,"ion-item")(13,"ion-label",3),w._uU(14,"RUT"),w.qZA(),w.TgZ(15,"div",6)(16,"ion-input",7),w.NdJ("ngModelChange",function(a){return i.nuevaVisita.rut.numero=a})("ionChange",function(){return i.validarRut()}),w.qZA(),w.TgZ(17,"ion-text",8),w._uU(18,"-"),w.qZA(),w.TgZ(19,"ion-input",9),w.NdJ("ngModelChange",function(a){return i.nuevaVisita.rut.digitoVerificador=a})("ionChange",function(){return i.validarRut()}),w.qZA()()(),w.YNc(20,kv,2,0,"ion-text",5),w.TgZ(21,"ion-item")(22,"ion-label",3),w._uU(23,"N\xfamero de Tel\xe9fono"),w.qZA(),w.TgZ(24,"ion-input",10),w.NdJ("ngModelChange",function(a){return i.nuevaVisita.phoneNumber=a})("ionChange",function(){return i.validarTelefono()}),w.qZA()(),w.YNc(25,Ov,2,0,"ion-text",5),w.TgZ(26,"ion-item")(27,"ion-label",3),w._uU(28,"Departamento"),w.qZA(),w.TgZ(29,"ion-input",11),w.NdJ("ngModelChange",function(a){return i.nuevaVisita.department=a})("ionChange",function(){return i.validarDepartamento()}),w.qZA()(),w.YNc(30,Mv,2,0,"ion-text",5),w.TgZ(31,"ion-item")(32,"ion-label",12),w._uU(33,"Torre"),w.qZA(),w.TgZ(34,"ion-select",13),w.NdJ("ngModelChange",function(a){return i.nuevaVisita.tower=a}),w.TgZ(35,"ion-select-option",14),w._uU(36,"A"),w.qZA(),w.TgZ(37,"ion-select-option",15),w._uU(38,"B"),w.qZA()()(),w.YNc(39,Lv,1,0,"ion-spinner",16),w.TgZ(40,"ion-button",17),w.NdJ("click",function(){return i.agregarVisita()}),w._uU(41," Registrar Visita "),w.qZA(),w.YNc(42,Fv,2,0,"ion-text",18),w.qZA()()()),2&r&&(w.xp6(10),w.Q6J("ngModel",i.nuevaVisita.fullName),w.xp6(1),w.Q6J("ngIf",i.nombreInvalido),w.xp6(5),w.Q6J("ngModel",i.nuevaVisita.rut.numero),w.xp6(3),w.Q6J("ngModel",i.nuevaVisita.rut.digitoVerificador),w.xp6(1),w.Q6J("ngIf",i.rutInvalido),w.xp6(4),w.Q6J("ngModel",i.nuevaVisita.phoneNumber),w.xp6(1),w.Q6J("ngIf",i.telefonoInvalido),w.xp6(4),w.Q6J("ngModel",i.nuevaVisita.department),w.xp6(1),w.Q6J("ngIf",i.departamentoInvalido),w.xp6(4),w.Q6J("ngModel",i.nuevaVisita.tower),w.xp6(5),w.Q6J("ngIf",i.cargando),w.xp6(1),w.Q6J("disabled",i.cargando),w.xp6(2),w.Q6J("ngIf",i.formularioInvalido))},dependencies:[I.O5,x.JJ,x.On,Se.YG,Se.PM,Se.FN,Se.W2,Se.Gu,Se.pK,Se.Ie,Se.Q$,Se.t9,Se.n0,Se.PQ,Se.yW,Se.wd,Se.sr,Se.QI,Se.j9],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}"]}),e})()}];let qv=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=w.oAB({type:n}),n.\u0275inj=w.cJS({imports:[vt.Bz.forChild(Uv),vt.Bz]}),e})(),Bv=(()=>{var n;class e{}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275mod=w.oAB({type:n}),n.\u0275inj=w.cJS({imports:[I.ez,x.u5,Se.Pc,qv]}),e})()},6230:(Jg,Ju,j)=>{j.r(Ju);var I=j(5861),Se=j(3106),x=j(9058),vt=j(534),S=j(7879),w=j(7582),Pe=j(4537);const Xe={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const dh=function Fo(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},Uo=function sn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},el=new x.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Xi=new S.Yd("@firebase/auth");function Et(l,...o){Xi.logLevel<=S.in.ERROR&&Xi.error(`Auth (${vt.SDK_VERSION}): ${l}`,...o)}function se(l,...o){throw ts(l,...o)}function Ge(l,...o){return ts(l,...o)}function tl(l,o,u){const c=Object.assign(Object.assign({},Uo()),{[o]:u});return new x.LL("auth","Firebase",c).create(o,{appName:l.name})}function Mn(l,o,u){if(!(o instanceof u))throw u.name!==o.constructor.name&&se(l,"argument-error"),tl(l,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ts(l,...o){if("string"!=typeof l){const u=o[0],c=[...o.slice(1)];return c[0]&&(c[0].appName=l.name),l._errorFactory.create(u,...c)}return el.create(l,...o)}function k(l,o,...u){if(!l)throw ts(o,...u)}function ft(l){const o="INTERNAL ASSERTION FAILED: "+l;throw Et(o),new Error(o)}function pt(l,o){l||ft(o)}function $r(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function qo(){return"http:"===Bo()||"https:"===Bo()}function Bo(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class ns{constructor(o,u){this.shortDelay=o,this.longDelay=u,pt(u>o,"Short delay should be less than long delay!"),this.isMobile=(0,x.uI)()||(0,x.b$)()}get(){return function zo(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(qo()||(0,x.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Go(l,o){pt(l.emulator,"Emulator should always be set here");const{url:u}=l.emulator;return o?`${u}${o.startsWith("/")?o.slice(1):o}`:u}class $o{static initialize(o,u,c){this.fetchImpl=o,u&&(this.headersImpl=u),c&&(this.responseImpl=c)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const nl={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},rl=new ns(3e4,6e4);function he(l,o){return l.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:l.tenantId}):o}function de(l,o,u,c){return rs.apply(this,arguments)}function rs(){return(rs=(0,I.Z)(function*(l,o,u,c,f={}){return Zo(l,f,(0,I.Z)(function*(){let g={},y={};c&&("GET"===o?y=c:g={body:JSON.stringify(c)});const T=(0,x.xO)(Object.assign({key:l.config.apiKey},y)).slice(1),P=yield l._getAdditionalHeaders();return P["Content-Type"]="application/json",l.languageCode&&(P["X-Firebase-Locale"]=l.languageCode),$o.fetch()(ss(l,l.config.apiHost,u,T),Object.assign({method:o,headers:P,referrerPolicy:"no-referrer"},g))}))})).apply(this,arguments)}function Zo(l,o,u){return is.apply(this,arguments)}function is(){return(is=(0,I.Z)(function*(l,o,u){l._canInitEmulator=!1;const c=Object.assign(Object.assign({},nl),o);try{const f=new jo(l),g=yield Promise.race([u(),f.promise]);f.clearNetworkTimeout();const y=yield g.json();if("needConfirmation"in y)throw Ln(l,"account-exists-with-different-credential",y);if(g.ok&&!("errorMessage"in y))return y;{const T=g.ok?y.errorMessage:y.error.message,[P,L]=T.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===P)throw Ln(l,"credential-already-in-use",y);if("EMAIL_EXISTS"===P)throw Ln(l,"email-already-in-use",y);if("USER_DISABLED"===P)throw Ln(l,"user-disabled",y);const B=c[P]||P.toLowerCase().replace(/[_\s]+/g,"-");if(L)throw tl(l,B,L);se(l,B)}}catch(f){if(f instanceof x.ZR)throw f;se(l,"network-request-failed",{message:String(f)})}})).apply(this,arguments)}function on(l,o,u,c){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,I.Z)(function*(l,o,u,c,f={}){const g=yield de(l,o,u,c,f);return"mfaPendingCredential"in g&&se(l,"multi-factor-auth-required",{_serverResponse:g}),g})).apply(this,arguments)}function ss(l,o,u,c){const f=`${o}${u}?${c}`;return l.config.emulator?Go(l.config,f):`${l.config.apiScheme}://${f}`}function ph(l){switch(l){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class jo{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((u,c)=>{this.timer=setTimeout(()=>c(Ge(this.auth,"network-request-failed")),rl.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ln(l,o,u){const c={appName:l.name};u.email&&(c.email=u.email),u.phoneNumber&&(c.phoneNumber=u.phoneNumber);const f=Ge(l,o,c);return f.customData._tokenResponse=u,f}function il(l){return void 0!==l&&void 0!==l.getResponse}function sl(l){return void 0!==l&&void 0!==l.enterprise}class Fn{constructor(o){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===o.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=o.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=o.recaptchaEnforcementState}getProviderEnforcementState(o){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const u of this.recaptchaEnforcementState)if(u.provider&&u.provider===o)return ph(u.enforcementState);return null}isProviderEnabled(o){return"ENFORCE"===this.getProviderEnforcementState(o)||"AUDIT"===this.getProviderEnforcementState(o)}}function mt(){return(mt=(0,I.Z)(function*(l){return(yield de(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function oe(l,o){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,I.Z)(function*(l,o){return de(l,"GET","/v2/recaptchaConfig",he(l,o))})).apply(this,arguments)}function F(){return(F=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function Q(){return(Q=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Un(){return(Un=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Zr(l){if(l)try{const o=new Date(Number(l));if(!isNaN(o.getTime()))return o.toUTCString()}catch{}}function Yo(){return(Yo=(0,I.Z)(function*(l,o=!1){const u=(0,x.m9)(l),c=yield u.getIdToken(o),f=De(c);k(f&&f.exp&&f.auth_time&&f.iat,u.auth,"internal-error");const g="object"==typeof f.firebase?f.firebase:void 0,y=null==g?void 0:g.sign_in_provider;return{claims:f,token:c,authTime:Zr(Jo(f.auth_time)),issuedAtTime:Zr(Jo(f.iat)),expirationTime:Zr(Jo(f.exp)),signInProvider:y||null,signInSecondFactor:(null==g?void 0:g.sign_in_second_factor)||null}})).apply(this,arguments)}function Jo(l){return 1e3*Number(l)}function De(l){const[o,u,c]=l.split(".");if(void 0===o||void 0===u||void 0===c)return Et("JWT malformed, contained fewer than 3 sections"),null;try{const f=(0,x.tV)(u);return f?JSON.parse(f):(Et("Failed to decode base64 JWT payload"),null)}catch(f){return Et("Caught error parsing JWT payload as JSON",null==f?void 0:f.toString()),null}}function fe(l,o){return St.apply(this,arguments)}function St(){return(St=(0,I.Z)(function*(l,o,u=!1){if(u)return o;try{return yield o}catch(c){throw c instanceof x.ZR&&function gh({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(c)&&l.auth.currentUser===l&&(yield l.auth.signOut()),c}})).apply(this,arguments)}class ul{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var u;if(o){const c=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),c}{this.errorBackoff=3e4;const f=(null!==(u=this.user.stsTokenManager.expirationTime)&&void 0!==u?u:0)-Date.now()-3e5;return Math.max(0,f)}}schedule(o=!1){var u=this;if(!this.isRunning)return;const c=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield u.iteration()}),c)}iteration(){var o=this;return(0,I.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(u){return void("auth/network-request-failed"===(null==u?void 0:u.code)&&o.schedule(!0))}o.schedule()})()}}class us{constructor(o,u){this.createdAt=o,this.lastLoginAt=u,this._initializeTime()}_initializeTime(){this.lastSignInTime=Zr(this.lastLoginAt),this.creationTime=Zr(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function cr(l){return qe.apply(this,arguments)}function qe(){return qe=(0,I.Z)(function*(l){var o;const u=l.auth,c=yield l.getIdToken(),f=yield fe(l,function os(l,o){return Un.apply(this,arguments)}(u,{idToken:c}));k(null==f?void 0:f.users.length,u,"internal-error");const g=f.users[0];l._notifyReloadListener(g);const y=null!==(o=g.providerUserInfo)&&void 0!==o&&o.length?function Ct(l){return l.map(o=>{var{providerId:u}=o,c=(0,w._T)(o,["providerId"]);return{providerId:u,uid:c.rawId||"",displayName:c.displayName||null,email:c.email||null,phoneNumber:c.phoneNumber||null,photoURL:c.photoUrl||null}})}(g.providerUserInfo):[],T=function ls(l,o){return[...l.filter(c=>!o.some(f=>f.providerId===c.providerId)),...o]}(l.providerData,y),B=!!l.isAnonymous&&!(l.email&&g.passwordHash||null!=T&&T.length),z={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:T,metadata:new us(g.createdAt,g.lastLoginAt),isAnonymous:B};Object.assign(l,z)}),qe.apply(this,arguments)}function qn(){return(qn=(0,I.Z)(function*(l){const o=(0,x.m9)(l);yield cr(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function ea(){return(ea=(0,I.Z)(function*(l,o){const u=yield Zo(l,{},(0,I.Z)(function*(){const c=(0,x.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:f,apiKey:g}=l.config,y=ss(l,f,"/v1/token",`key=${g}`),T=yield l._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",$o.fetch()(y,{method:"POST",headers:T,body:c})}));return{accessToken:u.access_token,expiresIn:u.expires_in,refreshToken:u.refresh_token}})).apply(this,arguments)}function an(){return(an=(0,I.Z)(function*(l,o){return de(l,"POST","/v2/accounts:revokeToken",he(l,o))})).apply(this,arguments)}class hr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){k(o.idToken,"internal-error"),k(typeof o.idToken<"u","internal-error"),k(typeof o.refreshToken<"u","internal-error");const u="expiresIn"in o&&typeof o.expiresIn<"u"?Number(o.expiresIn):function as(l){const o=De(l);return k(o,"internal-error"),k(typeof o.exp<"u","internal-error"),k(typeof o.iat<"u","internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,u)}getToken(o,u=!1){var c=this;return(0,I.Z)(function*(){return k(!c.accessToken||c.refreshToken,o,"user-token-expired"),u||!c.accessToken||c.isExpired?c.refreshToken?(yield c.refresh(o,c.refreshToken),c.accessToken):null:c.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,u){var c=this;return(0,I.Z)(function*(){const{accessToken:f,refreshToken:g,expiresIn:y}=yield function Xo(l,o){return ea.apply(this,arguments)}(o,u);c.updateTokensAndExpiration(f,g,Number(y))})()}updateTokensAndExpiration(o,u,c){this.refreshToken=u||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*c}static fromJSON(o,u){const{refreshToken:c,accessToken:f,expirationTime:g}=u,y=new hr;return c&&(k("string"==typeof c,"internal-error",{appName:o}),y.refreshToken=c),f&&(k("string"==typeof f,"internal-error",{appName:o}),y.accessToken=f),g&&(k("number"==typeof g,"internal-error",{appName:o}),y.expirationTime=g),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new hr,this.toJSON())}_performRefresh(){return ft("not implemented")}}function bt(l,o){k("string"==typeof l||typeof l>"u","internal-error",{appName:o})}class un{constructor(o){var{uid:u,auth:c,stsTokenManager:f}=o,g=(0,w._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ul(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=u,this.auth=c,this.stsTokenManager=f,this.accessToken=f.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new us(g.createdAt||void 0,g.lastLoginAt||void 0)}getIdToken(o){var u=this;return(0,I.Z)(function*(){const c=yield fe(u,u.stsTokenManager.getToken(u.auth,o));return k(c,u.auth,"internal-error"),u.accessToken!==c&&(u.accessToken=c,yield u.auth._persistUserIfCurrent(u),u.auth._notifyListenersIfCurrent(u)),c})()}getIdTokenResult(o){return function mh(l){return Yo.apply(this,arguments)}(this,o)}reload(){return function _h(l){return qn.apply(this,arguments)}(this)}_assign(o){this!==o&&(k(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(u=>Object.assign({},u)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){const u=new un(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}));return u.metadata._copy(this.metadata),u}_onReload(o){k(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,u=!1){var c=this;return(0,I.Z)(function*(){let f=!1;o.idToken&&o.idToken!==c.stsTokenManager.accessToken&&(c.stsTokenManager.updateFromServerResponse(o),f=!0),u&&(yield cr(c)),yield c.auth._persistUserIfCurrent(c),f&&c.auth._notifyListenersIfCurrent(c)})()}delete(){var o=this;return(0,I.Z)(function*(){const u=yield o.getIdToken();return yield fe(o,function At(l,o){return F.apply(this,arguments)}(o.auth,{idToken:u})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,u){var c,f,g,y,T,P,L,B;const z=null!==(c=u.displayName)&&void 0!==c?c:void 0,ce=null!==(f=u.email)&&void 0!==f?f:void 0,ct=null!==(g=u.phoneNumber)&&void 0!==g?g:void 0,kr=null!==(y=u.photoURL)&&void 0!==y?y:void 0,mo=null!==(T=u.tenantId)&&void 0!==T?T:void 0,Li=null!==(P=u._redirectEventId)&&void 0!==P?P:void 0,Rc=null!==(L=u.createdAt)&&void 0!==L?L:void 0,Pc=null!==(B=u.lastLoginAt)&&void 0!==B?B:void 0,{uid:Re,emailVerified:re,isAnonymous:Eu,providerData:go,stsTokenManager:Fi}=u;k(Re&&Fi,o,"internal-error");const Sc=hr.fromJSON(this.name,Fi);k("string"==typeof Re,o,"internal-error"),bt(z,o.name),bt(ce,o.name),k("boolean"==typeof re,o,"internal-error"),k("boolean"==typeof Eu,o,"internal-error"),bt(ct,o.name),bt(kr,o.name),bt(mo,o.name),bt(Li,o.name),bt(Rc,o.name),bt(Pc,o.name);const Au=new un({uid:Re,auth:o,email:ce,emailVerified:re,displayName:z,isAnonymous:Eu,photoURL:kr,phoneNumber:ct,tenantId:mo,stsTokenManager:Sc,createdAt:Rc,lastLoginAt:Pc});return go&&Array.isArray(go)&&(Au.providerData=go.map(Cc=>Object.assign({},Cc))),Li&&(Au._redirectEventId=Li),Au}static _fromIdTokenResponse(o,u,c=!1){return(0,I.Z)(function*(){const f=new hr;f.updateFromServerResponse(u);const g=new un({uid:u.localId,auth:o,stsTokenManager:f,isAnonymous:c});return yield cr(g),g})()}}const ll=new Map;function et(l){pt(l instanceof Function,"Expected a class definition");let o=ll.get(l);return o?(pt(o instanceof l,"Instance stored in cache mismatched with class"),o):(o=new l,ll.set(l,o),o)}const ln=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(u,c){var f=this;return(0,I.Z)(function*(){f.storage[u]=c})()}_get(u){var c=this;return(0,I.Z)(function*(){const f=c.storage[u];return void 0===f?null:f})()}_remove(u){var c=this;return(0,I.Z)(function*(){delete c.storage[u]})()}_addListener(u,c){}_removeListener(u,c){}}return l.type="NONE",l})();function Gt(l,o,u){return`firebase:${l}:${o}:${u}`}class cn{constructor(o,u,c){this.persistence=o,this.auth=u,this.userKey=c;const{config:f,name:g}=this.auth;this.fullUserKey=Gt(this.userKey,f.apiKey,g),this.fullPersistenceKey=Gt("persistence",f.apiKey,g),this.boundEventHandler=u._onStorageEvent.bind(u),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const u=yield o.persistence._get(o.fullUserKey);return u?un._fromJSON(o.auth,u):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var u=this;return(0,I.Z)(function*(){if(u.persistence===o)return;const c=yield u.getCurrentUser();return yield u.removeCurrentUser(),u.persistence=o,c?u.setCurrentUser(c):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,u,c="authUser"){return(0,I.Z)(function*(){if(!u.length)return new cn(et(ln),o,c);const f=(yield Promise.all(u.map(function(){var L=(0,I.Z)(function*(B){if(yield B._isAvailable())return B});return function(B){return L.apply(this,arguments)}}()))).filter(L=>L);let g=f[0]||et(ln);const y=Gt(c,o.config.apiKey,o.name);let T=null;for(const L of u)try{const B=yield L._get(y);if(B){const z=un._fromJSON(o,B);L!==g&&(T=z),g=L;break}}catch{}const P=f.filter(L=>L._shouldAllowMigration);return g._shouldAllowMigration&&P.length?(g=P[0],T&&(yield g._set(y,T.toJSON())),yield Promise.all(u.map(function(){var L=(0,I.Z)(function*(B){if(B!==g)try{yield B._remove(y)}catch{}});return function(B){return L.apply(this,arguments)}}())),new cn(g,o,c)):new cn(g,o,c)})()}}function cs(l){const o=l.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(hl(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(ta(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(dl(o))return"Blackberry";if(fl(o))return"Webos";if(na(o))return"Safari";if((o.includes("chrome/")||dr(o))&&!o.includes("edge/"))return"Chrome";if($t(o))return"Android";{const c=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==c?void 0:c.length))return c[1]}return"Other"}function ta(l=(0,x.z$)()){return/firefox\//i.test(l)}function na(l=(0,x.z$)()){const o=l.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function dr(l=(0,x.z$)()){return/crios\//i.test(l)}function hl(l=(0,x.z$)()){return/iemobile/i.test(l)}function $t(l=(0,x.z$)()){return/android/i.test(l)}function dl(l=(0,x.z$)()){return/blackberry/i.test(l)}function fl(l=(0,x.z$)()){return/webos/i.test(l)}function Zt(l=(0,x.z$)()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function ia(l=(0,x.z$)()){return Zt(l)||$t(l)||fl(l)||dl(l)||/windows phone/i.test(l)||hl(l)}function Kr(l,o=[]){let u;switch(l){case"Browser":u=cs((0,x.z$)());break;case"Worker":u=`${cs((0,x.z$)())}-${l}`;break;default:u=l}const c=o.length?o.join(","):"FirebaseCore-web";return`${u}/JsCore/${vt.SDK_VERSION}/${c}`}class sa{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,u){const c=g=>new Promise((y,T)=>{try{y(o(g))}catch(P){T(P)}});c.onAbort=u,this.queue.push(c);const f=this.queue.length-1;return()=>{this.queue[f]=()=>Promise.resolve()}}runMiddleware(o){var u=this;return(0,I.Z)(function*(){if(u.auth.currentUser===o)return;const c=[];try{for(const f of u.queue)yield f(o),f.onAbort&&c.push(f.onAbort)}catch(f){c.reverse();for(const g of c)try{g()}catch{}throw u.auth._errorFactory.create("login-blocked",{originalMessage:null==f?void 0:f.message})}})()}}function jr(){return(jr=(0,I.Z)(function*(l,o={}){return de(l,"GET","/v2/passwordPolicy",he(l,o))})).apply(this,arguments)}class gl{constructor(o){var u,c,f,g;const y=o.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(u=y.minPasswordLength)&&void 0!==u?u:6,y.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=y.maxPasswordLength),void 0!==y.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=y.containsLowercaseCharacter),void 0!==y.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=y.containsUppercaseCharacter),void 0!==y.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=y.containsNumericCharacter),void 0!==y.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=y.containsNonAlphanumericCharacter),this.enforcementState=o.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(f=null===(c=o.allowedNonAlphanumericCharacters)||void 0===c?void 0:c.join(""))&&void 0!==f?f:"",this.forceUpgradeOnSignin=null!==(g=o.forceUpgradeOnSignin)&&void 0!==g&&g,this.schemaVersion=o.schemaVersion}validatePassword(o){var u,c,f,g,y,T;const P={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(o,P),this.validatePasswordCharacterOptions(o,P),P.isValid&&(P.isValid=null===(u=P.meetsMinPasswordLength)||void 0===u||u),P.isValid&&(P.isValid=null===(c=P.meetsMaxPasswordLength)||void 0===c||c),P.isValid&&(P.isValid=null===(f=P.containsLowercaseLetter)||void 0===f||f),P.isValid&&(P.isValid=null===(g=P.containsUppercaseLetter)||void 0===g||g),P.isValid&&(P.isValid=null===(y=P.containsNumericCharacter)||void 0===y||y),P.isValid&&(P.isValid=null===(T=P.containsNonAlphanumericCharacter)||void 0===T||T),P}validatePasswordLengthOptions(o,u){const c=this.customStrengthOptions.minPasswordLength,f=this.customStrengthOptions.maxPasswordLength;c&&(u.meetsMinPasswordLength=o.length>=c),f&&(u.meetsMaxPasswordLength=o.length<=f)}validatePasswordCharacterOptions(o,u){let c;this.updatePasswordCharacterOptionsStatuses(u,!1,!1,!1,!1);for(let f=0;f<o.length;f++)c=o.charAt(f),this.updatePasswordCharacterOptionsStatuses(u,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(o,u,c,f,g){this.customStrengthOptions.containsLowercaseLetter&&(o.containsLowercaseLetter||(o.containsLowercaseLetter=u)),this.customStrengthOptions.containsUppercaseLetter&&(o.containsUppercaseLetter||(o.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(o.containsNumericCharacter||(o.containsNumericCharacter=f)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(o.containsNonAlphanumericCharacter||(o.containsNonAlphanumericCharacter=g))}}class _l{constructor(o,u,c,f){this.app=o,this.heartbeatServiceProvider=u,this.appCheckServiceProvider=c,this.config=f,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ua(this),this.idTokenSubscription=new ua(this),this.beforeStateQueue=new sa(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=el,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=f.sdkClientVersion}_initializeWithPersistence(o,u){var c=this;return u&&(this._popupRedirectResolver=et(u)),this._initializationPromise=this.queue((0,I.Z)(function*(){var f,g;if(!c._deleted&&(c.persistenceManager=yield cn.create(c,o),!c._deleted)){if(null!==(f=c._popupRedirectResolver)&&void 0!==f&&f._shouldInitProactively)try{yield c._popupRedirectResolver._initialize(c)}catch{}yield c.initializeCurrentUser(u),c.lastNotifiedUid=(null===(g=c.currentUser)||void 0===g?void 0:g.uid)||null,!c._deleted&&(c._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const u=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||u){if(o.currentUser&&u&&o.currentUser.uid===u.uid)return o._currentUser._assign(u),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(u,!0)}})()}initializeCurrentUser(o){var u=this;return(0,I.Z)(function*(){var c;const f=yield u.assertedPersistence.getCurrentUser();let g=f,y=!1;if(o&&u.config.authDomain){yield u.getOrInitRedirectPersistenceManager();const T=null===(c=u.redirectUser)||void 0===c?void 0:c._redirectEventId,P=null==g?void 0:g._redirectEventId,L=yield u.tryRedirectSignIn(o);(!T||T===P)&&null!=L&&L.user&&(g=L.user,y=!0)}if(!g)return u.directlySetCurrentUser(null);if(!g._redirectEventId){if(y)try{yield u.beforeStateQueue.runMiddleware(g)}catch(T){g=f,u._popupRedirectResolver._overrideRedirectResult(u,()=>Promise.reject(T))}return g?u.reloadAndSetCurrentUserOrClear(g):u.directlySetCurrentUser(null)}return k(u._popupRedirectResolver,u,"argument-error"),yield u.getOrInitRedirectPersistenceManager(),u.redirectUser&&u.redirectUser._redirectEventId===g._redirectEventId?u.directlySetCurrentUser(g):u.reloadAndSetCurrentUserOrClear(g)})()}tryRedirectSignIn(o){var u=this;return(0,I.Z)(function*(){let c=null;try{c=yield u._popupRedirectResolver._completeRedirectFn(u,o,!0)}catch{yield u._setRedirectUser(null)}return c})()}reloadAndSetCurrentUserOrClear(o){var u=this;return(0,I.Z)(function*(){try{yield cr(o)}catch(c){if("auth/network-request-failed"!==(null==c?void 0:c.code))return u.directlySetCurrentUser(null)}return u.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function Wo(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var u=this;return(0,I.Z)(function*(){const c=o?(0,x.m9)(o):null;return c&&k(c.auth.config.apiKey===u.config.apiKey,u,"invalid-user-token"),u._updateCurrentUser(c&&c._clone(u))})()}_updateCurrentUser(o,u=!1){var c=this;return(0,I.Z)(function*(){if(!c._deleted)return o&&k(c.tenantId===o.tenantId,c,"tenant-id-mismatch"),u||(yield c.beforeStateQueue.runMiddleware(o)),c.queue((0,I.Z)(function*(){yield c.directlySetCurrentUser(o),c.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var u=this;return this.queue((0,I.Z)(function*(){yield u.assertedPersistence.setPersistence(et(o))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(o){var u=this;return(0,I.Z)(function*(){u._getPasswordPolicyInternal()||(yield u._updatePasswordPolicy());const c=u._getPasswordPolicyInternal();return c.schemaVersion!==u.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(u._errorFactory.create("unsupported-password-policy-schema-version",{})):c.validatePassword(o)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var o=this;return(0,I.Z)(function*(){const u=yield function oa(l){return jr.apply(this,arguments)}(o),c=new gl(u);null===o.tenantId?o._projectPasswordPolicy=c:o._tenantPasswordPolicies[o.tenantId]=c})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new x.LL("auth","Firebase",o())}onAuthStateChanged(o,u,c){return this.registerStateListener(this.authStateSubscription,o,u,c)}beforeAuthStateChanged(o,u){return this.beforeStateQueue.pushCallback(o,u)}onIdTokenChanged(o,u,c){return this.registerStateListener(this.idTokenSubscription,o,u,c)}authStateReady(){return new Promise((o,u)=>{if(this.currentUser)o();else{const c=this.onAuthStateChanged(()=>{c(),o()},u)}})}revokeAccessToken(o){var u=this;return(0,I.Z)(function*(){if(u.currentUser){const c=yield u.currentUser.getIdToken(),f={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:o,idToken:c};null!=u.tenantId&&(f.tenantId=u.tenantId),yield function yh(l,o){return an.apply(this,arguments)}(u,f)}})()}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,u){var c=this;return(0,I.Z)(function*(){const f=yield c.getOrInitRedirectPersistenceManager(u);return null===o?f.removeCurrentUser():f.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var u=this;return(0,I.Z)(function*(){if(!u.redirectPersistenceManager){const c=o&&et(o)||u._popupRedirectResolver;k(c,u,"argument-error"),u.redirectPersistenceManager=yield cn.create(u,[et(c._redirectPersistence)],"redirectUser"),u.redirectUser=yield u.redirectPersistenceManager.getCurrentUser()}return u.redirectPersistenceManager})()}_redirectUserForId(o){var u=this;return(0,I.Z)(function*(){var c,f;return u._isInitialized&&(yield u.queue((0,I.Z)(function*(){}))),(null===(c=u._currentUser)||void 0===c?void 0:c._redirectEventId)===o?u._currentUser:(null===(f=u.redirectUser)||void 0===f?void 0:f._redirectEventId)===o?u.redirectUser:null})()}_persistUserIfCurrent(o){var u=this;return(0,I.Z)(function*(){if(o===u.currentUser)return u.queue((0,I.Z)(function*(){return u.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,u;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const c=null!==(u=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==u?u:null;this.lastNotifiedUid!==c&&(this.lastNotifiedUid=c,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,u,c,f){if(this._deleted)return()=>{};const g="function"==typeof u?u:u.next.bind(u);let y=!1;const T=this._isInitialized?Promise.resolve():this._initializationPromise;if(k(T,this,"internal-error"),T.then(()=>{y||g(this.currentUser)}),"function"==typeof u){const P=o.addObserver(u,c,f);return()=>{y=!0,P()}}{const P=o.addObserver(u);return()=>{y=!0,P()}}}directlySetCurrentUser(o){var u=this;return(0,I.Z)(function*(){u.currentUser&&u.currentUser!==o&&u._currentUser._stopProactiveRefresh(),o&&u.isProactiveRefreshEnabled&&o._startProactiveRefresh(),u.currentUser=o,o?yield u.assertedPersistence.setCurrentUser(o):yield u.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return k(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=Kr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var u;const c={"X-Client-Version":o.clientVersion};o.app.options.appId&&(c["X-Firebase-gmpid"]=o.app.options.appId);const f=yield null===(u=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getHeartbeatsHeader();f&&(c["X-Firebase-Client"]=f);const g=yield o._getAppCheckToken();return g&&(c["X-Firebase-AppCheck"]=g),c})()}_getAppCheckToken(){var o=this;return(0,I.Z)(function*(){var u;const c=yield null===(u=o.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===u?void 0:u.getToken();return null!=c&&c.error&&function es(l,...o){Xi.logLevel<=S.in.WARN&&Xi.warn(`Auth (${vt.SDK_VERSION}): ${l}`,...o)}(`Error while retrieving App Check token: ${c.error}`),null==c?void 0:c.token})()}}function me(l){return(0,x.m9)(l)}class ua{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,x.ne)(u=>this.observer=u)}get next(){return k(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Hr(l){return new Promise((o,u)=>{const c=document.createElement("script");c.setAttribute("src",l),c.onload=o,c.onerror=f=>{const g=Ge("internal-error");g.customData=f,u(g)},c.type="text/javascript",c.charset="UTF-8",function yl(){var l,o;return null!==(o=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==o?o:document}().appendChild(c)})}function la(l){return`__${l}${Math.floor(1e6*Math.random())}`}class hs{constructor(o){this.type="recaptcha-enterprise",this.auth=me(o)}verify(o="verify",u=!1){var c=this;return(0,I.Z)(function*(){function g(){return g=(0,I.Z)(function*(T){if(!u){if(null==T.tenantId&&null!=T._agentRecaptchaConfig)return T._agentRecaptchaConfig.siteKey;if(null!=T.tenantId&&void 0!==T._tenantRecaptchaConfigs[T.tenantId])return T._tenantRecaptchaConfigs[T.tenantId].siteKey}return new Promise(function(){var P=(0,I.Z)(function*(L,B){oe(T,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(z=>{if(void 0!==z.recaptchaKey){const ce=new Fn(z);return null==T.tenantId?T._agentRecaptchaConfig=ce:T._tenantRecaptchaConfigs[T.tenantId]=ce,L(ce.siteKey)}B(new Error("recaptcha Enterprise site key undefined"))}).catch(z=>{B(z)})});return function(L,B){return P.apply(this,arguments)}}())}),g.apply(this,arguments)}function y(T,P,L){const B=window.grecaptcha;sl(B)?B.enterprise.ready(()=>{B.enterprise.execute(T,{action:o}).then(z=>{P(z)}).catch(()=>{P("NO_RECAPTCHA")})}):L(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((T,P)=>{(function f(T){return g.apply(this,arguments)})(c.auth).then(L=>{if(!u&&sl(window.grecaptcha))y(L,T,P);else{if(typeof window>"u")return void P(new Error("RecaptchaVerifier is only supported in browser"));Hr("https://www.google.com/recaptcha/enterprise.js?render="+L).then(()=>{y(L,T,P)}).catch(B=>{P(B)})}}).catch(L=>{P(L)})})})()}}function Ne(l,o,u){return ke.apply(this,arguments)}function ke(){return(ke=(0,I.Z)(function*(l,o,u,c=!1){const f=new hs(l);let g;try{g=yield f.verify(u)}catch{g=yield f.verify(u,!0)}const y=Object.assign({},o);return Object.assign(y,c?{captchaResp:g}:{captchaResponse:g}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y})).apply(this,arguments)}function hn(l,o,u,c){return Qr.apply(this,arguments)}function Qr(){return Qr=(0,I.Z)(function*(l,o,u,c){var f;if(null!==(f=l._getRecaptchaConfig())&&void 0!==f&&f.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const g=yield Ne(l,o,u,"getOobCode"===u);return c(l,g)}return c(l,o).catch(function(){var g=(0,I.Z)(function*(y){if("auth/missing-recaptcha-token"===y.code){console.log(`${u} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const T=yield Ne(l,o,u,"getOobCode"===u);return c(l,T)}return Promise.reject(y)});return function(y){return g.apply(this,arguments)}}())}),Qr.apply(this,arguments)}function Tl(l){const o=l.indexOf(":");return o<0?"":l.substr(0,o+1)}function fr(l){if(!l)return null;const o=Number(l);return isNaN(o)?null:o}class dn{constructor(o,u){this.providerId=o,this.signInMethod=u}toJSON(){return ft("not implemented")}_getIdTokenResponse(o){return ft("not implemented")}_linkToIdToken(o,u){return ft("not implemented")}_getReauthenticationResolver(o){return ft("not implemented")}}function fa(l,o){return pa.apply(this,arguments)}function pa(){return(pa=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:resetPassword",he(l,o))})).apply(this,arguments)}function Jr(){return(Jr=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function ma(l,o){return fs.apply(this,arguments)}function fs(){return(fs=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:signUp",o)})).apply(this,arguments)}function Bn(){return(Bn=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:update",he(l,o))})).apply(this,arguments)}function El(l,o){return ps.apply(this,arguments)}function ps(){return(ps=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithPassword",he(l,o))})).apply(this,arguments)}function Xr(l,o){return pr.apply(this,arguments)}function pr(){return(pr=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:sendOobCode",he(l,o))})).apply(this,arguments)}function ga(){return(ga=(0,I.Z)(function*(l,o){return Xr(l,o)})).apply(this,arguments)}function mr(l,o){return _a.apply(this,arguments)}function _a(){return(_a=(0,I.Z)(function*(l,o){return Xr(l,o)})).apply(this,arguments)}function Ph(l,o){return Kt.apply(this,arguments)}function Kt(){return(Kt=(0,I.Z)(function*(l,o){return Xr(l,o)})).apply(this,arguments)}function gr(){return(gr=(0,I.Z)(function*(l,o){return Xr(l,o)})).apply(this,arguments)}function zn(){return(zn=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithEmailLink",he(l,o))})).apply(this,arguments)}function $e(){return($e=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithEmailLink",he(l,o))})).apply(this,arguments)}class _r extends dn{constructor(o,u,c,f=null){super("password",c),this._email=o,this._password=u,this._tenantId=f}static _fromEmailAndPassword(o,u){return new _r(o,u,"password")}static _fromEmailAndCode(o,u,c=null){return new _r(o,u,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o;if(null!=u&&u.email&&null!=u&&u.password){if("password"===u.signInMethod)return this._fromEmailAndPassword(u.email,u.password);if("emailLink"===u.signInMethod)return this._fromEmailAndCode(u.email,u.password,u.tenantId)}return null}_getIdTokenResponse(o){var u=this;return(0,I.Z)(function*(){switch(u.signInMethod){case"password":return hn(o,{returnSecureToken:!0,email:u._email,password:u._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",El);case"emailLink":return function wl(l,o){return zn.apply(this,arguments)}(o,{email:u._email,oobCode:u._password});default:se(o,"internal-error")}})()}_linkToIdToken(o,u){var c=this;return(0,I.Z)(function*(){switch(c.signInMethod){case"password":return hn(o,{idToken:u,returnSecureToken:!0,email:c._email,password:c._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ma);case"emailLink":return function Rl(l,o){return $e.apply(this,arguments)}(o,{idToken:u,email:c._email,oobCode:c._password});default:se(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function ot(l,o){return yr.apply(this,arguments)}function yr(){return(yr=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithIdp",he(l,o))})).apply(this,arguments)}class gt extends dn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const u=new gt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(u.idToken=o.idToken),o.accessToken&&(u.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(u.nonce=o.nonce),o.pendingToken&&(u.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(u.accessToken=o.oauthToken,u.secret=o.oauthTokenSecret):se("argument-error"),u}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o,{providerId:c,signInMethod:f}=u,g=(0,w._T)(u,["providerId","signInMethod"]);if(!c||!f)return null;const y=new gt(c,f);return y.idToken=g.idToken||void 0,y.accessToken=g.accessToken||void 0,y.secret=g.secret,y.nonce=g.nonce,y.pendingToken=g.pendingToken||null,y}_getIdTokenResponse(o){return ot(o,this.buildRequest())}_linkToIdToken(o,u){const c=this.buildRequest();return c.idToken=u,ot(o,c)}_getReauthenticationResolver(o){const u=this.buildRequest();return u.autoCreate=!1,ot(o,u)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const u={};this.idToken&&(u.id_token=this.idToken),this.accessToken&&(u.access_token=this.accessToken),this.secret&&(u.oauth_token_secret=this.secret),u.providerId=this.providerId,this.nonce&&!this.pendingToken&&(u.nonce=this.nonce),o.postBody=(0,x.xO)(u)}return o}}function ms(){return(ms=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:sendVerificationCode",he(l,o))})).apply(this,arguments)}function ti(){return(ti=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithPhoneNumber",he(l,o))})).apply(this,arguments)}function ni(){return(ni=(0,I.Z)(function*(l,o){const u=yield on(l,"POST","/v1/accounts:signInWithPhoneNumber",he(l,o));if(u.temporaryProof)throw Ln(l,"account-exists-with-different-credential",u);return u})).apply(this,arguments)}const gs={USER_NOT_FOUND:"user-not-found"};function _s(){return(_s=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithPhoneNumber",he(l,Object.assign(Object.assign({},o),{operation:"REAUTH"})),gs)})).apply(this,arguments)}class Wn extends dn{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,u){return new Wn({verificationId:o,verificationCode:u})}static _fromTokenResponse(o,u){return new Wn({phoneNumber:o,temporaryProof:u})}_getIdTokenResponse(o){return function ei(l,o){return ti.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,u){return function ya(l,o){return ni.apply(this,arguments)}(o,Object.assign({idToken:u},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function ri(l,o){return _s.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:u,verificationId:c,verificationCode:f}=this.params;return o&&u?{temporaryProof:o,phoneNumber:u}:{sessionInfo:c,code:f}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:u,verificationCode:c,phoneNumber:f,temporaryProof:g}=o;return c||u||f||g?new Wn({verificationId:u,verificationCode:c,phoneNumber:f,temporaryProof:g}):null}}class Gn{constructor(o){var u,c,f,g,y,T;const P=(0,x.zd)((0,x.pd)(o)),L=null!==(u=P.apiKey)&&void 0!==u?u:null,B=null!==(c=P.oobCode)&&void 0!==c?c:null,z=function Cl(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(f=P.mode)&&void 0!==f?f:null);k(L&&B&&z,"argument-error"),this.apiKey=L,this.operation=z,this.code=B,this.continueUrl=null!==(g=P.continueUrl)&&void 0!==g?g:null,this.languageCode=null!==(y=P.languageCode)&&void 0!==y?y:null,this.tenantId=null!==(T=P.tenantId)&&void 0!==T?T:null}static parseLink(o){const u=function Ia(l){const o=(0,x.zd)((0,x.pd)(l)).link,u=o?(0,x.zd)((0,x.pd)(o)).deep_link_id:null,c=(0,x.zd)((0,x.pd)(l)).deep_link_id;return(c?(0,x.zd)((0,x.pd)(c)).link:null)||c||u||o||l}(o);try{return new Gn(u)}catch{return null}}}let ys=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(u,c){return _r._fromEmailAndPassword(u,c)}static credentialWithLink(u,c){const f=Gn.parseLink(c);return k(f,"argument-error"),_r._fromEmailAndCode(u,f.code,f.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class xt{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Ir extends xt{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class Vt extends Ir{static credentialFromJSON(o){const u="string"==typeof o?JSON.parse(o):o;return k("providerId"in u&&"signInMethod"in u,"argument-error"),gt._fromParams(u)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return k(o.idToken||o.accessToken,"argument-error"),gt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return Vt.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return Vt.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:u,oauthAccessToken:c,oauthTokenSecret:f,pendingToken:g,nonce:y,providerId:T}=o;if(!c&&!f&&!u&&!g||!T)return null;try{return new Vt(T)._credential({idToken:u,accessToken:c,nonce:y,pendingToken:g})}catch{return null}}}let va=(()=>{class l extends Ir{constructor(){super("facebook.com")}static credential(u){return gt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return l.credential(u.oauthAccessToken)}catch{return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),ii=(()=>{class l extends Ir{constructor(){super("google.com"),this.addScope("profile")}static credential(u,c){return gt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:u,accessToken:c})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthIdToken:c,oauthAccessToken:f}=u;if(!c&&!f)return null;try{return l.credential(c,f)}catch{return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),vr=(()=>{class l extends Ir{constructor(){super("github.com")}static credential(u){return gt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:u})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u||!("oauthAccessToken"in u)||!u.oauthAccessToken)return null;try{return l.credential(u.oauthAccessToken)}catch{return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class fn extends dn{constructor(o,u){super(o,o),this.pendingToken=u}_getIdTokenResponse(o){return ot(o,this.buildRequest())}_linkToIdToken(o,u){const c=this.buildRequest();return c.idToken=u,ot(o,c)}_getReauthenticationResolver(o){const u=this.buildRequest();return u.autoCreate=!1,ot(o,u)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const u="string"==typeof o?JSON.parse(o):o,{providerId:c,signInMethod:f,pendingToken:g}=u;return c&&f&&g&&c===f?new fn(c,g):null}static _create(o,u){return new fn(o,u)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Is extends xt{constructor(o){k(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Is.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Is.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const u=fn.fromJSON(o);return k(u,"argument-error"),u}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:u,providerId:c}=o;if(!u||!c)return null;try{return fn._create(c,u)}catch{return null}}}let Ta=(()=>{class l extends Ir{constructor(){super("twitter.com")}static credential(u,c){return gt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:u,oauthTokenSecret:c})}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{oauthAccessToken:c,oauthTokenSecret:f}=u;if(!c||!f)return null;try{return l.credential(c,f)}catch{return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function Ea(l,o){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signUp",he(l,o))})).apply(this,arguments)}class Be{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,u,c,f=!1){return(0,I.Z)(function*(){const g=yield un._fromIdTokenResponse(o,c,f),y=Dt(c);return new Be({user:g,providerId:y,_tokenResponse:c,operationType:u})})()}static _forOperation(o,u,c){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(c,!0);const f=Dt(c);return new Be({user:o,providerId:f,_tokenResponse:c,operationType:u})})()}}function Dt(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function Tr(){return(Tr=(0,I.Z)(function*(l){var o;const u=me(l);if(yield u._initializationPromise,null!==(o=u.currentUser)&&void 0!==o&&o.isAnonymous)return new Be({user:u.currentUser,providerId:null,operationType:"signIn"});const c=yield Ea(u,{returnSecureToken:!0}),f=yield Be._fromIdTokenResponse(u,"signIn",c,!0);return yield u._updateCurrentUser(f.user),f})).apply(this,arguments)}class si extends x.ZR{constructor(o,u,c,f){var g;super(u.code,u.message),this.operationType=c,this.user=f,Object.setPrototypeOf(this,si.prototype),this.customData={appName:o.name,tenantId:null!==(g=o.tenantId)&&void 0!==g?g:void 0,_serverResponse:u.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(o,u,c,f){return new si(o,u,c,f)}}function pe(l,o,u,c){return("reauthenticate"===o?u._getReauthenticationResolver(l):u._getIdTokenResponse(l)).catch(g=>{throw"auth/multi-factor-auth-required"===g.code?si._fromErrorAndOperation(l,g,o,c):g})}function oi(l){return new Set(l.map(({providerId:o})=>o).filter(o=>!!o))}function Zn(){return Zn=(0,I.Z)(function*(l,o){const u=(0,x.m9)(l);yield Es(!0,u,o);const{providerUserInfo:c}=yield function Qo(l,o){return Q.apply(this,arguments)}(u.auth,{idToken:yield u.getIdToken(),deleteProvider:[o]}),f=oi(c||[]);return u.providerData=u.providerData.filter(g=>f.has(g.providerId)),f.has("phone")||(u.phoneNumber=null),yield u.auth._persistUserIfCurrent(u),u}),Zn.apply(this,arguments)}function wa(l,o){return Ts.apply(this,arguments)}function Ts(){return(Ts=(0,I.Z)(function*(l,o,u=!1){const c=yield fe(l,o._linkToIdToken(l.auth,yield l.getIdToken()),u);return Be._forOperation(l,"link",c)})).apply(this,arguments)}function Es(l,o,u){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,I.Z)(function*(l,o,u){yield cr(o);const f=!1===l?"provider-already-linked":"no-such-provider";k(oi(o.providerData).has(u)===l,o.auth,f)})).apply(this,arguments)}function bl(l,o){return Pa.apply(this,arguments)}function Pa(){return(Pa=(0,I.Z)(function*(l,o,u=!1){const{auth:c}=l,f="reauthenticate";try{const g=yield fe(l,pe(c,f,o,l),u);k(g.idToken,c,"internal-error");const y=De(g.idToken);k(y,c,"internal-error");const{sub:T}=y;return k(l.uid===T,c,"user-mismatch"),Be._forOperation(l,f,g)}catch(g){throw"auth/user-not-found"===(null==g?void 0:g.code)&&se(c,"user-mismatch"),g}})).apply(this,arguments)}function Er(l,o){return Nt.apply(this,arguments)}function Nt(){return(Nt=(0,I.Z)(function*(l,o,u=!1){const c="signIn",f=yield pe(l,c,o),g=yield Be._fromIdTokenResponse(l,c,f);return u||(yield l._updateCurrentUser(g.user)),g})).apply(this,arguments)}function ui(l,o){return As.apply(this,arguments)}function As(){return(As=(0,I.Z)(function*(l,o){return Er(me(l),o)})).apply(this,arguments)}function Sa(l,o){return pn.apply(this,arguments)}function pn(){return(pn=(0,I.Z)(function*(l,o){const u=(0,x.m9)(l);return yield Es(!1,u,o.providerId),wa(u,o)})).apply(this,arguments)}function xl(l,o){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,I.Z)(function*(l,o){return bl((0,x.m9)(l),o)})).apply(this,arguments)}function ba(){return(ba=(0,I.Z)(function*(l,o){return on(l,"POST","/v1/accounts:signInWithCustomToken",he(l,o))})).apply(this,arguments)}function ws(){return ws=(0,I.Z)(function*(l,o){const u=me(l),c=yield function Vl(l,o){return ba.apply(this,arguments)}(u,{token:o,returnSecureToken:!0}),f=yield Be._fromIdTokenResponse(u,"signIn",c);return yield u._updateCurrentUser(f.user),f}),ws.apply(this,arguments)}class Kn{constructor(o,u){this.factorId=o,this.uid=u.mfaEnrollmentId,this.enrollmentTime=new Date(u.enrolledAt).toUTCString(),this.displayName=u.displayName}static _fromServerResponse(o,u){return"phoneInfo"in u?li._fromServerResponse(o,u):"totpInfo"in u?Rs._fromServerResponse(o,u):se(o,"internal-error")}}class li extends Kn{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,u){return new li(u)}}class Rs extends Kn{constructor(o){super("totp",o)}static _fromServerResponse(o,u){return new Rs(u)}}function ci(l,o,u){var c;k((null===(c=u.url)||void 0===c?void 0:c.length)>0,l,"invalid-continue-uri"),k(typeof u.dynamicLinkDomain>"u"||u.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),o.continueUrl=u.url,o.dynamicLinkDomain=u.dynamicLinkDomain,o.canHandleCodeInApp=u.handleCodeInApp,u.iOS&&(k(u.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),o.iOSBundleId=u.iOS.bundleId),u.android&&(k(u.android.packageName.length>0,l,"missing-android-pkg-name"),o.androidInstallApp=u.android.installApp,o.androidMinimumVersionCode=u.android.minimumVersion,o.androidPackageName=u.android.packageName)}function xa(l){return Va.apply(this,arguments)}function Va(){return(Va=(0,I.Z)(function*(l){const o=me(l);o._getPasswordPolicyInternal()&&(yield o._updatePasswordPolicy())})).apply(this,arguments)}function Da(){return(Da=(0,I.Z)(function*(l,o,u){const c=me(l),f={requestType:"PASSWORD_RESET",email:o,clientType:"CLIENT_TYPE_WEB"};u&&ci(c,f,u),yield hn(c,f,"getOobCode",mr)})).apply(this,arguments)}function jn(){return jn=(0,I.Z)(function*(l,o,u){yield fa((0,x.m9)(l),{oobCode:o,newPassword:u}).catch(function(){var c=(0,I.Z)(function*(f){throw"auth/password-does-not-meet-requirements"===f.code&&xa(l),f});return function(f){return c.apply(this,arguments)}}())}),jn.apply(this,arguments)}function hi(){return hi=(0,I.Z)(function*(l,o){yield function wh(l,o){return Bn.apply(this,arguments)}((0,x.m9)(l),{oobCode:o})}),hi.apply(this,arguments)}function Na(l,o){return Hn.apply(this,arguments)}function Hn(){return(Hn=(0,I.Z)(function*(l,o){const u=(0,x.m9)(l),c=yield fa(u,{oobCode:o}),f=c.requestType;switch(k(f,u,"internal-error"),f){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":k(c.newEmail,u,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":k(c.mfaInfo,u,"internal-error");default:k(c.email,u,"internal-error")}let g=null;return c.mfaInfo&&(g=Kn._fromServerResponse(me(u),c.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===c.requestType?c.newEmail:c.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===c.requestType?c.email:c.newEmail)||null,multiFactorInfo:g},operation:f}})).apply(this,arguments)}function ka(){return(ka=(0,I.Z)(function*(l,o){const{data:u}=yield Na((0,x.m9)(l),o);return u.email})).apply(this,arguments)}function Cs(){return(Cs=(0,I.Z)(function*(l,o,u){const c=me(l),y=yield hn(c,{returnSecureToken:!0,email:o,password:u,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ea).catch(P=>{throw"auth/password-does-not-meet-requirements"===P.code&&xa(l),P}),T=yield Be._fromIdTokenResponse(c,"signIn",y);return yield c._updateCurrentUser(T.user),T})).apply(this,arguments)}function Oa(){return(Oa=(0,I.Z)(function*(l,o,u){const c=me(l),f={requestType:"EMAIL_SIGNIN",email:o,clientType:"CLIENT_TYPE_WEB"};(function g(y,T){k(T.handleCodeInApp,c,"argument-error"),T&&ci(c,y,T)})(f,u),yield hn(c,f,"getOobCode",Ph)})).apply(this,arguments)}function bs(){return(bs=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l),f=ys.credentialWithLink(o,u||$r());return k(f._tenantId===(c.tenantId||null),c,"tenant-id-mismatch"),ui(c,f)})).apply(this,arguments)}function Vs(){return(Vs=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:createAuthUri",he(l,o))})).apply(this,arguments)}function Ds(){return Ds=(0,I.Z)(function*(l,o){const c={identifier:o,continueUri:qo()?$r():"http://localhost"},{signinMethods:f}=yield function xs(l,o){return Vs.apply(this,arguments)}((0,x.m9)(l),c);return f||[]}),Ds.apply(this,arguments)}function Ns(){return Ns=(0,I.Z)(function*(l,o){const u=(0,x.m9)(l),f={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};o&&ci(u.auth,f,o);const{email:g}=yield function Rh(l,o){return ga.apply(this,arguments)}(u.auth,f);g!==l.email&&(yield l.reload())}),Ns.apply(this,arguments)}function Qn(){return Qn=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l),g={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:o};u&&ci(c.auth,g,u);const{email:y}=yield function Al(l,o){return gr.apply(this,arguments)}(c.auth,g);y!==l.email&&(yield l.reload())}),Qn.apply(this,arguments)}function fi(){return(fi=(0,I.Z)(function*(l,o){return de(l,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Os(){return Os=(0,I.Z)(function*(l,{displayName:o,photoURL:u}){if(void 0===o&&void 0===u)return;const c=(0,x.m9)(l),g={idToken:yield c.getIdToken(),displayName:o,photoUrl:u,returnSecureToken:!0},y=yield fe(c,function Ol(l,o){return fi.apply(this,arguments)}(c.auth,g));c.displayName=y.displayName||null,c.photoURL=y.photoUrl||null;const T=c.providerData.find(({providerId:P})=>"password"===P);T&&(T.displayName=c.displayName,T.photoURL=c.photoURL),yield c._updateTokensIfNecessary(y)}),Os.apply(this,arguments)}function La(l,o,u){return Yn.apply(this,arguments)}function Yn(){return Yn=(0,I.Z)(function*(l,o,u){const{auth:c}=l,g={idToken:yield l.getIdToken(),returnSecureToken:!0};o&&(g.email=o),u&&(g.password=u);const y=yield fe(l,function ds(l,o){return Jr.apply(this,arguments)}(c,g));yield l._updateTokensIfNecessary(y,!0)}),Yn.apply(this,arguments)}class Jn{constructor(o,u,c={}){this.isNewUser=o,this.providerId=u,this.profile=c}}class Ls extends Jn{constructor(o,u,c,f){super(o,u,c),this.username=f}}class Fa extends Jn{constructor(o,u){super(o,"facebook.com",u)}}class Ll extends Ls{constructor(o,u){super(o,"github.com",u,"string"==typeof(null==u?void 0:u.login)?null==u?void 0:u.login:null)}}class Fs extends Jn{constructor(o,u){super(o,"google.com",u)}}class Fl extends Ls{constructor(o,u,c){super(o,"twitter.com",u,c)}}function Ul(l){const{user:o,_tokenResponse:u}=l;return o.isAnonymous&&!u?{providerId:null,isNewUser:!1,profile:null}:function Ml(l){var o,u;if(!l)return null;const{providerId:c}=l,f=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},g=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!c&&null!=l&&l.idToken){const y=null===(u=null===(o=De(l.idToken))||void 0===o?void 0:o.firebase)||void 0===u?void 0:u.sign_in_provider;if(y)return new Jn(g,"anonymous"!==y&&"custom"!==y?y:null)}if(!c)return null;switch(c){case"facebook.com":return new Fa(g,f);case"github.com":return new Ll(g,f);case"google.com":return new Fs(g,f);case"twitter.com":return new Fl(g,f,l.screenName||null);case"custom":case"anonymous":return new Jn(g,null);default:return new Jn(g,c,f)}}(u)}class te{constructor(o,u,c){this.type=o,this.credential=u,this.user=c}static _fromIdtoken(o,u){return new te("enroll",o,u)}static _fromMfaPendingCredential(o){return new te("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var u,c;if(null!=o&&o.multiFactorSession){if(null!==(u=o.multiFactorSession)&&void 0!==u&&u.pendingCredential)return te._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null!==(c=o.multiFactorSession)&&void 0!==c&&c.idToken)return te._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Ua{constructor(o,u,c){this.session=o,this.hints=u,this.signInResolver=c}static _fromError(o,u){const c=me(o),f=u.customData._serverResponse,g=(f.mfaInfo||[]).map(T=>Kn._fromServerResponse(c,T));k(f.mfaPendingCredential,c,"internal-error");const y=te._fromMfaPendingCredential(f.mfaPendingCredential);return new Ua(y,g,function(){var T=(0,I.Z)(function*(P){const L=yield P._process(c,y);delete f.mfaInfo,delete f.mfaPendingCredential;const B=Object.assign(Object.assign({},f),{idToken:L.idToken,refreshToken:L.refreshToken});switch(u.operationType){case"signIn":const z=yield Be._fromIdTokenResponse(c,u.operationType,B);return yield c._updateCurrentUser(z.user),z;case"reauthenticate":return k(u.user,c,"internal-error"),Be._forOperation(u.user,u.operationType,B);default:se(c,"internal-error")}});return function(P){return T.apply(this,arguments)}}())}resolveSignIn(o){var u=this;return(0,I.Z)(function*(){return u.signInResolver(o)})()}}class Bs{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(u=>{u.mfaInfo&&(this.enrolledFactors=u.mfaInfo.map(c=>Kn._fromServerResponse(o.auth,c)))})}static _fromUser(o){return new Bs(o)}getSession(){var o=this;return(0,I.Z)(function*(){return te._fromIdtoken(yield o.user.getIdToken(),o.user)})()}enroll(o,u){var c=this;return(0,I.Z)(function*(){const f=o,g=yield c.getSession(),y=yield fe(c.user,f._process(c.user.auth,g,u));return yield c.user._updateTokensIfNecessary(y),c.user.reload()})()}unenroll(o){var u=this;return(0,I.Z)(function*(){const c="string"==typeof o?o:o.uid,f=yield u.user.getIdToken();try{const g=yield fe(u.user,function Ba(l,o){return de(l,"POST","/v2/accounts/mfaEnrollment:withdraw",he(l,o))}(u.user.auth,{idToken:f,mfaEnrollmentId:c}));u.enrolledFactors=u.enrolledFactors.filter(({uid:y})=>y!==c),yield u.user._updateTokensIfNecessary(g),yield u.user.reload()}catch(g){throw g}})()}}const wt=new WeakMap,be="__sak";class gi{constructor(o,u){this.storageRetriever=o,this.type=u}_isAvailable(){try{return this.storage?(this.storage.setItem(be,"1"),this.storage.removeItem(be),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(o,u){return this.storage.setItem(o,JSON.stringify(u)),Promise.resolve()}_get(o){const u=this.storage.getItem(o);return Promise.resolve(u?JSON.parse(u):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const jt=(()=>{class l extends gi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(u,c)=>this.onStorageEvent(u,c),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function zs(){const l=(0,x.z$)();return na(l)||Zt(l)}()&&function ml(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=ia(),this._shouldAllowMigration=!0}forAllChangedKeys(u){for(const c of Object.keys(this.listeners)){const f=this.storage.getItem(c),g=this.localCache[c];f!==g&&u(c,g,f)}}onStorageEvent(u,c=!1){if(!u.key)return void this.forAllChangedKeys((T,P,L)=>{this.notifyListeners(T,L)});const f=u.key;if(c?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const T=this.storage.getItem(f);if(u.newValue!==T)null!==u.newValue?this.storage.setItem(f,u.newValue):this.storage.removeItem(f);else if(this.localCache[f]===u.newValue&&!c)return}const g=()=>{const T=this.storage.getItem(f);!c&&this.localCache[f]===T||this.notifyListeners(f,T)},y=this.storage.getItem(f);!function pl(){return(0,x.w1)()&&10===document.documentMode}()||y===u.newValue||u.newValue===u.oldValue?g():setTimeout(g,10)}notifyListeners(u,c){this.localCache[u]=c;const f=this.listeners[u];if(f)for(const g of Array.from(f))g(c&&JSON.parse(c))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((u,c,f)=>{this.onStorageEvent(new StorageEvent("storage",{key:u,oldValue:c,newValue:f}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(u,c){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[u]||(this.listeners[u]=new Set,this.localCache[u]=this.storage.getItem(u)),this.listeners[u].add(c)}_removeListener(u,c){this.listeners[u]&&(this.listeners[u].delete(c),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(u,c){var f=()=>super._set,g=this;return(0,I.Z)(function*(){yield f().call(g,u,c),g.localCache[u]=JSON.stringify(c)})()}_get(u){var c=()=>super._get,f=this;return(0,I.Z)(function*(){const g=yield c().call(f,u);return f.localCache[u]=JSON.stringify(g),g})()}_remove(u){var c=()=>super._remove,f=this;return(0,I.Z)(function*(){yield c().call(f,u),delete f.localCache[u]})()}}return l.type="LOCAL",l})(),mn=(()=>{class l extends gi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(u,c){}_removeListener(u,c){}}return l.type="SESSION",l})();let Uh=(()=>{class l{constructor(u){this.eventTarget=u,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(u){const c=this.receivers.find(g=>g.isListeningto(u));if(c)return c;const f=new l(u);return this.receivers.push(f),f}isListeningto(u){return this.eventTarget===u}handleEvent(u){var c=this;return(0,I.Z)(function*(){const f=u,{eventId:g,eventType:y,data:T}=f.data,P=c.handlersMap[y];if(null==P||!P.size)return;f.ports[0].postMessage({status:"ack",eventId:g,eventType:y});const L=Array.from(P).map(function(){var z=(0,I.Z)(function*(ce){return ce(f.origin,T)});return function(ce){return z.apply(this,arguments)}}()),B=yield function za(l){return Promise.all(l.map(function(){var o=(0,I.Z)(function*(u){try{return{fulfilled:!0,value:yield u}}catch(c){return{fulfilled:!1,reason:c}}});return function(u){return o.apply(this,arguments)}}()))}(L);f.ports[0].postMessage({status:"done",eventId:g,eventType:y,response:B})})()}_subscribe(u,c){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[u]||(this.handlersMap[u]=new Set),this.handlersMap[u].add(c)}_unsubscribe(u,c){this.handlersMap[u]&&c&&this.handlersMap[u].delete(c),(!c||0===this.handlersMap[u].size)&&delete this.handlersMap[u],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function yi(l="",o=10){let u="";for(let c=0;c<o;c++)u+=Math.floor(10*Math.random());return l+u}class Wl{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,u,c=50){var f=this;return(0,I.Z)(function*(){const g=typeof MessageChannel<"u"?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let y,T;return new Promise((P,L)=>{const B=yi("",20);g.port1.start();const z=setTimeout(()=>{L(new Error("unsupported_event"))},c);T={messageChannel:g,onMessage(ce){const ct=ce;if(ct.data.eventId===B)switch(ct.data.status){case"ack":clearTimeout(z),y=setTimeout(()=>{L(new Error("timeout"))},3e3);break;case"done":clearTimeout(y),P(ct.data.response);break;default:clearTimeout(z),clearTimeout(y),L(new Error("invalid_response"))}}},f.handlers.add(T),g.port1.addEventListener("message",T.onMessage),f.target.postMessage({eventType:o,eventId:B,data:u},[g.port2])}).finally(()=>{T&&f.removeMessageHandler(T)})})()}}function Oe(){return window}function Wa(){return typeof Oe().WorkerGlobalScope<"u"&&"function"==typeof Oe().importScripts}function gn(){return(gn=(0,I.Z)(function*(){if(null==navigator||!navigator.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const Xn="firebaseLocalStorageDb",Ht="firebaseLocalStorage",$l="fbase_key";class b{constructor(o){this.request=o}toPromise(){return new Promise((o,u)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{u(this.request.error)})})}}function ye(l,o){return l.transaction([Ht],o?"readwrite":"readonly").objectStore(Ht)}function Ii(){const l=indexedDB.open(Xn,1);return new Promise((o,u)=>{l.addEventListener("error",()=>{u(l.error)}),l.addEventListener("upgradeneeded",()=>{const c=l.result;try{c.createObjectStore(Ht,{keyPath:$l})}catch(f){u(f)}}),l.addEventListener("success",(0,I.Z)(function*(){const c=l.result;c.objectStoreNames.contains(Ht)?o(c):(c.close(),yield function tt(){const l=indexedDB.deleteDatabase(Xn);return new b(l).toPromise()}(),o(yield Ii()))}))})}function U(l,o,u){return W.apply(this,arguments)}function W(){return(W=(0,I.Z)(function*(l,o,u){const c=ye(l,!0).put({[$l]:o,value:u});return new b(c).toPromise()})).apply(this,arguments)}function O(){return(O=(0,I.Z)(function*(l,o){const u=ye(l,!1).get(o),c=yield new b(u).toPromise();return void 0===c?null:c.value})).apply(this,arguments)}function R(l,o){const u=ye(l,!0).delete(o);return new b(u).toPromise()}const Rr=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var u=this;return(0,I.Z)(function*(){return u.db||(u.db=yield Ii()),u.db})()}_withRetries(u){var c=this;return(0,I.Z)(function*(){let f=0;for(;;)try{const g=yield c._openDb();return yield u(g)}catch(g){if(f++>3)throw g;c.db&&(c.db.close(),c.db=void 0)}})()}initializeServiceWorkerMessaging(){var u=this;return(0,I.Z)(function*(){return Wa()?u.initializeReceiver():u.initializeSender()})()}initializeReceiver(){var u=this;return(0,I.Z)(function*(){u.receiver=Uh._getInstance(function ze(){return Wa()?self:null}()),u.receiver._subscribe("keyChanged",function(){var c=(0,I.Z)(function*(f,g){return{keyProcessed:(yield u._poll()).includes(g.key)}});return function(f,g){return c.apply(this,arguments)}}()),u.receiver._subscribe("ping",function(){var c=(0,I.Z)(function*(f,g){return["keyChanged"]});return function(f,g){return c.apply(this,arguments)}}())})()}initializeSender(){var u=this;return(0,I.Z)(function*(){var c,f;if(u.activeServiceWorker=yield function qh(){return gn.apply(this,arguments)}(),!u.activeServiceWorker)return;u.sender=new Wl(u.activeServiceWorker);const g=yield u.sender._send("ping",{},800);g&&null!==(c=g[0])&&void 0!==c&&c.fulfilled&&null!==(f=g[0])&&void 0!==f&&f.value.includes("keyChanged")&&(u.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(u){var c=this;return(0,I.Z)(function*(){if(c.sender&&c.activeServiceWorker&&function Gl(){var l;return(null===(l=null==navigator?void 0:navigator.serviceWorker)||void 0===l?void 0:l.controller)||null}()===c.activeServiceWorker)try{yield c.sender._send("keyChanged",{key:u},c.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const u=yield Ii();return yield U(u,be,"1"),yield R(u,be),!0}catch{}return!1})()}_withPendingWrite(u){var c=this;return(0,I.Z)(function*(){c.pendingWrites++;try{yield u()}finally{c.pendingWrites--}})()}_set(u,c){var f=this;return(0,I.Z)(function*(){return f._withPendingWrite((0,I.Z)(function*(){return yield f._withRetries(g=>U(g,u,c)),f.localCache[u]=c,f.notifyServiceWorker(u)}))})()}_get(u){var c=this;return(0,I.Z)(function*(){const f=yield c._withRetries(g=>function Bh(l,o){return O.apply(this,arguments)}(g,u));return c.localCache[u]=f,f})()}_remove(u){var c=this;return(0,I.Z)(function*(){return c._withPendingWrite((0,I.Z)(function*(){return yield c._withRetries(f=>R(f,u)),delete c.localCache[u],c.notifyServiceWorker(u)}))})()}_poll(){var u=this;return(0,I.Z)(function*(){const c=yield u._withRetries(y=>{const T=ye(y,!1).getAll();return new b(T).toPromise()});if(!c)return[];if(0!==u.pendingWrites)return[];const f=[],g=new Set;if(0!==c.length)for(const{fbase_key:y,value:T}of c)g.add(y),JSON.stringify(u.localCache[y])!==JSON.stringify(T)&&(u.notifyListeners(y,T),f.push(y));for(const y of Object.keys(u.localCache))u.localCache[y]&&!g.has(y)&&(u.notifyListeners(y,null),f.push(y));return f})()}notifyListeners(u,c){this.localCache[u]=c;const f=this.listeners[u];if(f)for(const g of Array.from(f))g(c)}startPolling(){var u=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return u._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(u,c){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[u]||(this.listeners[u]=new Set,this._get(u)),this.listeners[u].add(c)}_removeListener(u,c){this.listeners[u]&&(this.listeners[u].delete(c),0===this.listeners[u].size&&delete this.listeners[u]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})(),$s=1e12;class Ep{constructor(o){this.auth=o,this.counter=$s,this._widgets=new Map}render(o,u){const c=this.counter;return this._widgets.set(c,new Kh(o,this.auth.name,u||{})),this.counter++,c}reset(o){var u;const c=o||$s;null===(u=this._widgets.get(c))||void 0===u||u.delete(),this._widgets.delete(c)}getResponse(o){var u;return(null===(u=this._widgets.get(o||$s))||void 0===u?void 0:u.getResponse())||""}execute(o){var u=this;return(0,I.Z)(function*(){var c;return null===(c=u._widgets.get(o||$s))||void 0===c||c.execute(),""})()}}class Kh{constructor(o,u,c){this.params=c,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const f="string"==typeof o?document.getElementById(o):o;k(f,"argument-error",{appName:u}),this.container=f,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Kl(l){const o=[],u="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let c=0;c<l;c++)o.push(u.charAt(Math.floor(62*Math.random())));return o.join("")}(50);const{callback:o,"expired-callback":u}=this.params;if(o)try{o(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,u)try{u()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const H=la("rcb"),Pr=new ns(3e4,6e4);class Ie{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(o=Oe().grecaptcha)||void 0===o||!o.render)}load(o,u=""){return k(function $(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(u),o,"argument-error"),this.shouldResolveImmediately(u)&&il(Oe().grecaptcha)?Promise.resolve(Oe().grecaptcha):new Promise((c,f)=>{const g=Oe().setTimeout(()=>{f(Ge(o,"network-request-failed"))},Pr.get());Oe()[H]=()=>{Oe().clearTimeout(g),delete Oe()[H];const T=Oe().grecaptcha;if(!T||!il(T))return void f(Ge(o,"internal-error"));const P=T.render;T.render=(L,B)=>{const z=P(L,B);return this.counter++,z},this.hostLanguage=u,c(T)},Hr(`https://www.google.com/recaptcha/api.js??${(0,x.xO)({onload:H,render:"explicit",hl:u})}`).catch(()=>{clearTimeout(g),f(Ge(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var u;return!(null===(u=Oe().grecaptcha)||void 0===u||!u.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class vi{load(o){return(0,I.Z)(function*(){return new Ep(o)})()}clearedOneInstance(){}}const ne="recaptcha",jh={theme:"light",type:"image"};class ge{constructor(o,u,c=Object.assign({},jh)){this.parameters=c,this.type=ne,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=me(o),this.isInvisible="invisible"===this.parameters.size,k(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const f="string"==typeof u?document.getElementById(u):u;k(f,this.auth,"argument-error"),this.container=f,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new vi:new Ie,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const u=yield o.render(),c=o.getAssertedRecaptcha();return c.getResponse(u)||new Promise(g=>{const y=T=>{T&&(o.tokenChangeListeners.delete(y),g(T))};o.tokenChangeListeners.add(y),o.isInvisible&&c.execute(u)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){k(!this.parameters.sitekey,this.auth,"argument-error"),k(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),k(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return u=>{if(this.tokenChangeListeners.forEach(c=>c(u)),"function"==typeof o)o(u);else if("string"==typeof o){const c=Oe()[o];"function"==typeof c&&c(u)}}}assertNotDestroyed(){k(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let u=o.container;if(!o.isInvisible){const c=document.createElement("div");u.appendChild(c),u=c}o.widgetId=o.getAssertedRecaptcha().render(u,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){k(qo()&&!Wa(),o.auth,"internal-error"),yield function M(){let l=null;return new Promise(o=>{"complete"!==document.readyState?(l=()=>o(),window.addEventListener("load",l)):o()}).catch(o=>{throw l&&window.removeEventListener("load",l),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const u=yield function ol(l){return mt.apply(this,arguments)}(o.auth);k(u,o.auth,"internal-error"),o.parameters.sitekey=u})()}getAssertedRecaptcha(){return k(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class yn{constructor(o,u){this.verificationId=o,this.onConfirmation=u}confirm(o){const u=Wn._fromVerification(this.verificationId,o);return this.onConfirmation(u)}}function Qt(){return(Qt=(0,I.Z)(function*(l,o,u){const c=me(l),f=yield Ti(c,o,(0,x.m9)(u));return new yn(f,g=>ui(c,g))})).apply(this,arguments)}function Yt(){return(Yt=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l);yield Es(!1,c,"phone");const f=yield Ti(c.auth,o,(0,x.m9)(u));return new yn(f,g=>Sa(c,g))})).apply(this,arguments)}function In(){return(In=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l),f=yield Ti(c.auth,o,(0,x.m9)(u));return new yn(f,g=>xl(c,g))})).apply(this,arguments)}function Ti(l,o,u){return Zs.apply(this,arguments)}function Zs(){return Zs=(0,I.Z)(function*(l,o,u){var c;const f=yield u.verify();try{let g;if(k("string"==typeof f,l,"argument-error"),k(u.type===ne,l,"argument-error"),g="string"==typeof o?{phoneNumber:o}:o,"session"in g){const y=g.session;if("phoneNumber"in g)return k("enroll"===y.type,l,"internal-error"),(yield function Mt(l,o){return de(l,"POST","/v2/accounts/mfaEnrollment:start",he(l,o))}(l,{idToken:y.credential,phoneEnrollmentInfo:{phoneNumber:g.phoneNumber,recaptchaToken:f}})).phoneSessionInfo.sessionInfo;{k("signin"===y.type,l,"internal-error");const T=(null===(c=g.multiFactorHint)||void 0===c?void 0:c.uid)||g.multiFactorUid;return k(T,l,"missing-multi-factor-info"),(yield function Wh(l,o){return de(l,"POST","/v2/accounts/mfaSignIn:start",he(l,o))}(l,{mfaPendingCredential:y.credential,mfaEnrollmentId:T,phoneSignInInfo:{recaptchaToken:f}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:y}=yield function Sl(l,o){return ms.apply(this,arguments)}(l,{phoneNumber:g.phoneNumber,recaptchaToken:f});return y}}finally{u._reset()}}),Zs.apply(this,arguments)}function Ei(){return(Ei=(0,I.Z)(function*(l,o){yield wa((0,x.m9)(l),o)})).apply(this,arguments)}let Sr=(()=>{class l{constructor(u){this.providerId=l.PROVIDER_ID,this.auth=me(u)}verifyPhoneNumber(u,c){return Ti(this.auth,u,(0,x.m9)(c))}static credential(u,c){return Wn._fromVerification(u,c)}static credentialFromResult(u){return l.credentialFromTaggedObject(u)}static credentialFromError(u){return l.credentialFromTaggedObject(u.customData||{})}static credentialFromTaggedObject({_tokenResponse:u}){if(!u)return null;const{phoneNumber:c,temporaryProof:f}=u;return c&&f?Wn._fromTokenResponse(c,f):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function vn(l,o){return o?et(o):(k(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class Lt extends dn{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return ot(o,this._buildIdpRequest())}_linkToIdToken(o,u){return ot(o,this._buildIdpRequest(u))}_getReauthenticationResolver(o){return ot(o,this._buildIdpRequest())}_buildIdpRequest(o){const u={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(u.idToken=o),u}}function $a(l){return Er(l.auth,new Lt(l),l.bypassAuthState)}function E(l){const{auth:o,user:u}=l;return k(u,o,"internal-error"),bl(u,new Lt(l),l.bypassAuthState)}function Ks(l){return ut.apply(this,arguments)}function ut(){return(ut=(0,I.Z)(function*(l){const{auth:o,user:u}=l;return k(u,o,"internal-error"),wa(u,new Lt(l),l.bypassAuthState)})).apply(this,arguments)}class Hl{constructor(o,u,c,f,g=!1){this.auth=o,this.resolver=c,this.user=f,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(u)?u:[u]}execute(){var o=this;return new Promise(function(){var u=(0,I.Z)(function*(c,f){o.pendingPromise={resolve:c,reject:f};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(g){o.reject(g)}});return function(c,f){return u.apply(this,arguments)}}())}onAuthEvent(o){var u=this;return(0,I.Z)(function*(){const{urlResponse:c,sessionId:f,postBody:g,tenantId:y,error:T,type:P}=o;if(T)return void u.reject(T);const L={auth:u.auth,requestUri:c,sessionId:f,tenantId:y||void 0,postBody:g||void 0,user:u.user,bypassAuthState:u.bypassAuthState};try{u.resolve(yield u.getIdpTask(P)(L))}catch(B){u.reject(B)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return $a;case"linkViaPopup":case"linkViaRedirect":return Ks;case"reauthViaPopup":case"reauthViaRedirect":return E;default:se(this.auth,"internal-error")}}resolve(o){pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ai=new ns(2e3,1e4);function Za(){return(Za=(0,I.Z)(function*(l,o,u){const c=me(l);Mn(l,o,xt);const f=vn(c,u);return new Ha(c,"signInViaPopup",o,f).executeNotNull()})).apply(this,arguments)}function js(){return(js=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l);Mn(c.auth,o,xt);const f=vn(c.auth,u);return new Ha(c.auth,"reauthViaPopup",o,f,c).executeNotNull()})).apply(this,arguments)}function ja(){return(ja=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l);Mn(c.auth,o,xt);const f=vn(c.auth,u);return new Ha(c.auth,"linkViaPopup",o,f,c).executeNotNull()})).apply(this,arguments)}let Ha=(()=>{class l extends Hl{constructor(u,c,f,g,y){super(u,c,g,y),this.provider=f,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var u=this;return(0,I.Z)(function*(){const c=yield u.execute();return k(c,u.auth,"internal-error"),c})()}onExecution(){var u=this;return(0,I.Z)(function*(){pt(1===u.filter.length,"Popup operations only handle one event");const c=yi();u.authWindow=yield u.resolver._openPopup(u.auth,u.provider,u.filter[0],c),u.authWindow.associatedEvent=c,u.resolver._originValidation(u.auth).catch(f=>{u.reject(f)}),u.resolver._isIframeWebStorageSupported(u.auth,f=>{f||u.reject(Ge(u.auth,"web-storage-unsupported"))}),u.pollUserCancellation()})()}get eventId(){var u;return(null===(u=this.authWindow)||void 0===u?void 0:u.associatedEvent)||null}cancel(){this.reject(Ge(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const u=()=>{var c,f;this.pollId=null!==(f=null===(c=this.authWindow)||void 0===c?void 0:c.window)&&void 0!==f&&f.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Ge(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(u,Ai.get())};u()}}return l.currentPopupAction=null,l})();const lt="pendingRedirect",Jt=new Map;class wi extends Hl{constructor(o,u,c=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],u,void 0,c),this.eventId=null}execute(){var o=()=>super.execute,u=this;return(0,I.Z)(function*(){let c=Jt.get(u.auth._key());if(!c){try{const g=(yield function Ql(l,o){return We.apply(this,arguments)}(u.resolver,u.auth))?yield o().call(u):null;c=()=>Promise.resolve(g)}catch(f){c=()=>Promise.reject(f)}Jt.set(u.auth._key(),c)}return u.bypassAuthState||Jt.set(u.auth._key(),()=>Promise.resolve(null)),c()})()}onAuthEvent(o){var u=()=>super.onAuthEvent,c=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return u().call(c,o);if("unknown"!==o.type){if(o.eventId){const f=yield c.auth._redirectUserForId(o.eventId);if(f)return c.user=f,u().call(c,o);c.resolve(null)}}else c.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function We(){return(We=(0,I.Z)(function*(l,o){const u=Ya(o),c=Ri(l);if(!(yield c._isAvailable()))return!1;const f="true"===(yield c._get(u));return yield c._remove(u),f})).apply(this,arguments)}function Qa(l,o){return Hs.apply(this,arguments)}function Hs(){return(Hs=(0,I.Z)(function*(l,o){return Ri(l)._set(Ya(o),"true")})).apply(this,arguments)}function Qs(l,o){Jt.set(l._key(),o)}function Ri(l){return et(l._redirectPersistence)}function Ya(l){return Gt(lt,l.config.apiKey,l.name)}function Yh(l,o,u){return function Jh(l,o,u){return Ja.apply(this,arguments)}(l,o,u)}function Ja(){return(Ja=(0,I.Z)(function*(l,o,u){const c=me(l);Mn(l,o,xt),yield c._initializationPromise;const f=vn(c,u);return yield Qa(f,c),f._openRedirect(c,o,"signInViaRedirect")})).apply(this,arguments)}function Xh(l,o,u){return function ed(l,o,u){return Xa.apply(this,arguments)}(l,o,u)}function Xa(){return(Xa=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l);Mn(c.auth,o,xt),yield c.auth._initializationPromise;const f=vn(c.auth,u);yield Qa(f,c.auth);const g=yield Yl(c);return f._openRedirect(c.auth,o,"reauthViaRedirect",g)})).apply(this,arguments)}function td(l,o,u){return function nd(l,o,u){return eu.apply(this,arguments)}(l,o,u)}function eu(){return(eu=(0,I.Z)(function*(l,o,u){const c=(0,x.m9)(l);Mn(c.auth,o,xt),yield c.auth._initializationPromise;const f=vn(c.auth,u);yield Es(!1,c,o.providerId),yield Qa(f,c.auth);const g=yield Yl(c);return f._openRedirect(c.auth,o,"linkViaRedirect",g)})).apply(this,arguments)}function tu(){return(tu=(0,I.Z)(function*(l,o){return yield me(l)._initializationPromise,Ys(l,o,!1)})).apply(this,arguments)}function Ys(l,o){return nu.apply(this,arguments)}function nu(){return(nu=(0,I.Z)(function*(l,o,u=!1){const c=me(l),f=vn(c,o),y=yield new wi(c,f,u).execute();return y&&!u&&(delete y.user._redirectEventId,yield c._persistUserIfCurrent(y.user),yield c._setRedirectUser(null,o)),y})).apply(this,arguments)}function Yl(l){return ru.apply(this,arguments)}function ru(){return(ru=(0,I.Z)(function*(l){const o=yi(`${l.uid}:::`);return l._redirectEventId=o,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),o})).apply(this,arguments)}class Xl{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let u=!1;return this.consumers.forEach(c=>{this.isEventForConsumer(o,c)&&(u=!0,this.sendToConsumer(o,c),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function id(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return su(l);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,u||(this.queuedRedirectEvent=o,u=!0)),u}sendToConsumer(o,u){var c;if(o.error&&!su(o)){const f=(null===(c=o.error.code)||void 0===c?void 0:c.split("auth/")[1])||"internal-error";u.onError(Ge(this.auth,f))}else u.onAuthEvent(o)}isEventForConsumer(o,u){const c=null===u.eventId||!!o.eventId&&o.eventId===u.eventId;return u.filter.includes(o.type)&&c}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(iu(o))}saveEventToCache(o){this.cachedEventUids.add(iu(o)),this.lastProcessedEventTime=Date.now()}}function iu(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(o=>o).join("-")}function su({type:l,error:o}){return"unknown"===l&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Js(l){return xe.apply(this,arguments)}function xe(){return(xe=(0,I.Z)(function*(l,o={}){return de(l,"GET","/v1/projects",o)})).apply(this,arguments)}const ec=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,En=/^https?/;function le(){return(le=(0,I.Z)(function*(l){if(l.config.emulator)return;const{authorizedDomains:o}=yield Js(l);for(const u of o)try{if(Xs(u))return}catch{}se(l,"unauthorized-domain")})).apply(this,arguments)}function Xs(l){const o=$r(),{protocol:u,hostname:c}=new URL(o);if(l.startsWith("chrome-extension://")){const y=new URL(l);return""===y.hostname&&""===c?"chrome-extension:"===u&&l.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===u&&y.hostname===c}if(!En.test(u))return!1;if(ec.test(l))return c===l;const f=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+f+"|"+f+")$","i").test(c)}const Ze=new ns(3e4,6e4);function ae(){const l=Oe().___jsl;if(null!=l&&l.H)for(const o of Object.keys(l.H))if(l.H[o].r=l.H[o].r||[],l.H[o].L=l.H[o].L||[],l.H[o].r=[...l.H[o].L],l.CP)for(let u=0;u<l.CP.length;u++)l.CP[u]=null}let Xt=null;const rc=new ns(5e3,15e3),sd="__/auth/iframe",Le="emulator/auth/iframe",od={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},An=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function we(l){const o=l.config;k(o.authDomain,l,"auth-domain-config-required");const u=o.emulator?Go(o,Le):`https://${l.config.authDomain}/${sd}`,c={apiKey:o.apiKey,appName:l.name,v:vt.SDK_VERSION},f=An.get(l.config.apiHost);f&&(c.eid=f);const g=l._getFrameworks();return g.length&&(c.fw=g.join(",")),`${u}?${(0,x.xO)(c).slice(1)}`}function Cr(){return Cr=(0,I.Z)(function*(l){const o=yield function nt(l){return Xt=Xt||function nc(l){return new Promise((o,u)=>{var c,f,g;function y(){ae(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{ae(),u(Ge(l,"network-request-failed"))},timeout:Ze.get()})}if(null!==(f=null===(c=Oe().gapi)||void 0===c?void 0:c.iframes)&&void 0!==f&&f.Iframe)o(gapi.iframes.getContext());else{if(null===(g=Oe().gapi)||void 0===g||!g.load){const T=la("iframefcb");return Oe()[T]=()=>{gapi.load?y():u(Ge(l,"network-request-failed"))},Hr(`https://apis.google.com/js/api.js?onload=${T}`).catch(P=>u(P))}y()}}).catch(o=>{throw Xt=null,o})}(l),Xt}(l),u=Oe().gapi;return k(u,l,"internal-error"),o.open({where:document.body,url:we(l),messageHandlersFilter:u.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:od,dontclear:!0},c=>new Promise(function(){var f=(0,I.Z)(function*(g,y){yield c.restyle({setHideOnLeave:!1});const T=Ge(l,"network-request-failed"),P=Oe().setTimeout(()=>{y(T)},rc.get());function L(){Oe().clearTimeout(P),g(c)}c.ping(L).then(L,()=>{y(T)})});return function(g,y){return f.apply(this,arguments)}}()))}),Cr.apply(this,arguments)}const eo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Si{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Ci="__/auth/handler",Sn="emulator/auth/handler",ic=encodeURIComponent("fac");function Cn(l,o,u,c,f,g){return bi.apply(this,arguments)}function bi(){return(bi=(0,I.Z)(function*(l,o,u,c,f,g){k(l.config.authDomain,l,"auth-domain-config-required"),k(l.config.apiKey,l,"invalid-api-key");const y={apiKey:l.config.apiKey,appName:l.name,authType:u,redirectUrl:c,v:vt.SDK_VERSION,eventId:f};if(o instanceof xt){o.setDefaultLanguage(l.languageCode),y.providerId=o.providerId||"",(0,x.xb)(o.getCustomParameters())||(y.customParameters=JSON.stringify(o.getCustomParameters()));for(const[B,z]of Object.entries(g||{}))y[B]=z}if(o instanceof Ir){const B=o.getScopes().filter(z=>""!==z);B.length>0&&(y.scopes=B.join(","))}l.tenantId&&(y.tid=l.tenantId);const T=y;for(const B of Object.keys(T))void 0===T[B]&&delete T[B];const P=yield l._getAppCheckToken(),L=P?`#${ic}=${encodeURIComponent(P)}`:"";return`${function to({config:l}){return l.emulator?Go(l,Sn):`https://${l.authDomain}/${Ci}`}(l)}?${(0,x.xO)(T).slice(1)}${L}`})).apply(this,arguments)}const tn="webStorageSupport",br=class ou{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mn,this._completeRedirectFn=Ys,this._overrideRedirectResult=Qs}_openPopup(o,u,c,f){var g=this;return(0,I.Z)(function*(){var y;pt(null===(y=g.eventManagers[o._key()])||void 0===y?void 0:y.manager,"_initialize() not called before _openPopup()");const T=yield Cn(o,u,c,$r(),f);return function Pn(l,o,u,c=500,f=600){const g=Math.max((window.screen.availHeight-f)/2,0).toString(),y=Math.max((window.screen.availWidth-c)/2,0).toString();let T="";const P=Object.assign(Object.assign({},eo),{width:c.toString(),height:f.toString(),top:g,left:y}),L=(0,x.z$)().toLowerCase();u&&(T=dr(L)?"_blank":u),ta(L)&&(o=o||"http://localhost",P.scrollbars="yes");const B=Object.entries(P).reduce((ce,[ct,kr])=>`${ce}${ct}=${kr},`,"");if(function Ih(l=(0,x.z$)()){var o;return Zt(l)&&!(null===(o=window.navigator)||void 0===o||!o.standalone)}(L)&&"_self"!==T)return function Ut(l,o){const u=document.createElement("a");u.href=l,u.target=o;const c=document.createEvent("MouseEvent");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(c)}(o||"",T),new Si(null);const z=window.open(o||"",T,B);k(z,l,"popup-blocked");try{z.focus()}catch{}return new Si(z)}(o,T,yi())})()}_openRedirect(o,u,c,f){var g=this;return(0,I.Z)(function*(){return yield g._originValidation(o),function Gs(l){Oe().location.href=l}(yield Cn(o,u,c,$r(),f)),new Promise(()=>{})})()}_initialize(o){const u=o._key();if(this.eventManagers[u]){const{manager:f,promise:g}=this.eventManagers[u];return f?Promise.resolve(f):(pt(g,"If manager is not set, promise should be"),g)}const c=this.initAndGetManager(o);return this.eventManagers[u]={promise:c},c.catch(()=>{delete this.eventManagers[u]}),c}initAndGetManager(o){var u=this;return(0,I.Z)(function*(){const c=yield function en(l){return Cr.apply(this,arguments)}(o),f=new Xl(o);return c.register("authEvent",g=>(k(null==g?void 0:g.authEvent,o,"invalid-auth-event"),{status:f.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),u.eventManagers[o._key()]={manager:f},u.iframes[o._key()]=c,f})()}_isIframeWebStorageSupported(o,u){this.iframes[o._key()].send(tn,{type:tn},f=>{var g;const y=null===(g=null==f?void 0:f[0])||void 0===g?void 0:g[tn];void 0!==y&&u(!!y),se(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const u=o._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function tc(l){return le.apply(this,arguments)}(o)),this.originValidationPromises[u]}get _shouldInitProactively(){return ia()||na()||Zt()}};class sc{constructor(o){this.factorId=o}_process(o,u,c){switch(u.type){case"enroll":return this._finalizeEnroll(o,u.credential,c);case"signin":return this._finalizeSignIn(o,u.credential);default:return ft("unexpected MultiFactorSessionType")}}}class no extends sc{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new no(o)}_finalizeEnroll(o,u,c){return function Bl(l,o){return de(l,"POST","/v2/accounts/mfaEnrollment:finalize",he(l,o))}(o,{idToken:u,displayName:c,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,u){return function Gh(l,o){return de(l,"POST","/v2/accounts/mfaSignIn:finalize",he(l,o))}(o,{mfaPendingCredential:u,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let ro=(()=>{class l{constructor(){}static assertion(u){return no._fromCredential(u)}}return l.FACTOR_ID="phone",l})();var au="@firebase/auth";class Ke{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var u=this;return(0,I.Z)(function*(){return u.assertAuthConfigured(),yield u.auth._initializationPromise,u.auth.currentUser?{accessToken:yield u.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const u=this.auth.onIdTokenChanged(c=>{o((null==c?void 0:c.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,u),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const u=this.internalListeners.get(o);u&&(this.internalListeners.delete(o),u(),this.updateProactiveRefresh())}assertAuthConfigured(){k(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function xn(){return window}(0,x.Pz)("authIdTokenMaxAge"),function _e(l){(0,vt._registerComponent)(new Pe.wA("auth",(o,{options:u})=>{const c=o.getProvider("app").getImmediate(),f=o.getProvider("heartbeat"),g=o.getProvider("app-check-internal"),{apiKey:y,authDomain:T}=c.options;k(y&&!y.includes(":"),"invalid-api-key",{appName:c.name});const P={apiKey:y,authDomain:T,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Kr(l)},L=new _l(c,f,g,P);return function Il(l,o){const u=(null==o?void 0:o.persistence)||[],c=(Array.isArray(u)?u:[u]).map(et);null!=o&&o.errorMap&&l._updateErrorMap(o.errorMap),l._initializeWithPersistence(c,null==o?void 0:o.popupRedirectResolver)}(L,u),L},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,u,c)=>{o.getProvider("auth-internal").initialize()})),(0,vt._registerComponent)(new Pe.wA("auth-internal",o=>{const u=me(o.getProvider("auth").getImmediate());return new Ke(u)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,vt.registerVersion)(au,"1.5.1",function ac(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(l)),(0,vt.registerVersion)(au,"1.5.1","esm2017")}("Browser");function Vn(){return Vn=(0,I.Z)(function*(l,o,u){var c;const{BuildInfo:f}=xn();pt(o.sessionId,"AuthEvent did not contain a session ID");const g=yield function hc(l){return du.apply(this,arguments)}(o.sessionId),y={};return Zt()?y.ibi=f.packageName:$t()?y.apn=f.packageName:se(l,"operation-not-supported-in-this-environment"),f.displayName&&(y.appDisplayName=f.displayName),y.sessionId=g,Cn(l,u,o.type,void 0,null!==(c=o.eventId)&&void 0!==c?c:void 0,y)}),Vn.apply(this,arguments)}function Vi(){return(Vi=(0,I.Z)(function*(l){const{BuildInfo:o}=xn(),u={};Zt()?u.iosBundleId=o.packageName:$t()?u.androidPackageName=o.packageName:se(l,"operation-not-supported-in-this-environment"),yield Js(l,u)})).apply(this,arguments)}function ao(){return(ao=(0,I.Z)(function*(l,o,u){const{cordova:c}=xn();let f=()=>{};try{yield new Promise((g,y)=>{let T=null;function P(){var z;g();const ce=null===(z=c.plugins.browsertab)||void 0===z?void 0:z.close;"function"==typeof ce&&ce(),"function"==typeof(null==u?void 0:u.close)&&u.close()}function L(){T||(T=window.setTimeout(()=>{y(Ge(l,"redirect-cancelled-by-user"))},2e3))}function B(){"visible"===(null==document?void 0:document.visibilityState)&&L()}o.addPassiveListener(P),document.addEventListener("resume",L,!1),$t()&&document.addEventListener("visibilitychange",B,!1),f=()=>{o.removePassiveListener(P),document.removeEventListener("resume",L,!1),document.removeEventListener("visibilitychange",B,!1),T&&window.clearTimeout(T)}})}finally{f()}})).apply(this,arguments)}function du(){return(du=(0,I.Z)(function*(l){const o=function ud(l){if(pt(/[0-9a-zA-Z]+/.test(l),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(l);const o=new ArrayBuffer(l.length),u=new Uint8Array(o);for(let c=0;c<l.length;c++)u[c]=l.charCodeAt(c);return u}(l),u=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(u)).map(f=>f.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class dc extends Xl{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(u=>u(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function pc(l){return fu.apply(this,arguments)}function fu(){return(fu=(0,I.Z)(function*(l){const o=yield nn()._get(tr(l));return o&&(yield nn()._remove(tr(l))),o})).apply(this,arguments)}function pu(){const l=[];for(let u=0;u<20;u++){const c=Math.floor(62*Math.random());l.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(c))}return l.join("")}function nn(){return et(jt)}function tr(l){return Gt("authEvent",l.config.apiKey,l.name)}function Di(l){if(null==l||!l.includes("?"))return{};const[o,...u]=l.split("?");return(0,x.zd)(u.join("?"))}const gc=class rn{constructor(){this._redirectPersistence=mn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ys,this._overrideRedirectResult=Qs}_initialize(o){var u=this;return(0,I.Z)(function*(){const c=o._key();let f=u.eventManagers.get(c);return f||(f=new dc(o),u.eventManagers.set(c,f),u.attachCallbackListeners(o,f)),f})()}_openPopup(o){se(o,"operation-not-supported-in-this-environment")}_openRedirect(o,u,c,f){var g=this;return(0,I.Z)(function*(){!function cc(l){var o,u,c,f,g,y,T,P,L,B;const z=xn();k("function"==typeof(null===(o=null==z?void 0:z.universalLinks)||void 0===o?void 0:o.subscribe),l,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),k(typeof(null===(u=null==z?void 0:z.BuildInfo)||void 0===u?void 0:u.packageName)<"u",l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),k("function"==typeof(null===(g=null===(f=null===(c=null==z?void 0:z.cordova)||void 0===c?void 0:c.plugins)||void 0===f?void 0:f.browsertab)||void 0===g?void 0:g.openUrl),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),k("function"==typeof(null===(P=null===(T=null===(y=null==z?void 0:z.cordova)||void 0===y?void 0:y.plugins)||void 0===T?void 0:T.browsertab)||void 0===P?void 0:P.isAvailable),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),k("function"==typeof(null===(B=null===(L=null==z?void 0:z.cordova)||void 0===L?void 0:L.InAppBrowser)||void 0===B?void 0:B.open),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const y=yield g._initialize(o);yield y.initialized(),y.resetRedirect(),function Ft(){Jt.clear()}(),yield g._originValidation(o);const T=function cd(l,o,u=null){return{type:o,eventId:u,urlResponse:null,sessionId:pu(),postBody:null,tenantId:l.tenantId,error:Ge(l,"no-auth-event")}}(o,c,f);yield function fc(l,o){return nn()._set(tr(l),o)}(o,T);const P=yield function ue(l,o,u){return Vn.apply(this,arguments)}(o,T,u),L=yield function lc(l){const{cordova:o}=xn();return new Promise(u=>{o.plugins.browsertab.isAvailable(c=>{let f=null;c?o.plugins.browsertab.openUrl(l):f=o.InAppBrowser.open(l,function ra(l=(0,x.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}()?"_blank":"_system","location=yes"),u(f)})})}(P);return function hu(l,o,u){return ao.apply(this,arguments)}(o,y,L)})()}_isIframeWebStorageSupported(o,u){throw new Error("Method not implemented.")}_originValidation(o){const u=o._key();return this.originValidationPromises[u]||(this.originValidationPromises[u]=function cu(l){return Vi.apply(this,arguments)}(o)),this.originValidationPromises[u]}attachCallbackListeners(o,u){const{universalLinks:c,handleOpenURL:f,BuildInfo:g}=xn(),y=setTimeout((0,I.Z)(function*(){yield pc(o),u.onEvent(nr())}),500),T=function(){var B=(0,I.Z)(function*(z){clearTimeout(y);const ce=yield pc(o);let ct=null;ce&&null!=z&&z.url&&(ct=function hd(l,o){var u,c;const f=function lo(l){const o=Di(l),u=o.link?decodeURIComponent(o.link):void 0,c=Di(u).link,f=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return Di(f).link||f||c||u||l}(o);if(f.includes("/__/auth/callback")){const g=Di(f),y=g.firebaseError?function uo(l){try{return JSON.parse(l)}catch{return null}}(decodeURIComponent(g.firebaseError)):null,T=null===(c=null===(u=null==y?void 0:y.code)||void 0===u?void 0:u.split("auth/"))||void 0===c?void 0:c[1],P=T?Ge(T):null;return P?{type:l.type,eventId:l.eventId,tenantId:l.tenantId,error:P,urlResponse:null,sessionId:null,postBody:null}:{type:l.type,eventId:l.eventId,tenantId:l.tenantId,sessionId:l.sessionId,urlResponse:f,postBody:null}}return null}(ce,z.url)),u.onEvent(ct||nr())});return function(ce){return B.apply(this,arguments)}}();typeof c<"u"&&"function"==typeof c.subscribe&&c.subscribe(null,T);const P=f,L=`${g.packageName.toLowerCase()}://`;xn().handleOpenURL=function(){var B=(0,I.Z)(function*(z){if(z.toLowerCase().startsWith(L)&&T({url:z}),"function"==typeof P)try{P(z)}catch(ce){console.error(ce)}});return function(z){return B.apply(this,arguments)}}()}};function nr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ge("no-auth-event")}}function Vr(){var l;return(null===(l=null==self?void 0:self.location)||void 0===l?void 0:l.protocol)||null}function Ni(l=(0,x.z$)()){return!("file:"!==Vr()&&"ionic:"!==Vr()&&"capacitor:"!==Vr()||!l.toLowerCase().match(/iphone|ipad|ipod|android/))}function _u(){try{const l=self.localStorage,o=yi();if(l)return l.setItem(o,"1"),l.removeItem(o),!function Oi(l=(0,x.z$)()){return function yc(){return(0,x.w1)()&&11===(null==document?void 0:document.documentMode)}()||function Dr(l=(0,x.z$)()){return/Edge\/\d+/.test(l)}(l)}()||(0,x.hl)()}catch{return co()&&(0,x.hl)()}return!1}function co(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function yu(){return(function gu(){return"http:"===Vr()||"https:"===Vr()}()||(0,x.ru)()||Ni())&&!function ki(){return(0,x.b$)()||(0,x.UG)()}()&&_u()&&!co()}function qt(){return Ni()&&typeof document<"u"}function He(){return(He=(0,I.Z)(function*(){return!!qt()&&new Promise(l=>{const o=setTimeout(()=>{l(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),l(!0)})})})).apply(this,arguments)}const je={LOCAL:"local",NONE:"none",SESSION:"session"},Nr=k,Rt="persistence";function rr(l){return Iu.apply(this,arguments)}function Iu(){return(Iu=(0,I.Z)(function*(l){yield l._initializationPromise;const o=Y(),u=Gt(Rt,l.config.apiKey,l.name);o&&o.setItem(u,l._getPersistence())})).apply(this,arguments)}function Y(){var l;try{return(null===(l=function Ic(){return typeof window<"u"?window:null}())||void 0===l?void 0:l.sessionStorage)||null}catch{return null}}const pd=k;class Bt{constructor(){this.browserResolver=et(br),this.cordovaResolver=et(gc),this.underlyingResolver=null,this._redirectPersistence=mn,this._completeRedirectFn=Ys,this._overrideRedirectResult=Qs}_initialize(o){var u=this;return(0,I.Z)(function*(){return yield u.selectUnderlyingResolver(),u.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,u,c,f){var g=this;return(0,I.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openPopup(o,u,c,f)})()}_openRedirect(o,u,c,f){var g=this;return(0,I.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openRedirect(o,u,c,f)})()}_isIframeWebStorageSupported(o,u){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,u)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return qt()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return pd(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const u=yield function dd(){return He.apply(this,arguments)}();o.underlyingResolver=u?o.cordovaResolver:o.browserResolver})()}}function vu(l){return l.unwrap()}function Ec(l){return Ac(l)}function Ac(l){const{_tokenResponse:o}=l instanceof x.ZR?l.customData:l;if(!o)return null;if(!(l instanceof x.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Sr.credentialFromResult(l);const u=o.providerId;if(!u||u===Xe.PASSWORD)return null;let c;switch(u){case Xe.GOOGLE:c=ii;break;case Xe.FACEBOOK:c=va;break;case Xe.GITHUB:c=vr;break;case Xe.TWITTER:c=Ta;break;default:const{oauthIdToken:f,oauthAccessToken:g,oauthTokenSecret:y,pendingToken:T,nonce:P}=o;return g||y||f||T?T?u.startsWith("saml.")?fn._create(u,T):gt._fromParams({providerId:u,signInMethod:u,pendingToken:T,idToken:f,accessToken:g}):new Vt(u).credential({idToken:f,accessToken:g,rawNonce:P}):null}return l instanceof x.ZR?c.credentialFromError(l):c.credentialFromResult(l)}function rt(l,o){return o.catch(u=>{throw u instanceof x.ZR&&function ho(l,o){var u;const c=null===(u=o.customData)||void 0===u?void 0:u._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new ir(l,function qa(l,o){var u;const c=(0,x.m9)(l),f=o;return k(o.customData.operationType,c,"argument-error"),k(null===(u=f.customData._serverResponse)||void 0===u?void 0:u.mfaPendingCredential,c,"argument-error"),Ua._fromError(c,f)}(l,o));else if(c){const f=Ac(o),g=o;f&&(g.credential=f,g.tenantId=c.tenantId||void 0,g.email=c.email||void 0,g.phoneNumber=c.phoneNumber||void 0)}}(l,u),u}).then(u=>{const f=u.user;return{operationType:u.operationType,credential:Ec(u),additionalUserInfo:Ul(u),user:zt.getOrCreate(f)}})}function fo(l,o){return Dn.apply(this,arguments)}function Dn(){return(Dn=(0,I.Z)(function*(l,o){const u=yield o;return{verificationId:u.verificationId,confirm:c=>rt(l,u.confirm(c))}})).apply(this,arguments)}class ir{constructor(o,u){this.resolver=u,this.auth=function Tc(l){return l.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return rt(vu(this.auth),this.resolver.resolveSignIn(o))}}class zt{constructor(o){this._delegate=o,this.multiFactor=function yt(l){const o=(0,x.m9)(l);return wt.has(o)||wt.set(o,Bs._fromUser(o)),wt.get(o)}(o)}static getOrCreate(o){return zt.USER_MAP.has(o)||zt.USER_MAP.set(o,new zt(o)),zt.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var u=this;return(0,I.Z)(function*(){return rt(u.auth,Sa(u._delegate,o))})()}linkWithPhoneNumber(o,u){var c=this;return(0,I.Z)(function*(){return fo(c.auth,function Hh(l,o,u){return Yt.apply(this,arguments)}(c._delegate,o,u))})()}linkWithPopup(o){var u=this;return(0,I.Z)(function*(){return rt(u.auth,function Ka(l,o,u){return ja.apply(this,arguments)}(u._delegate,o,Bt))})()}linkWithRedirect(o){var u=this;return(0,I.Z)(function*(){return yield rr(me(u.auth)),td(u._delegate,o,Bt)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var u=this;return(0,I.Z)(function*(){return rt(u.auth,xl(u._delegate,o))})()}reauthenticateWithPhoneNumber(o,u){return fo(this.auth,function Qh(l,o,u){return In.apply(this,arguments)}(this._delegate,o,u))}reauthenticateWithPopup(o){return rt(this.auth,function er(l,o,u){return js.apply(this,arguments)}(this._delegate,o,Bt))}reauthenticateWithRedirect(o){var u=this;return(0,I.Z)(function*(){return yield rr(me(u.auth)),Xh(u._delegate,o,Bt)})()}sendEmailVerification(o){return function Dh(l,o){return Ns.apply(this,arguments)}(this._delegate,o)}unlink(o){var u=this;return(0,I.Z)(function*(){return yield function ai(l,o){return Zn.apply(this,arguments)}(u._delegate,o),u})()}updateEmail(o){return function Ms(l,o){return La((0,x.m9)(l),o,null)}(this._delegate,o)}updatePassword(o){return function Nh(l,o){return La((0,x.m9)(l),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function at(l,o){return Ei.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function ks(l,o){return Os.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,u){return function Ma(l,o,u){return Qn.apply(this,arguments)}(this._delegate,o,u)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}zt.USER_MAP=new WeakMap;const Pt=k;let Tu=(()=>{class l{constructor(u,c){if(this.app=u,c.isInitialized())return this._delegate=c.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:f}=u.options;Pt(f,"invalid-api-key",{appName:u.name}),Pt(f,"invalid-api-key",{appName:u.name});const g=typeof window<"u"?Bt:void 0;this._delegate=c.initialize({options:{persistence:wc(f,u.name),popupRedirectResolver:g}}),this._delegate._updateErrorMap(dh),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?zt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(u){this._delegate.languageCode=u}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(u){this._delegate.tenantId=u}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(u,c){!function vl(l,o,u){const c=me(l);k(c._canInitEmulator,c,"emulator-config-failed"),k(/^https?:\/\//.test(o),c,"invalid-emulator-scheme");const f=!(null==u||!u.disableWarnings),g=Tl(o),{host:y,port:T}=function Ah(l){const o=Tl(l),u=/(\/\/)?([^?#/]+)/.exec(l.substr(o.length));if(!u)return{host:"",port:null};const c=u[2].split("@").pop()||"",f=/^(\[[^\]]+\])(:|$)/.exec(c);if(f){const g=f[1];return{host:g,port:fr(c.substr(g.length+1))}}{const[g,y]=c.split(":");return{host:g,port:fr(y)}}}(o);c.config.emulator={url:`${g}//${y}${null===T?"":`:${T}`}/`},c.settings.appVerificationDisabledForTesting=!0,c.emulatorConfig=Object.freeze({host:y,port:T,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:f})}),f||function Yr(){function l(){const o=document.createElement("p"),u=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",u.position="fixed",u.width="100%",u.backgroundColor="#ffffff",u.border=".1em solid #000000",u.color="#b50000",u.bottom="0px",u.left="0px",u.margin="0px",u.zIndex="10000",u.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}(this._delegate,u,c)}applyActionCode(u){return function Ss(l,o){return hi.apply(this,arguments)}(this._delegate,u)}checkActionCode(u){return Na(this._delegate,u)}confirmPasswordReset(u,c){return function Ps(l,o,u){return jn.apply(this,arguments)}(this._delegate,u,c)}createUserWithEmailAndPassword(u,c){var f=this;return(0,I.Z)(function*(){return rt(f._delegate,function Ae(l,o,u){return Cs.apply(this,arguments)}(f._delegate,u,c))})()}fetchProvidersForEmail(u){return this.fetchSignInMethodsForEmail(u)}fetchSignInMethodsForEmail(u){return function kt(l,o){return Ds.apply(this,arguments)}(this._delegate,u)}isSignInWithEmailLink(u){return function Nl(l,o){const u=Gn.parseLink(o);return"EMAIL_SIGNIN"===(null==u?void 0:u.operation)}(0,u)}getRedirectResult(){var u=this;return(0,I.Z)(function*(){Pt(yu(),u._delegate,"operation-not-supported-in-this-environment");const c=yield function rd(l,o){return tu.apply(this,arguments)}(u._delegate,Bt);return c?rt(u._delegate,Promise.resolve(c)):{credential:null,user:null}})()}addFrameworkForLogging(u){!function _c(l,o){me(l)._logFramework(o)}(this._delegate,u)}onAuthStateChanged(u,c,f){const{next:g,error:y,complete:T}=sr(u,c,f);return this._delegate.onAuthStateChanged(g,y,T)}onIdTokenChanged(u,c,f){const{next:g,error:y,complete:T}=sr(u,c,f);return this._delegate.onIdTokenChanged(g,y,T)}sendSignInLinkToEmail(u,c){return function Vh(l,o,u){return Oa.apply(this,arguments)}(this._delegate,u,c)}sendPasswordResetEmail(u,c){return function bh(l,o,u){return Da.apply(this,arguments)}(this._delegate,u,c||void 0)}setPersistence(u){var c=this;return(0,I.Z)(function*(){let f;switch(function vc(l,o){Nr(Object.values(je).includes(o),l,"invalid-persistence-type"),(0,x.b$)()?Nr(o!==je.SESSION,l,"unsupported-persistence-type"):(0,x.UG)()?Nr(o===je.NONE,l,"unsupported-persistence-type"):co()?Nr(o===je.NONE||o===je.LOCAL&&(0,x.hl)(),l,"unsupported-persistence-type"):Nr(o===je.NONE||_u(),l,"unsupported-persistence-type")}(c._delegate,u),u){case je.SESSION:f=mn;break;case je.LOCAL:f=(yield et(Rr)._isAvailable())?Rr:jt;break;case je.NONE:f=ln;break;default:return se("argument-error",{appName:c._delegate.name})}return c._delegate.setPersistence(f)})()}signInAndRetrieveDataWithCredential(u){return this.signInWithCredential(u)}signInAnonymously(){return rt(this._delegate,function vs(l){return Tr.apply(this,arguments)}(this._delegate))}signInWithCredential(u){return rt(this._delegate,ui(this._delegate,u))}signInWithCustomToken(u){return rt(this._delegate,function Dl(l,o){return ws.apply(this,arguments)}(this._delegate,u))}signInWithEmailAndPassword(u,c){return rt(this._delegate,function xh(l,o,u){return ui((0,x.m9)(l),ys.credential(o,u)).catch(function(){var c=(0,I.Z)(function*(f){throw"auth/password-does-not-meet-requirements"===f.code&&xa(l),f});return function(f){return c.apply(this,arguments)}}())}(this._delegate,u,c))}signInWithEmailLink(u,c){return rt(this._delegate,function kl(l,o,u){return bs.apply(this,arguments)}(this._delegate,u,c))}signInWithPhoneNumber(u,c){return fo(this._delegate,function Ga(l,o,u){return Qt.apply(this,arguments)}(this._delegate,u,c))}signInWithPopup(u){var c=this;return(0,I.Z)(function*(){return Pt(yu(),c._delegate,"operation-not-supported-in-this-environment"),rt(c._delegate,function Tn(l,o,u){return Za.apply(this,arguments)}(c._delegate,u,Bt))})()}signInWithRedirect(u){var c=this;return(0,I.Z)(function*(){return Pt(yu(),c._delegate,"operation-not-supported-in-this-environment"),yield rr(c._delegate),Yh(c._delegate,u,Bt)})()}updateCurrentUser(u){return this._delegate.updateCurrentUser(u)}verifyPasswordResetCode(u){return function di(l,o){return ka.apply(this,arguments)}(this._delegate,u)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return l.Persistence=je,l})();function sr(l,o,u){let c=l;"function"!=typeof l&&({next:c,error:o,complete:u}=l);const f=c;return{next:y=>f(y&&zt.getOrCreate(y)),error:o,complete:u}}function wc(l,o){const u=function fd(l,o){const u=Y();if(!u)return[];const c=Gt(Rt,l,o);switch(u.getItem(c)){case je.NONE:return[ln];case je.LOCAL:return[Rr,mn];case je.SESSION:return[mn];default:return[]}}(l,o);if(typeof self<"u"&&!u.includes(Rr)&&u.push(Rr),typeof window<"u")for(const c of[jt,mn])u.includes(c)||u.push(c);return u.includes(ln)||u.push(ln),u}class po{constructor(){this.providerId="phone",this._delegate=new Sr(vu(Se.Z.auth()))}static credential(o,u){return Sr.credential(o,u)}verifyPhoneNumber(o,u){return this._delegate.verifyPhoneNumber(o,u)}unwrap(){return this._delegate}}po.PHONE_SIGN_IN_METHOD=Sr.PHONE_SIGN_IN_METHOD,po.PROVIDER_ID=Sr.PROVIDER_ID;const Mi=k;class md{constructor(o,u,c=Se.Z.app()){var f;Mi(null===(f=c.options)||void 0===f?void 0:f.apiKey,"invalid-api-key",{appName:c.name}),this._delegate=new ge(c.auth(),o,u),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function ve(l){l.INTERNAL.registerComponent(new Pe.wA("auth-compat",o=>{const u=o.getProvider("app-compat").getImmediate(),c=o.getProvider("auth");return new Tu(u,c)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:ys,FacebookAuthProvider:va,GithubAuthProvider:vr,GoogleAuthProvider:ii,OAuthProvider:Vt,SAMLAuthProvider:Is,PhoneAuthProvider:po,PhoneMultiFactorGenerator:ro,RecaptchaVerifier:md,TwitterAuthProvider:Ta,Auth:Tu,AuthCredential:dn,Error:x.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),l.registerVersion("@firebase/auth-compat","0.5.1")}(Se.Z)}}]);